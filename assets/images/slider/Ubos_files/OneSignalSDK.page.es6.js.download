!function(){"use strict";function t(t){return t&&t.t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var e,i;function n(){if(i)return e;i=1,e=function(e,i,s){"function"==typeof i&&(s=i,i={});i||(i={});var o,a,r=i.prefix||"__jp",c=i.name||r+t++,l=i.param||"callback",u=null!=i.timeout?i.timeout:6e4,h=encodeURIComponent,d=document.getElementsByTagName("script")[0]||document.head;u&&(a=setTimeout(function(){g(),s&&s(new Error("Timeout"))},u));function g(){o.parentNode&&o.parentNode.removeChild(o),window[c]=n,a&&clearTimeout(a)}return window[c]=function(t){g(),s&&s(null,t)},e=(e+=(~e.indexOf("?")?"&":"?")+l+"="+h(c)).replace("?&","?"),(o=document.createElement("script")).src=e,d.parentNode.insertBefore(o,d),function(){window[c]&&g()}};var t=0;function n(){}return e}const s=t(n()),o="Email",a="SMS",r="Push",c="ChromePush",l="Email",u="SMS",h="SafariPush",d="SafariLegacyPush",g="FirefoxPush",p=0,w=1,f=-2,m=-23,b=-24,y="chrome",S="edge",v="safari",O="firefox",I="other",k=[{i:"Opera",o:/(?:opera|opr|opios)/i,l:/(?:opera|opr|opios)[ /](\d+(?:\.\d+)?)/i},{i:"Facebook",o:/FBAN\//i,l:/FBAV\/(\d+(?:\.\d+)?)/i},{i:"Samsung Browser",o:/samsungbrowser/i,l:/samsungbrowser[ /](\d+(?:\.\d+)?)/i},{i:"Yandex Browser",o:/yabrowser/i,l:/yabrowser[ /](\d+(?:\.\d+)?)/i},{i:"Vivaldi",o:/vivaldi/i,l:/vivaldi[ /](\d+(?:\.\d+)?)/i},{i:"UC Browser",o:/ucbrowser/i,l:/ucbrowser[ /](\d+(?:\.\d+)?)/i},{i:"Microsoft Edge",o:/edg/i,l:/edg[ /](\d+(?:\.\d+)?)/i},{i:"Firefox",o:/firefox|iceweasel|fxios/i,l:/(?:firefox|iceweasel|fxios)[ /](\d+(?:\.\d+)?)/i},{i:"Chromium",o:/chromium/i,l:/chromium[ /](\d+(?:\.\d+)?)/i},{i:"Chrome",o:/chrome|crios|crmo/i,l:/(?:chrome|crios|crmo)[ /](\d+(?:\.\d+)?)/i},{i:"Safari",o:/safari|applewebkit/i,l:/version[ /](\d+(?:\.\d+)?)/i}];function x(t){for(const e of k)if(e.o.test(t)){const i=t.match(e.l)?.[1]??"";return{name:e.i,version:i}}return{name:"Unknown",version:""}}const C=t=>!/like android/i.test(t)&&/android/i.test(t),E=t=>t.match(/(iphone|ipod|ipad)/i)?.[1]?.toLowerCase()||"";function _(t=navigator.userAgent){const e=E(t);return/tablet/i.test(t)&&!/tablet pc/i.test(t)||"ipad"===e||C(t)&&!/[^-]mobi/i.test(t)||!/nexus\s*[0-6]\s*/i.test(t)&&/nexus\s*\d+/i.test(t)}function P(t=navigator.userAgent){if(_(t))return!1;const e=E(t);return/[^-]mobi/i.test(t)||"iphone"===e||"ipod"===e||C(t)}const $={Chrome:y,Chromium:y,Firefox:O,"Microsoft Edge":S,Safari:v};function T(){return $[x(navigator.userAgent).name]||I}const N=()=>{const t=x(navigator.userAgent).version;if(!t)return-1;const[e,i="0"]=t.split(".");return+`${e}.${i}`};function A(){const t=T(),e=N();return t===O&&e>=72||t===v&&e>=12.1}const M="160507",D="undefined"!=typeof window,U=()=>D&&void 0!==window.safari,B=()=>"undefined"!=typeof navigator&&"serviceWorker"in navigator,L="Browser",R=()=>D&&null!=window.safari?.pushNotification,W="undefined"!=typeof PushSubscriptionOptions&&PushSubscriptionOptions.prototype.hasOwnProperty("applicationServerKey"),F=({action:t,legacy:e=!1}={})=>new URL(e?"https://onesignal.com/api/v1/":"https://api.onesignal.com/"),j=()=>T()===O?g:T()===v&&W&&!R()?h:R()?d:c;function K(){return String(N())}function z(){return navigator.platform}const H="set-alias",V="delete-alias",q="set-property",G="refresh-user",J="login-user",Y="create-subscription",Q="update-subscription",Z="delete-subscription",X="transfer-subscription",tt="custom-event",et="external_id",it="onesignal_id",nt=0,st=1,ot=2;class at extends Error{status;statusText;constructor(t,e){super("Registration of a Service Worker failed."),this.status=t,this.statusText=e}}class rt extends Error{reason;constructor(t){let e;switch(t){case st:e="Invalid email";break;case nt:e="Invalid sms";break;case ot:e="Invalid email & sms"}super(e),this.reason=t}}const ct=new Error("Missing app ID"),lt=new Error("Retry limit reached"),ut=new Error("Permission blocked"),ht=new Error("AppID doesn't match existing apps"),dt=new Error("Safari web platform must be enabled"),gt=t=>new Error(`Channel '${t}' already exists`),pt=t=>new Error(`"${t}" is empty`),wt=t=>new Error(`"${t}" is malformed`),ft=t=>new Error(`"${t}" is the wrong type`);function mt(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function bt(t,e){if(e&&e.allowNull&&null===t)return!0;if(e&&e.allowEmpty&&null==t)return!0;try{const i=new URL(t);return!e||!e.requireHttps||"https:"===i.protocol}catch(i){return!1}}function yt(t){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(t)}function St(t){return new Promise(e=>setTimeout(e,t))}function vt(){return Promise.resolve()}function Ot(t,e){return null!=t?t:e}function It(){return location.origin}class kt{static u(){try{const t=window.localStorage.getItem("loglevel");return"trace"===t?.toLowerCase()}catch(t){return!1}}static h(t){try{window.localStorage.setItem("loglevel",t)}catch(e){console.error(e)}}static p(t){return(...e)=>{(this.u()||"error"===t)&&console[t](...e)}}static m=kt.p("debug");static S=kt.p("info");static v=kt.p("warn");static O=kt.p("error")}const xt={5:1e4,4:2e4,3:3e4,2:3e4,1:3e4};class Ct{static get(t,e,i){return Ct.call("GET",t,e,i)}static post(t,e,i){return Ct.call("POST",t,e,i)}static put(t,e,i){return Ct.call("PUT",t,e,i)}static delete(t,e,i){return Ct.call("DELETE",t,e,i)}static patch(t,e,i){return Ct.call("PATCH",t,e,i)}static call(t,e,i,n){if(!this.I(e,i))return Promise.reject(ct);const s=new Headers;if(s.append("Origin",window.location.origin),s.append("SDK-Version",`onesignal/web/${M}`),s.append("Content-Type","application/json;charset=UTF-8"),s.append("Accept","application/vnd.onesignal.v1+json"),n)for(const r of Object.keys(n))s.append(r,n[r]);const o={method:t||"NO_METHOD_SPECIFIED",headers:s,cache:"no-cache"};i&&(o.body=JSON.stringify(i));const a=`${F({action:e}).toString()}${e}`;return Ct.executeFetch(a,o)}static async executeFetch(t,e,i=5){if(0===i)return Promise.reject(lt);try{const i=await fetch(t,e),{status:n,headers:s}=i,o=await i.json(),a=s?.get("Retry-After");return{ok:i.ok,result:o,status:n,retryAfterSeconds:a?parseInt(a):void 0}}catch(n){if(n instanceof Error&&"TypeError"===n.name)return await St(xt[i]),kt.O(`OneSignal: Network timed out while calling ${t}. Retrying...`),Ct.executeFetch(t,e,i-1);throw new Error(`Failed to execute HTTP call: ${n}`)}}static I(t,e){if(t.startsWith("apps/")){return yt(t.split("/")[1])}if(t.startsWith("sync/")){return yt(t.split("/")[1])}return!(!e||"string"!=typeof e.app_id)&&yt(e.app_id)}}function Et(t){return encodeURIComponent(t).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`)}async function _t(t,e,i){const{appId:n,subscriptionId:s}=t;if(!yt(n))throw ht;const o=s?{"OneSignal-Subscription-Id":s}:void 0;let a={};o&&(a={...a,...o}),t.jwtHeader&&(a={...a,...t.jwtHeader});const r=Et(e.label),c=Et(e.id);return Ct.patch(`apps/${n}/users/by/${r}/${c}`,i,a)}function Pt(t,e){return!!t&&-1!==t.indexOf(e)}function $t(t){return JSON.stringify(t,(t,e)=>"function"==typeof e?"[Function]":e,4)}function Tt(t){let e="";const i=Object.keys(t);for(const n of i){const i=t[n];e+=`${encodeURIComponent(n)}=${encodeURIComponent(i)}`}return e}const Nt=1,At=2,Mt=3,Dt=4;class Ut{static async sendOutcome(t){kt.S("Outcome payload:",t);try{await Ct.post("outcomes/measure",t)}catch(e){kt.O("sendOutcome",e)}}}class Bt{static jsonpLib(t,e){s(t,void 0,e)}static async downloadServerAppConfig(t){return await new Promise((e,i)=>{Bt.jsonpLib(`${F().toString()}sync/${t}/web`,(t,n)=>{t?i(t):n.success?e(n):i(n)})})}}function Lt(t){if(t.restrictedOriginEnabled&&!function(t){try{return location.origin===new URL(t).origin}catch(e){return!1}}(t.origin))throw new Error(`Can only be used on: ${new URL(t.origin).origin}`)}const Rt={scope:"/"},Wt="OneSignalSDKWorker.js",Ft="native",jt="push",Kt="category",zt="sms",Ht="email",Vt="smsAndEmail",qt={pageViews:1,timeDelay:0},Gt="We'd like to show you notifications for the latest news and updates.",Jt="Allow",Yt="Cancel",Qt="Try Again",Zt={updateMessage:"Update your push notification subscription preferences.",positiveUpdateButton:"Save Preferences",negativeUpdateButton:"Cancel"},Xt="Saving...",te="Thank You!",ee={type:jt,text:{actionMessage:Gt,acceptButton:Jt,cancelButton:Yt},autoPrompt:!1,delay:qt},ie="wordpress",ne="custom";function se(t){const e=t.config.staticPrompts,i=e.native?{enabled:e.native.enabled,autoPrompt:e.native.enabled&&!1!==e.native.autoPrompt,pageViews:Ot(e.native.pageViews,qt.pageViews),timeDelay:Ot(e.native.timeDelay,qt.timeDelay)}:{enabled:!1,autoPrompt:!1,pageViews:qt.pageViews,timeDelay:qt.timeDelay},{prompts:n}=e.slidedown;return{autoPrompt:i.autoPrompt||oe(n),native:i,slidedown:{prompts:n},fullscreen:{enabled:e.fullscreen.enabled,actionMessage:e.fullscreen.actionMessage,acceptButton:e.fullscreen.acceptButton,cancelButton:e.fullscreen.cancelButton,title:e.fullscreen.title,message:e.fullscreen.message,caption:e.fullscreen.caption,autoAcceptTitle:e.fullscreen.autoAcceptTitle},customlink:ae(t)}}function oe(t){if(!t)return!1;for(let e=0;e<t.length;e++)if(t[e].autoPrompt)return!0;return!1}function ae(t){const e={enabled:!1,style:"button",size:"medium",unsubscribeEnabled:!1,text:{explanation:"",subscribe:"",unsubscribe:""},color:{button:"",text:""}};if(!(t&&t.config&&t.config.staticPrompts&&t.config.staticPrompts.customlink&&t.config.staticPrompts.customlink.enabled))return e;const i=t.config.staticPrompts.customlink;return{enabled:i.enabled,style:i.style,size:i.size,unsubscribeEnabled:i.unsubscribeEnabled,text:i.text?{subscribe:i.text.subscribe,unsubscribe:i.text.unsubscribe,explanation:i.text.explanation}:e.text,color:i.color?{button:i.color.button,text:i.color.text}:e.color}}const re=0,ce=1;function le(t){switch(t){case ne:case ie:return{configuration:ce};default:return{configuration:re}}}function ue(t,e,i){switch(le(t).configuration){case re:{const{path:t,serviceWorkerPath:n,serviceWorkerParam:s}=function(t,e){const{serviceWorker:i}=e.config,n=t.serviceWorkerOverrideForTypical;return{path:n?Ot(t.path,i.path):i.path,serviceWorkerParam:n?Ot(t.serviceWorkerParam,{scope:i.registrationScope}):{scope:i.registrationScope},serviceWorkerPath:n?Ot(t.serviceWorkerPath,i.workerName):i.workerName}}(e,i);return{appId:i.app_id,autoRegister:!1,autoResubscribe:i.config.autoResubscribe,path:t,serviceWorkerPath:n,serviceWorkerParam:s,subdomainName:i.config.siteInfo.proxyOrigin,promptOptions:se(i),welcomeNotification:{disable:!i.config.welcomeNotification.enable,title:i.config.welcomeNotification.title,message:i.config.welcomeNotification.message,url:i.config.welcomeNotification.url},notifyButton:{enable:i.config.staticPrompts.bell.enabled,displayPredicate:i.config.staticPrompts.bell.hideWhenSubscribed?()=>!OneSignal.User.PushSubscription.optedIn:null,size:i.config.staticPrompts.bell.size,position:i.config.staticPrompts.bell.location,showCredit:!1,offset:{bottom:`${i.config.staticPrompts.bell.offset.bottom}px`,left:`${i.config.staticPrompts.bell.offset.left}px`,right:`${i.config.staticPrompts.bell.offset.right}px`},colors:{"circle.background":i.config.staticPrompts.bell.color.main,"circle.foreground":i.config.staticPrompts.bell.color.accent,"badge.background":"black","badge.foreground":"white","badge.bordercolor":"black","pulse.color":i.config.staticPrompts.bell.color.accent,"dialog.button.background.hovering":i.config.staticPrompts.bell.color.main,"dialog.button.background.active":i.config.staticPrompts.bell.color.main,"dialog.button.background":i.config.staticPrompts.bell.color.main,"dialog.button.foreground":"white"},text:{"tip.state.unsubscribed":i.config.staticPrompts.bell.tooltip.unsubscribed,"tip.state.subscribed":i.config.staticPrompts.bell.tooltip.subscribed,"tip.state.blocked":i.config.staticPrompts.bell.tooltip.blocked,"message.prenotify":i.config.staticPrompts.bell.tooltip.unsubscribed,"message.action.subscribing":i.config.staticPrompts.bell.message.subscribing,"message.action.subscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.resubscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.unsubscribed":i.config.staticPrompts.bell.message.unsubscribing,"dialog.main.title":i.config.staticPrompts.bell.dialog.main.title,"dialog.main.button.subscribe":i.config.staticPrompts.bell.dialog.main.subscribeButton,"dialog.main.button.unsubscribe":i.config.staticPrompts.bell.dialog.main.unsubscribeButton,"dialog.blocked.title":i.config.staticPrompts.bell.dialog.blocked.title,"dialog.blocked.message":i.config.staticPrompts.bell.dialog.blocked.message}},persistNotification:i.config.notificationBehavior?i.config.notificationBehavior.display.persist:void 0,webhooks:{cors:i.config.webhooks.corsEnable,"notification.willDisplay":i.config.webhooks.notificationDisplayedHook,"notification.clicked":i.config.webhooks.notificationClickedHook,"notification.dismissed":i.config.webhooks.notificationDismissedHook},notificationClickHandlerMatch:i.config.notificationBehavior?i.config.notificationBehavior.click.match:void 0,notificationClickHandlerAction:i.config.notificationBehavior?i.config.notificationBehavior.click.action:void 0,outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}}}case ce:{const t={...e,promptOptions:he(e.promptOptions,i.config.staticPrompts,e),serviceWorkerParam:e.serviceWorkerParam?e.serviceWorkerParam:Rt,serviceWorkerPath:e.serviceWorkerPath?e.serviceWorkerPath:Wt,path:e.path?e.path:"/",outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}};return Object.prototype.hasOwnProperty.call(e,"autoResubscribe")?t.autoResubscribe=!!e.autoResubscribe:Object.prototype.hasOwnProperty.call(e,"autoRegister")?t.autoResubscribe=!!e.autoRegister:t.autoResubscribe=!!i.config.autoResubscribe,t}}}function he(t,e,i){let n={enabled:!1};t&&t.customlink&&(n=t.customlink);const s=e.customlink,o={...t,customlink:{enabled:Ot(n.enabled,s.enabled),style:Ot(n.style,s.style),size:Ot(n.size,s.size),unsubscribeEnabled:Ot(n.unsubscribeEnabled,s.unsubscribeEnabled),text:{subscribe:Ot(n.text?n.text.subscribe:void 0,s.text.subscribe),unsubscribe:Ot(n.text?n.text.unsubscribe:void 0,s.text.unsubscribe),explanation:Ot(n.text?n.text.explanation:void 0,s.text.explanation)},color:{button:Ot(n.color?n.color.button:void 0,s.color.button),text:Ot(n.color?n.color.text:void 0,s.color.text)}}};if(o.slidedown?o.slidedown.prompts=o.slidedown?.prompts?.map(t=>{if(t.type=Ot(t.type,jt),t.type===Kt&&(t.text={...t.text,positiveUpdateButton:Ot(t.text?.positiveUpdateButton,Zt.positiveUpdateButton),negativeUpdateButton:Ot(t.text?.negativeUpdateButton,Zt.negativeUpdateButton),updateMessage:Ot(t.text?.updateMessage,Zt.updateMessage)}),t.text={...t.text,actionMessage:Ot(t.text?.actionMessage,Gt),acceptButton:Ot(t.text?.acceptButton,Jt),cancelButton:Ot(t.text?.cancelButton,Yt),confirmMessage:Ot(t.text?.confirmMessage,te)},t.autoPrompt=Ot(t.autoPrompt,!0),t.delay={pageViews:Ot(t.delay?.pageViews,qt.pageViews),timeDelay:Ot(t.delay?.timeDelay,qt.timeDelay)},t.categories){const{categories:i}=t;t.categories=(e=10,structuredClone(i).slice(0,e))}var e;return t}):(o.slidedown={prompts:[]},o.slidedown.prompts=[ee]),o.native){const t=Object.prototype.hasOwnProperty.call(o.native,"autoPrompt");o.native.autoPrompt=t?!!o.native.enabled&&!!o.native.autoPrompt:!!o.native.enabled,o.native.enabled=!!o.native.enabled,o.native.pageViews=Ot(o.native.pageViews,qt.pageViews),o.native.timeDelay=Ot(o.native.timeDelay,qt.timeDelay)}else o.native={enabled:!1,autoPrompt:!1,pageViews:qt.pageViews,timeDelay:qt.timeDelay};return!0===i.autoRegister&&(o.native.enabled=!0,o.native.autoPrompt=!0),o.autoPrompt=o.native.autoPrompt||oe(o.slidedown.prompts),o}function de(t){(function(t){if(!t)return!1;return["acceptButtonText","cancelButtonText","actionMessage"].some(e=>Object.prototype.hasOwnProperty.call(t,e))})(t.promptOptions)&&(t.promptOptions=function(t){t.slidedown||(t.slidedown={});const{slidedown:e}=t;return e.acceptButtonText=e.acceptButtonText??t.acceptButtonText??t.acceptButton,e.cancelButtonText=e.cancelButtonText??t.cancelButtonText??t.cancelButton,e.actionMessage=e.actionMessage??t.actionMessage,t}(t.promptOptions)),function(t){if(!t)return!1;return["enabled","autoPrompt","pageViews","timeDelay","acceptButton","acceptButtonText","cancelButton","cancelButtonText","actionMessage","customizeTextEnabled","categories"].some(e=>Object.prototype.hasOwnProperty.call(t,e))}(t.promptOptions?.slidedown)&&t.promptOptions?.slidedown&&(t.promptOptions.slidedown=function(t){const e=(a=t,(a?.categories?.tags?.length||0)>0),i=e?Kt:jt,{categories:n,prompts:s=[]}=t,o={type:i,autoPrompt:t.autoPrompt,text:{actionMessage:t.actionMessage,acceptButton:t.acceptButton??t.acceptButtonText,cancelButton:t.cancelButton??t.cancelButtonText,...e&&{positiveUpdateButton:n?.positiveUpdateButton,negativeUpdateButton:n?.negativeUpdateButton,updateMessage:n?.updateMessage}},delay:{pageViews:t.pageViews,timeDelay:t.timeDelay},categories:n?.tags};var a;return{prompts:[...s,o]}}(t.promptOptions?.slidedown))}const ge=30,pe=!1,we=!0;async function fe(t){return async function(t,e){try{if(!t||!t.appId||!yt(t.appId))throw ht;const i=await e(t.appId);de(t);const n=function(t,e){const i=function(t){return t.config.integration?.kind??ne}(e),n=function(t,e,i){switch(le(t).configuration){case re:return i.config.siteInfo.proxyOriginEnabled;case ce:return!!e.subdomainName}}(i,t,e),s=ue(i,t,e);return{appId:e.app_id,hasUnsupportedSubdomain:n,siteName:e.config.siteInfo.name,origin:e.config.origin,restrictedOriginEnabled:e.features.restrict_origin&&e.features.restrict_origin.enable,safariWebId:e.config.safari_web_id,vapidPublicKey:e.config.vapid_public_key,onesignalVapidPublicKey:e.config.onesignal_vapid_public_key,userConfig:s,enableOnSession:Ot(e.features.enable_on_session,pe),sessionThreshold:Ot(e.features.session_threshold,ge),enableSessionDuration:Ot(e.features.web_on_focus_enabled,we)}}(t,i);return function(t){const e=!self.isSecureContext;if(t.hasUnsupportedSubdomain||e)throw e?new Error("OneSignalSDK: HTTP sites are no longer supported starting with version 16 (User Model), your public site must start with https://."):new Error('OneSignalSDK: The "My site is not fully HTTPS" option is no longer supported starting with version 16 (User Model) of the OneSignal SDK.')}(n),Lt(n),n}catch(i){if(i instanceof Object&&"code"in i){if(1===i.code)throw ht;if(2===i.code)throw new Error("App not configured for web push")}throw i}}(t,Bt.downloadServerAppConfig)}const me=(t,e)=>e.some(e=>t instanceof e);let be,ye;const Se=new WeakMap,ve=new WeakMap,Oe=new WeakMap;let Ie={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return Se.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Ee(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function ke(t){Ie=t(Ie)}function xe(t){return(ye||(ye=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(_e(this),e),Ee(this.request)}:function(...e){return Ee(t.apply(_e(this),e))}}function Ce(t){return"function"==typeof t?xe(t):(t instanceof IDBTransaction&&function(t){if(Se.has(t))return;const e=new Promise((e,i)=>{const n=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{e(),n()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});Se.set(t,e)}(t),me(t,be||(be=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Ie):t)}function Ee(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,i)=>{const n=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{e(Ee(t.result)),n()},o=()=>{i(t.error),n()};t.addEventListener("success",s),t.addEventListener("error",o)});return Oe.set(e,t),e}(t);if(ve.has(t))return ve.get(t);const e=Ce(t);return e!==t&&(ve.set(t,e),Oe.set(e,t)),e}const _e=t=>Oe.get(t);const Pe=["get","getKey","getAll","getAllKeys","count"],$e=["put","add","delete","clear"],Te=new Map;function Ne(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Te.get(e))return Te.get(e);const i=e.replace(/FromIndex$/,""),n=e!==i,s=$e.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!Pe.includes(i))return;const o=async function(t,...e){const o=this.transaction(t,s?"readwrite":"readonly");let a=o.store;return n&&(a=a.index(e.shift())),(await Promise.all([a[i](...e),s&&o.done]))[0]};return Te.set(e,o),o}ke(t=>({...t,get:(e,i,n)=>Ne(e,i)||t.get(e,i,n),has:(e,i)=>!!Ne(e,i)||t.has(e,i)}));const Ae=["continue","continuePrimaryKey","advance"],Me={},De=new WeakMap,Ue=new WeakMap,Be={get(t,e){if(!Ae.includes(e))return t[e];let i=Me[e];return i||(i=Me[e]=function(...t){De.set(this,Ue.get(this)[e](...t))}),i}};async function*Le(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;const i=new Proxy(e,Be);for(Ue.set(i,e),Oe.set(i,_e(e));e;)yield i,e=await(De.get(i)||e.continue()),De.delete(i)}function Re(t,e){return e===Symbol.asyncIterator&&me(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&me(t,[IDBIndex,IDBObjectStore])}ke(t=>({...t,get:(e,i,n)=>Re(e,i)?Le:t.get(e,i,n),has:(e,i)=>Re(e,i)||t.has(e,i)}));const We=1,Fe=2,je=3,Ke=4,ze=5,He=7,Ve=8;let qe=!1;const Ge=async(t=7)=>function(t,e,{blocked:i,upgrade:n,blocking:s,terminated:o}={}){const a=indexedDB.open(t,e),r=Ee(a);return n&&a.addEventListener("upgradeneeded",t=>{n(Ee(a.result),t.oldVersion,t.newVersion,Ee(a.transaction),t)}),i&&a.addEventListener("blocked",t=>i(t.oldVersion,t.newVersion,t)),r.then(t=>{o&&t.addEventListener("close",()=>o()),s&&t.addEventListener("versionchange",t=>s(t.oldVersion,t.newVersion,t))}).catch(()=>{}),r}("ONE_SIGNAL_SDK_DB",t,{upgrade(e,i,n,s){const o=n||t;o>=1&&i<1&&(e.createObjectStore("Ids",{keyPath:"type"}),e.createObjectStore("NotificationOpened",{keyPath:"url"}),e.createObjectStore("Options",{keyPath:"key"})),o>=2&&i<2&&(e.createObjectStore("Sessions",{keyPath:"sessionKey"}),e.createObjectStore("NotificationReceived",{keyPath:"notificationId"}),e.createObjectStore("NotificationClicked",{keyPath:"notificationId"})),o>=3&&i<3&&e.createObjectStore("SentUniqueOutcome",{keyPath:"outcomeName"}),o>=4&&i<4&&(e.createObjectStore("identity",{keyPath:"modelId"}),e.createObjectStore("properties",{keyPath:"modelId"}),e.createObjectStore("pushSubscriptions",{keyPath:"modelId"}),e.createObjectStore("smsSubscriptions",{keyPath:"modelId"}),e.createObjectStore("emailSubscriptions",{keyPath:"modelId"})),o>=5&&i<5&&(async function(t,e){const i="NotificationClicked",n="Outcomes.NotificationClicked";t.createObjectStore(n,{keyPath:"notificationId"});let s=await e.objectStore(i).openCursor();for(;s;){const t=s.value;await e.objectStore(n).put({notificationId:t.notificationId||t.notification.id,appId:t.appId,timestamp:t.timestamp}),s=await s.continue()}t.deleteObjectStore(i)}(e,s),async function(t,e){const i="NotificationReceived",n="Outcomes.NotificationReceived";t.createObjectStore(n,{keyPath:"notificationId"});let s=await e.objectStore(i).openCursor();for(;s;)await e.objectStore(n).put(s.value),s=await s.continue();t.deleteObjectStore(i)}(e,s)),o>=6&&i<6&&async function(t,e){const i="subscriptions";let n;t.createObjectStore(i,{keyPath:"modelId"});const s=await e.objectStore("identity").getAll();s.length>0&&(n=s[0].externalId);for(const o of["emailSubscriptions","pushSubscriptions","smsSubscriptions"]){let s=await e.objectStore(o).openCursor();for(;s;)await e.objectStore(i).put({...s.value,modelName:"subscriptions",externalId:n}),s=await s.continue();t.deleteObjectStore(o)}}(e,s),o>=7&&i<7&&e.createObjectStore("operations",{keyPath:"modelId"}),qe=!1,"undefined"!=typeof OneSignal&&(OneSignal.k=!0)},blocked(){kt.m("IndexedDB: Blocked event")},terminated(){qe||(qe=!0,Ye())}});let Je=Ge();const Ye=(t=7)=>(Je=Ge(t),Je),Qe={get:async(t,e)=>(await Je).get(t,e),getAll:async t=>(await Je).getAll(t),put:async(t,e)=>(await Je).put(t,e),delete:async(t,e)=>(await Je).delete(t,e)},Ze=async t=>{const e=await Qe.get("Options",t);return e&&"value"in e?e.value:null},Xe=async()=>await Qe.get("Sessions","oneSignalSession")??null,ti="os_pageViews",ei="requiresPrivacyConsent";function ii(){const t=OneSignal.config?.userConfig.requiresUserPrivacyConsent??!1;return"true"===localStorage.getItem(ei)||t}function ni(){return Number(localStorage.getItem(ti))}const si=async()=>{const t={},e=await(async t=>{const e=await Qe.get("Ids",t);return e&&"id"in e?e.id:null})("appId");return t.appId=e,t.vapidPublicKey=await Ze("vapidPublicKey"),t},oi=async()=>{const t=await Ze("defaultUrl"),e=await Ze("defaultTitle"),i=await Ze("isPushEnabled"),n=await Ze("lastOptedIn");return{defaultNotificationUrl:t,defaultNotificationTitle:e,lastKnownPushEnabled:i,lastKnownPushId:await Ze("lastPushId")??void 0,lastKnownPushToken:await Ze("lastPushToken")??void 0,lastKnownOptedIn:n}},ai=async t=>{t.defaultNotificationUrl&&await Qe.put("Options",{key:"defaultUrl",value:t.defaultNotificationUrl}),(t.defaultNotificationTitle||""===t.defaultNotificationTitle)&&await Qe.put("Options",{key:"defaultTitle",value:t.defaultNotificationTitle}),null!=t.lastKnownPushEnabled&&await Qe.put("Options",{key:"isPushEnabled",value:t.lastKnownPushEnabled}),null!=t.lastKnownPushId&&await Qe.put("Options",{key:"lastPushId",value:t.lastKnownPushId}),null!=t.lastKnownPushToken&&await Qe.put("Options",{key:"lastPushToken",value:t.lastKnownPushToken}),null!=t.lastKnownOptedIn&&await Qe.put("Options",{key:"lastOptedIn",value:t.lastKnownOptedIn})},ri=()=>{const t=ii(),e=OneSignal.C,i=t&&!e;return i&&kt.v("Consent required but not given"),i};class ci{deviceId;subscriptionToken;optedOut;createdAt;expirationTime;_(){return{deviceId:this.deviceId,subscriptionToken:this.subscriptionToken,optedOut:this.optedOut,createdAt:this.createdAt,expirationTime:this.expirationTime}}static deserialize(t){const e=new ci;return e.deviceId=t.deviceId,e.subscriptionToken=t.subscriptionToken,e.optedOut=t.optedOut,e.createdAt=t.createdAt,e.expirationTime=t.expirationTime,e}}const li=async()=>{const t=new ci;t.deviceId=(await Qe.get("Ids","userId"))?.id,t.subscriptionToken=(await Qe.get("Ids","registrationId"))?.id;const e=await Ze("optedOut"),i=await Ze("subscription"),n=await Ze("subscriptionCreatedAt"),s=await Ze("subscriptionExpirationTime");return t.optedOut=null!=e?e:null!=i&&!i,t.createdAt=n??null,t.expirationTime=s??null,t},ui=async t=>{t.deviceId&&await Qe.put("Ids",{type:"userId",id:t.deviceId}),void 0!==t.subscriptionToken&&await Qe.put("Ids",{type:"registrationId",id:t.subscriptionToken}),null!=t.optedOut&&await Qe.put("Options",{key:"optedOut",value:t.optedOut}),null!=t.createdAt&&await Qe.put("Options",{key:"subscriptionCreatedAt",value:t.createdAt}),null!=t.expirationTime?await Qe.put("Options",{key:"subscriptionExpirationTime",value:t.expirationTime}):await Qe.delete("Options","subscriptionExpirationTime")};function hi(t,e,i){let n;if(n="string"==typeof t?document.querySelector(t):t,!n)throw new Error(`${t} must be a CSS selector string or DOM Element object.`);n.insertAdjacentHTML(e,i)}function di(t){const e=document.querySelectorAll(t);if(e.length>0)for(let i=0;i<e.length;i++){const t=e[i].parentNode;t&&t.removeChild(e[i])}}function gi(t){const e=document.querySelector(t);return e||(kt.m(`No instance of ${t} found. Returning stub.`),document.createElement("div"))}function pi(t,e){if("string"==typeof t){const i=document.querySelector(t);if(null===i)throw new Error(`Cannot find element with selector "${t}"`);i.classList.add(e)}else{if("object"!=typeof t)throw new Error(`${t} must be a CSS selector string or DOM Element object.`);t.classList.add(e)}}function wi(t,e){if("string"==typeof t){const i=document.querySelector(t);if(null===i)throw new Error(`Cannot find element with selector "${t}"`);i.classList.remove(e)}else{if("object"!=typeof t)throw new Error(`${t} must be a CSS selector string or DOM Element object.`);t.classList.remove(e)}}function fi(t,e){if("string"==typeof t){const i=document.querySelector(t);if(null===i)throw new Error(`Cannot find element with selector "${t}"`);return i.classList.contains(e)}if("object"==typeof t)return t.classList.contains(e);throw new Error(`${t} must be a CSS selector string or DOM Element object.`)}function mi(t){if("undefined"==typeof DOMParser)return t;return(new DOMParser).parseFromString(t,"text/html").documentElement.textContent||""}const bi="push",yi="nonPush",Si="promptDismissCount",vi="nonPushPromptsDismissCount",Oi="onesignal-notification-prompt",Ii="onesignal-non-push-prompt";class ki{static isLocalStorageSupported(){try{return"undefined"!=typeof localStorage&&(localStorage.getItem("test"),!0)}catch(t){return!1}}static setItem(t,e,i){if(!ki.isLocalStorageSupported())return;const n=void 0!==i?60*i*1e3:0,s={value:JSON.stringify(e),timestamp:void 0!==i?(new Date).getTime()+n:void 0};localStorage.setItem(t,JSON.stringify(s))}static getItem(t){if(!ki.isLocalStorageSupported())return null;const e=localStorage.getItem(t);let i;try{i=JSON.parse(e)}catch(s){return null}if(null===i)return null;if(i.timestamp&&(new Date).getTime()>=i.timestamp)return localStorage.removeItem(t),null;let n=i.value;try{n=JSON.parse(i.value)}catch(s){return n}return n}static removeItem(t){if(!ki.isLocalStorageSupported())return null;localStorage.removeItem(t)}}const xi={[bi]:Si,[yi]:vi},Ci={[bi]:Oi,[yi]:Ii};class Ei{static async markPromptDismissedWithType(t){const e=xi[t],i=Ci[t];let n=await Ze(e);n||(n=0),n+=1;let s=3;2==n?s=7:n>2&&(s=30),kt.m(`(${L} environment) OneSignal: User dismissed the ${t} notification prompt; reprompt after ${s} days.`),await Qe.put("Options",{key:e,value:n});const o=24*s*60;return ki.setItem(i,"dismissed",o)}static wasPromptOfTypeDismissed(t){switch(t){case bi:return"dismissed"===ki.getItem(Oi);case yi:return"dismissed"===ki.getItem(Ii)}return!1}}async function _i(){return new Promise(t=>{OneSignal.initialized?t():OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED,t)})}function Pi(t,...e){return kt.m(`Called ${t}(${e.map($t).join(", ")})`)}function $i(t,e,i,n=!1){if(e||kt.O("Cannot call on() with no event: ",e),i||kt.O("Cannot call on() with no task: ",i),"string"==typeof t){const n=document.querySelectorAll(t);if(n.length>0)for(let t=0;t<n.length;t++)$i(n[t],e,i)}else if(Array.isArray(t))for(let s=0;s<t.length;s++)$i(t[s],e,i);else{if("object"!=typeof t)throw new Error(`${t} must be a CSS selector string or DOM Element object.`);{const s=function(){return function(e){const o=function(){t.removeEventListener(e.type,s)};n||o(),i?.(e,o)}}();t.addEventListener(e,s)}}}function Ti(){return window.__oneSignalSdkLoadCount||0}function Ni(t){if(!t)return"default-icon";const e=T();return e===v&&t.safari?t.safari:e===O&&t.firefox?t.firefox:t.chrome||t.firefox||t.safari||"default-icon"}class Ai{P;constructor(){this.P={}}on(t,e){return this.P[t]=this.P[t]||[],this.P[t].push(e),this}once(t,e){const i=this;function n(){i.off(t,n),e.apply(this,arguments)}return n.listener=e,this.on(t,n),this}off(t,e){const i=this.P[t];if(void 0!==i){for(let t=0;t<i.length;t+=1)if(i[t]===e||i[t].listener===e){i.splice(t,1);break}0===i.length&&this.removeAllListeners(t)}return this}removeAllListeners(t){return t?delete this.P[t]:this.P={},this}listeners(t){try{return this.P[t]}catch(e){return}}numberOfListeners(t){const e=this.listeners(t);return e?e.length:0}async emit(...t){const e=t.shift();let i=this.P[e];if(void 0!==i){i=i.slice(0);const e=i.length;for(let n=0;n<e;n+=1)await i[n].apply(this,t)}return this}}const Mi=["notifyButtonHovering","notifyButtonHover","notifyButtonButtonClick","notifyButtonLauncherClick","animatedElementHiding","animatedElementHidden","animatedElementShowing","animatedElementShown","activeAnimatedElementActivating","activeAnimatedElementActive","activeAnimatedElementInactivating","activeAnimatedElementInactive"];class Di{static async trigger(t,e,i){if(!Pt(Mi,t)){const i=e;i||!1===i?kt.m(`(${L}) » ${t}:`,i):kt.m(`(${L}) » ${t}`)}if(t===OneSignal.EVENTS.SDK_INITIALIZED){if(OneSignal.initialized)return;OneSignal.initialized=!0}i?await i.emit(t,e):await OneSignal.emitter.emit(t,e)}}let Ui=!1;const Bi=async(t=!1)=>{if(!Ui){Ui=!0;try{await Li(t)}finally{Ui=!1}}},Li=async t=>{const e=await OneSignal.context.$.getPermissionStatus(),i=await Ze("notificationPermission");(e!==i||t)&&(await Qe.put("Options",{key:"notificationPermission",value:e}),await Di.trigger(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,e),Ri(i,e,t))},Ri=(t,e,i)=>{const n="granted"===e;(n!==("granted"===t)||i)&&Di.trigger(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_BOOLEAN,n)};class Wi{static async showLocalNotification(t,e,i,n,s,o){Pi("MainHelper:showLocalNotification: ",t,e,i,n,s,o);if(!(await si()).appId)throw ct;if(!OneSignal.Notifications.permission)throw new Error("User is not subscribed");if(!bt(i))throw wt("url");if(!bt(n,{allowEmpty:!0,requireHttps:!0}))throw wt("icon");if(!n){const t=await Wi.getNotificationIcons();n=Ni(t)}const a=t=>{const e=[];for(let i=0;i<t.length;i++){const n=t[i];e.push({action:n.id,title:n.text,icon:n.icon,url:n.url})}return e},r={data:s,launchURL:i,buttons:o?a(o):void 0};OneSignal.context.T.getRegistration().then(async i=>{if(!i)return void kt.O("Service worker registration not available.");const s={body:e,data:r,icon:n,actions:o?a(o):[]};i.showNotification(t,s)})}static async checkAndTriggerNotificationPermissionChanged(){const t=await Ze("notificationPermission"),e=await OneSignal.context.$.getPermissionStatus();t!==e&&(await Bi(),await Qe.put("Options",{key:"notificationPermission",value:e}))}static async getNotificationIcons(){const t=Wi.getAppId();if(!t)throw ct;const e=`${F().toString()}apps/${t}/icon`,i=await fetch(e),n=await i.json();if(n.errors)throw kt.O(`API call ${e}`,"failed with:",n.errors),new Error("Failed to get notification icons.");return n}static getSlidedownOptions(t){return Ot(t.slidedown,{prompts:[]})}static getFullscreenPermissionMessageOptions(t){return t?t.fullscreen?{autoAcceptTitle:t.fullscreen.autoAcceptTitle,actionMessage:t.fullscreen.actionMessage,exampleNotificationTitleDesktop:t.fullscreen.title,exampleNotificationTitleMobile:t.fullscreen.title,exampleNotificationMessageDesktop:t.fullscreen.message,exampleNotificationMessageMobile:t.fullscreen.message,exampleNotificationCaption:t.fullscreen.caption,acceptButton:t.fullscreen.acceptButton,cancelButton:t.fullscreen.cancelButton}:t:null}static getPromptOptionsQueryString(){let t="";if(Wi.getFullscreenPermissionMessageOptions(OneSignal.config?.userConfig.promptOptions)){const e=Wi.getPromptOptionsPostHash();for(const i of Object.keys(e)){t+="&"+i+"="+e[i]}}return t}static getPromptOptionsPostHash(){const t=Wi.getFullscreenPermissionMessageOptions(OneSignal.config?.userConfig.promptOptions),e={};if(t){const i={exampleNotificationTitleDesktop:"exampleNotificationTitle",exampleNotificationMessageDesktop:"exampleNotificationMessage",exampleNotificationTitleMobile:"exampleNotificationTitle",exampleNotificationMessageMobile:"exampleNotificationMessage"};for(const e of Object.keys(i)){const n=i[e];t[e]&&(t[n]=t[e])}const n=["autoAcceptTitle","siteName","autoAcceptTitle","subscribeText","showGraphic","actionMessage","exampleNotificationTitle","exampleNotificationMessage","exampleNotificationCaption","acceptButton","cancelButton","timeout"];for(let s=0;s<n.length;s++){const i=n[s],o=t[i],a=encodeURIComponent(o);(o||!1===o||""===o)&&(e[i]=a)}}return e}static getAppId(){return OneSignal.config?.appId||""}static async getDeviceId(){return(await li()).deviceId||void 0}static async getCurrentPushToken(){if(R()){const t=window.safari?.pushNotification?.permission(OneSignal.config?.safariWebId).deviceToken;return t?.toLowerCase()||void 0}const t=await OneSignal.context.T.getRegistration();if(!t)return;const e=await t.pushManager.getSubscription();return e?.endpoint}}const Fi=0,ji=1,Ki=0,zi=1;class Hi{cache;constructor(){this.cache={}}getCache(){return{...this.cache}}async loadSdkStylesheet(){const t=(()=>{let t;return t="https://onesignal.com",new URL("https://onesignal.com/sdks/web/v16")})();return this.loadIfNew(Fi,new URL(`${t}/OneSignalSDK.page.styles.css?v=${M}`))}async loadIfNew(t,e){return this.cache[e.toString()]||(this.cache[e.toString()]=Hi.load(t,e)),this.cache[e.toString()]}static async load(t,e){try{let i;return await new Promise((n,s)=>{switch(t){case ji:i=document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("async","async"),i.setAttribute("src",e.toString());break;case Fi:i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("href",e.toString())}i.onerror=s,i.onload=n,document.querySelector("head")?.appendChild(i)}),Ki}catch(i){return zi}}}class Vi{selector;showClass;hideClass;state;targetTransitionEvents;nestedContentSelector;transitionCheckTimeout;constructor(t,e,i,n="shown",s=["opacity","transform"],o,a=500){this.selector=t,this.showClass=e,this.hideClass=i,this.state=n,this.targetTransitionEvents=s,this.nestedContentSelector=o,this.transitionCheckTimeout=a}show(){return this.hidden?new Promise(t=>{this.state="showing",Di.trigger(Vi.EVENTS.SHOWING,this);const e=this.element;if(e?(this.hideClass&&wi(e,this.hideClass),this.showClass&&pi(e,this.showClass)):kt.O(`(show) could not find animated element with selector ${this.selector}`),0==this.targetTransitionEvents.length)return t(this);{const e=setTimeout(()=>{kt.m(`Element did not completely show (state: ${this.state}).`)},this.transitionCheckTimeout);$i(this.element,"transitionend",(i,n)=>{if(i.target===this.element&&Pt(this.targetTransitionEvents,i.propertyName))return clearTimeout(e),n(),this.state="shown",Di.trigger(Vi.EVENTS.SHOWN,this),t(this)},!0)}}):Promise.resolve(this)}hide(){return this.shown?new Promise(t=>{this.state="hiding",Di.trigger(Vi.EVENTS.HIDING,this);const e=this.element;if(e?(this.showClass&&wi(e,this.showClass),this.hideClass&&pi(e,this.hideClass)):kt.O(`(hide) could not find animated element with selector ${this.selector}`),0==this.targetTransitionEvents.length)return t(this);$i(this.element,"transitionend",(e,i)=>{const n=setTimeout(()=>{kt.m(`Element did not completely hide (state: ${this.state}).`)},this.transitionCheckTimeout);if(e.target===this.element&&Pt(this.targetTransitionEvents,e.propertyName))return clearTimeout(n),i(),this.state="hidden",Di.trigger(Vi.EVENTS.HIDDEN,this),t(this)},!0)}):Promise.resolve(this)}waitUntilShown(){return"shown"===this.state?Promise.resolve(this):new Promise(t=>{OneSignal.emitter.once(Vi.EVENTS.SHOWN,e=>{if(e===this)return t(this)})})}waitUntilHidden(){return"hidden"===this.state?Promise.resolve(this):new Promise(t=>{OneSignal.emitter.once(Vi.EVENTS.HIDDEN,e=>{if(e===this)return t(this)})})}static get EVENTS(){return{SHOWING:"animatedElementShowing",SHOWN:"animatedElementShown",HIDING:"animatedElementHiding",HIDDEN:"animatedElementHidden"}}get content(){if(!this.element)return"";if(this.nestedContentSelector){const t=this.element.querySelector(this.nestedContentSelector);return t?t.innerHTML:""}return this.element.innerHTML}set content(t){if(this.element)if(this.nestedContentSelector){const e=this.element.querySelector(this.nestedContentSelector);e&&(e.textContent=t)}else this.element.textContent=t}get element(){return document.querySelector(this.selector)}get showing(){return"showing"===this.state}get shown(){return"shown"===this.state}get hiding(){return"hiding"===this.state}get hidden(){return"hidden"===this.state}}class qi extends Vi{activeClass;inactiveClass;activeState;nestedContentSelector;constructor(t,e,i,n,s,o="shown",a="active",r=["opacity","transform"],c){super(t,e,i,o,r),this.activeClass=n,this.inactiveClass=s,this.activeState=a,this.nestedContentSelector=c}activate(){return this.inactive&&this.shown?new Promise(t=>{this.activeState="activating",Di.trigger(qi.EVENTS.ACTIVATING,this);const e=this.element;if(e?(this.inactiveClass&&wi(e,this.inactiveClass),this.activeClass&&pi(e,this.activeClass)):kt.O("Could not find active animated element"),!this.shown)return kt.m("Ending activate() transition (alternative)."),this.activeState="active",Di.trigger(qi.EVENTS.ACTIVE,this),t(this);if(0==this.targetTransitionEvents.length)return t(this);{const e=setTimeout(()=>{kt.m(`Element did not completely activate (state: ${this.state}, activeState: ${this.activeState}).`)},this.transitionCheckTimeout);$i(this.element,"transitionend",(i,n)=>{if(i.target===this.element&&Pt(this.targetTransitionEvents,i.propertyName))return clearTimeout(e),n(),this.activeState="active",Di.trigger(qi.EVENTS.ACTIVE,this),t(this)},!0)}}):Promise.resolve(this)}inactivate(){return this.active?new Promise(t=>{this.activeState="inactivating",Di.trigger(qi.EVENTS.INACTIVATING,this);const e=this.element;if(e?(this.activeClass&&wi(e,this.activeClass),this.inactiveClass&&pi(e,this.inactiveClass)):kt.O("Could not find active animated element"),!this.shown)return this.activeState="inactive",Di.trigger(qi.EVENTS.INACTIVE,this),t(this);if(0==this.targetTransitionEvents.length)return t(this);{const e=setTimeout(()=>{kt.m(`Element did not completely inactivate (state: ${this.state}, activeState: ${this.activeState}).`)},this.transitionCheckTimeout);$i(this.element,"transitionend",(i,n)=>{if(i.target===this.element&&Pt(this.targetTransitionEvents,i.propertyName))return clearTimeout(e),n(),this.activeState="inactive",Di.trigger(qi.EVENTS.INACTIVE,this),t(this)},!0)}}):Promise.resolve(this)}waitUntilActive(){return this.active?Promise.resolve(this):new Promise(t=>{OneSignal.emitter.once(qi.EVENTS.ACTIVE,e=>{if(e===this)return t(this)})})}waitUntilInactive(){return this.inactive?Promise.resolve(this):new Promise(t=>{OneSignal.emitter.once(qi.EVENTS.INACTIVE,e=>{if(e===this)return t(this)})})}static get EVENTS(){return{...Vi.EVENTS,ACTIVATING:"activeAnimatedElementActivating",ACTIVE:"activeAnimatedElementActive",INACTIVATING:"activeAnimatedElementInactivating",INACTIVE:"activeAnimatedElementInactive"}}get activating(){return"activating"===this.activeState}get active(){return"active"===this.activeState}get inactivating(){return"inactivating"===this.activeState}get inactive(){return"inactive"===this.activeState}}class Gi extends qi{constructor(){super(".onesignal-bell-launcher-badge","onesignal-bell-launcher-badge-opened",void 0,"onesignal-bell-launcher-badge-active",void 0,"hidden")}increment(){if(!isNaN(this.content)){let t=+this.content;t+=1,this.content=t.toString()}}show(){const t=super.show();return OneSignal.notifyButton?.setCustomColorsIfSpecified(),t}decrement(){if(!isNaN(this.content)){let t=+this.content;t-=1,this.content=t>0?t.toString():""}}}class Ji{static store={};static LIMIT=2;static put(t,e){return void 0===Ji.store[t]&&(Ji.store[t]=[null,null]),Ji.store[t].push(e),Ji.store[t].length==Ji.LIMIT+1&&Ji.store[t].shift(),Ji.store[t]}static get(t){return void 0===Ji.store[t]&&(Ji.store[t]=[null,null]),Ji.store[t]}static getFirst(t){return Ji.get(t)[0]}static getLast(t){return Ji.get(t)[1]}static remove(t){delete Ji.store[t]}static isEmpty(t){const e=Ji.get(t);return null===e[0]&&null===e[1]}}class Yi extends Vi{bell;contentType;queued;constructor(t){super(".onesignal-bell-launcher-message","onesignal-bell-launcher-message-opened",void 0,"hidden",["opacity","transform"],".onesignal-bell-launcher-message-body"),this.bell=t,this.contentType="",this.queued=[]}static get TIMEOUT(){return 2500}static get TYPES(){return{TIP:"tip",MESSAGE:"message",QUEUED:"queued"}}display(t,e,i=0){return kt.m(`Calling display(${t}, ${e}, ${i}).`),(this.shown?this.hide():vt()).then(()=>{this.content=mi(e),this.contentType=t}).then(()=>this.show()).then(()=>St(i)).then(()=>this.hide()).then(()=>{this.content=this.getTipForState(),this.contentType="tip"})}getTipForState(){return this.bell.state===en.STATES.UNSUBSCRIBED?this.bell.options.text["tip.state.unsubscribed"]:this.bell.state===en.STATES.SUBSCRIBED?this.bell.options.text["tip.state.subscribed"]:this.bell.state===en.STATES.BLOCKED?this.bell.options.text["tip.state.blocked"]:""}enqueue(t){return this.queued.push(mi(t)),new Promise(t=>{this.bell.badge.shown?this.bell.badge.hide().then(()=>this.bell.badge.increment()).then(()=>this.bell.badge.show()).then(t):(this.bell.badge.increment(),this.bell.initialized?this.bell.badge.show().then(t):t())})}dequeue(t){const e=this.queued.pop(t);return new Promise(t=>{this.bell.badge.shown?this.bell.badge.hide().then(()=>this.bell.badge.decrement()).then(t=>t>0?this.bell.badge.show():Promise.resolve(this)).then(t(e)):(this.bell.badge.decrement(),t(e))})}}class Qi extends qi{events;bell;constructor(t){super(".onesignal-bell-launcher-button",void 0,void 0,"onesignal-bell-launcher-button-active",void 0,"shown",""),this.bell=t,this.events={mouse:"bell.launcher.button.mouse"};const e=this.element;e&&(e.addEventListener("touchstart",()=>{this.onHovering(),this.onTap()},{passive:!0}),e.addEventListener("mouseenter",()=>{this.onHovering()}),e.addEventListener("mouseleave",()=>{this.onHovered()}),e.addEventListener("touchmove",()=>{this.onHovered()},{passive:!0}),e.addEventListener("mousedown",()=>{this.onTap()}),e.addEventListener("mouseup",()=>{this.onEndTap()}),e.addEventListener("click",()=>{this.onHovered(),this.onClick()}))}onHovering(){(Ji.isEmpty(this.events.mouse)||"out"===Ji.getLast(this.events.mouse))&&Di.trigger(en.EVENTS.HOVERING),Ji.put(this.events.mouse,"over")}onHovered(){Ji.put(this.events.mouse,"out"),Di.trigger(en.EVENTS.HOVERED)}onTap(){this.pulse(),this.activate(),this.bell.badge.activate()}onEndTap(){this.inactivate(),this.bell.badge.inactivate()}onClick(){if(Di.trigger(en.EVENTS.BELL_CLICK),Di.trigger(en.EVENTS.LAUNCHER_CLICK),this.bell.message.shown&&this.bell.message.contentType==Yi.TYPES.MESSAGE)return;const t=Ji.getLast("subscription.optedOut");return this.bell.unsubscribed?t?this.bell.launcher.activateIfInactive().then(()=>{this.bell.showDialogProcedure()}):(Vs(),this.bell.N=!0,OneSignal.emitter.once(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,()=>{this.bell.message.display(Yi.TYPES.MESSAGE,this.bell.options.text["message.action.subscribed"],Yi.TIMEOUT).then(()=>{this.bell.N=!1,this.bell.launcher.inactivate()})})):(this.bell.subscribed||this.bell.blocked)&&this.bell.launcher.activateIfInactive().then(()=>{this.bell.showDialogProcedure()}),this.bell.message.hide()}pulse(){di(".pulse-ring"),this.element&&hi(this.element,"beforeend",'<div class="pulse-ring"></div>'),this.bell.setCustomColorsIfSpecified()}}const Zi=new URL("https://media.onesignal.com/web-sdk");class Xi extends Vi{bell;subscribeButtonId;unsubscribeButtonId;notificationIcons;constructor(t){super(".onesignal-bell-launcher-dialog","onesignal-bell-launcher-dialog-opened",void 0,"hidden",["opacity","transform"],".onesignal-bell-launcher-dialog-body"),this.bell=t,this.subscribeButtonId="#onesignal-bell-container .onesignal-bell-launcher #subscribe-button",this.unsubscribeButtonId="#onesignal-bell-container .onesignal-bell-launcher #unsubscribe-button",this.notificationIcons=null}show(){return this.updateBellLauncherDialogBody().then(()=>super.show())}get subscribeButtonSelectorId(){return"subscribe-button"}get unsubscribeButtonSelectorId(){return"unsubscribe-button"}get subscribeButton(){return this.element?this.element.querySelector("#"+this.subscribeButtonSelectorId):null}get unsubscribeButton(){return this.element?this.element.querySelector("#"+this.unsubscribeButtonSelectorId):null}updateBellLauncherDialogBody(){return OneSignal.context.A.isPushNotificationsEnabled().then(t=>{this.nestedContentSelector&&function(t){if("string"==typeof t){const e=document.querySelector(t);if(null===e)throw new Error(`Cannot find element with selector "${t}"`);for(;e.firstChild;)e.removeChild(e.firstChild)}else{if("object"!=typeof t)throw new Error(`${t} must be a CSS selector string or DOM Element object.`);for(;t.firstChild;)t.removeChild(t.firstChild)}}(this.nestedContentSelector);let e="Nothing to show.",i="";if(this.bell.options.showCredit&&(i='<div class="divider"></div><div class="kickback">Powered by <a href="https://onesignal.com" class="kickback" target="_blank">OneSignal</a></div>'),this.bell.state===en.STATES.SUBSCRIBED&&!0===t||this.bell.state===en.STATES.UNSUBSCRIBED&&!1===t){let t="";const n=Ni(this.notificationIcons);t="default-icon"!=n?`<div class="push-notification-icon"><img src="${n}"></div>`:'<div class="push-notification-icon push-notification-icon-default"></div>';let s="";s=this.bell.state!==en.STATES.SUBSCRIBED?`<button type="button" class="action" id="${this.subscribeButtonSelectorId}">${this.bell.options.text["dialog.main.button.subscribe"]}</button>`:`<button type="button" class="action" id="${this.unsubscribeButtonSelectorId}">${this.bell.options.text["dialog.main.button.unsubscribe"]}</button>`,e=`<h1>${this.bell.options.text["dialog.main.title"]}</h1><div class="divider"></div><div class="push-notification">${t}<div class="push-notification-text-container"><div class="push-notification-text push-notification-text-short"></div><div class="push-notification-text"></div><div class="push-notification-text push-notification-text-medium"></div><div class="push-notification-text"></div><div class="push-notification-text push-notification-text-medium"></div></div></div><div class="action-container">${s}</div>${i}`}else if(this.bell.state===en.STATES.BLOCKED){let t=null;const n=T();n===y?P()||_()||(t="/bell/chrome-unblock.jpg"):n===O?t="/bell/firefox-unblock.jpg":n===v?t="/bell/safari-unblock.jpg":n===S&&(t="/bell/edge-unblock.png");let s="";t&&(t=Zi+t,s=`<a href="${t}" target="_blank"><img src="${t}"></a></div>`),(P()||_())&&n===y&&(s="<ol><li>Access <strong>Settings</strong> by tapping the three menu dots <strong>⋮</strong></li><li>Click <strong>Site settings</strong> under Advanced.</li><li>Click <strong>Notifications</strong>.</li><li>Find and click this entry for this website.</li><li>Click <strong>Notifications</strong> and set it to <strong>Allow</strong>.</li></ol>"),e=`<h1>${this.bell.options.text["dialog.blocked.title"]}</h1><div class="divider"></div><div class="instructions"><p>${this.bell.options.text["dialog.blocked.message"]}</p>${s}</div>${i}`}this.nestedContentSelector&&hi(this.nestedContentSelector,"beforeend",e),this.subscribeButton&&this.subscribeButton.addEventListener("click",()=>{OneSignal.M=!1,Di.trigger(en.EVENTS.SUBSCRIBE_CLICK)}),this.unsubscribeButton&&this.unsubscribeButton.addEventListener("click",()=>Di.trigger(en.EVENTS.UNSUBSCRIBE_CLICK)),this.bell.setCustomColorsIfSpecified()})}}class tn extends qi{bell;wasInactive;constructor(t){super(".onesignal-bell-launcher","onesignal-bell-launcher-active",void 0,void 0,"onesignal-bell-launcher-inactive","hidden","active"),this.bell=t,this.wasInactive=!1}async resize(t){if(!this.element)throw new Error("Missing DOM element");if("small"===t&&fi(this.element,"onesignal-bell-launcher-sm")||"medium"===t&&fi(this.element,"onesignal-bell-launcher-md")||"large"===t&&fi(this.element,"onesignal-bell-launcher-lg"))return Promise.resolve(this);if(wi(this.element,"onesignal-bell-launcher-sm"),wi(this.element,"onesignal-bell-launcher-md"),wi(this.element,"onesignal-bell-launcher-lg"),"small"===t)pi(this.element,"onesignal-bell-launcher-sm");else if("medium"===t)pi(this.element,"onesignal-bell-launcher-md");else{if("large"!==t)throw new Error("Invalid OneSignal bell size "+t);pi(this.element,"onesignal-bell-launcher-lg")}return this.shown?await new Promise(t=>{if(0==this.targetTransitionEvents.length)return t(this);{const e=setTimeout(()=>{kt.m(`Launcher did not completely resize (state: ${this.state}, activeState: ${this.activeState}).`)},this.transitionCheckTimeout);$i(this.element,"transitionend",(i,n)=>{if(i.target===this.element&&Pt(this.targetTransitionEvents,i.propertyName))return clearTimeout(e),n(),t(this)},!0)}}):this}activateIfInactive(){return this.inactive?(this.wasInactive=!0,this.activate()):vt()}inactivateIfWasInactive(){return this.wasInactive?(this.wasInactive=!1,this.inactivate()):vt()}clearIfWasInactive(){this.wasInactive=!1}inactivate(){return this.bell.message.hide().then(()=>this.bell.badge.content.length>0?this.bell.badge.hide().then(()=>Promise.all([super.inactivate(),this.resize("small")])).then(()=>this.bell.badge.show()):Promise.all([super.inactivate(),this.resize("small")]))}activate(){return this.bell.badge.content.length>0?this.bell.badge.hide().then(()=>Promise.all([super.activate(),this.resize(this.bell.options.size)])):Promise.all([super.activate(),this.resize(this.bell.options.size)])}}class en{options;state=en.STATES.UNINITIALIZED;N=!1;hovering=!1;initialized=!1;D;U;B;L;R;DEFAULT_SIZE="medium";DEFAULT_POSITION="bottom-right";DEFAULT_THEME="default";static get EVENTS(){return{STATE_CHANGED:"notifyButtonStateChange",LAUNCHER_CLICK:"notifyButtonLauncherClick",BELL_CLICK:"notifyButtonButtonClick",SUBSCRIBE_CLICK:"notifyButtonSubscribeClick",UNSUBSCRIBE_CLICK:"notifyButtonUnsubscribeClick",HOVERING:"notifyButtonHovering",HOVERED:"notifyButtonHover"}}static get STATES(){return{UNINITIALIZED:"uninitialized",SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed",BLOCKED:"blocked"}}static get TEXT_SUBS(){return{"prompt.native.grant":{default:"Allow",chrome:"Allow",firefox:"Always Receive Notifications",safari:"Allow"}}}constructor(t,e){this.options={enable:t.enable||!1,size:t.size||this.DEFAULT_SIZE,position:t.position||this.DEFAULT_POSITION,theme:t.theme||this.DEFAULT_THEME,showLauncherAfter:t.showLauncherAfter||10,showBadgeAfter:t.showBadgeAfter||300,text:this.setDefaultTextOptions(t.text||{}),prenotify:t.prenotify,showCredit:t.showCredit,colors:t.colors,offset:t.offset},e&&(this.D=e),this.options.enable&&(this.validateOptions(this.options),this.state=en.STATES.UNINITIALIZED,this.N=!1,this.installEventHooks(),this.updateState())}showDialogProcedure(){this.dialog.shown||this.dialog.show().then(()=>{$i(document,"click",(t,e)=>{this.dialog.element.contains(t.target)||(e(),this.dialog.shown&&this.dialog.hide().then(()=>{this.launcher.inactivateIfWasInactive()}))},!0)})}validateOptions(t){if(!t.size||!Pt(["small","medium","large"],t.size))throw new Error(`Invalid size ${t.size} for notify button. Choose among 'small', 'medium', or 'large'.`);if(!t.position||!Pt(["bottom-left","bottom-right"],t.position))throw new Error(`Invalid position ${t.position} for notify button. Choose either 'bottom-left', or 'bottom-right'.`);if(!t.theme||!Pt(["default","inverse"],t.theme))throw new Error(`Invalid theme ${t.theme} for notify button. Choose either 'default', or 'inverse'.`);if(!t.showLauncherAfter||t.showLauncherAfter<0)throw new Error(`Invalid delay duration of ${this.options.showLauncherAfter} for showing the notify button. Choose a value above 0.`);if(!t.showBadgeAfter||t.showBadgeAfter<0)throw new Error(`Invalid delay duration of ${this.options.showBadgeAfter} for showing the notify button's badge. Choose a value above 0.`)}setDefaultTextOptions(t){return{"tip.state.unsubscribed":t["tip.state.unsubscribed"]||"Subscribe to notifications","tip.state.subscribed":t["tip.state.subscribed"]||"You're subscribed to notifications","tip.state.blocked":t["tip.state.blocked"]||"You've blocked notifications","message.prenotify":t["message.prenotify"]||"Click to subscribe to notifications","message.action.subscribed":t["message.action.subscribed"]||"Thanks for subscribing!","message.action.resubscribed":t["message.action.resubscribed"]||"You're subscribed to notifications","message.action.subscribing":t["message.action.subscribing"]||"Click <strong>{{prompt.native.grant}}</strong> to receive notifications","message.action.unsubscribed":t["message.action.unsubscribed"]||"You won't receive notifications again","dialog.main.title":t["dialog.main.title"]||"Manage Site Notifications","dialog.main.button.subscribe":t["dialog.main.button.subscribe"]||"SUBSCRIBE","dialog.main.button.unsubscribe":t["dialog.main.button.unsubscribe"]||"UNSUBSCRIBE","dialog.blocked.title":t["dialog.blocked.title"]||"Unblock Notifications","dialog.blocked.message":t["dialog.blocked.message"]||"Follow these instructions to allow notifications:"}}installEventHooks(){OneSignal.emitter.on(en.EVENTS.SUBSCRIBE_CLICK,()=>{this.dialog.subscribeButton.disabled=!0,this.N=!0,OneSignal.User.PushSubscription.optIn().then(()=>(this.dialog.subscribeButton.disabled=!1,this.dialog.hide())).then(()=>this.message.display(Yi.TYPES.MESSAGE,this.options.text["message.action.resubscribed"],Yi.TIMEOUT)).then(()=>(this.N=!1,this.launcher.clearIfWasInactive(),this.launcher.inactivate())).then(()=>this.updateState()).catch(t=>{throw t})}),OneSignal.emitter.on(en.EVENTS.UNSUBSCRIBE_CLICK,()=>{this.dialog.unsubscribeButton.disabled=!0,OneSignal.User.PushSubscription.optOut().then(()=>(this.dialog.unsubscribeButton.disabled=!1,this.dialog.hide())).then(()=>(this.launcher.clearIfWasInactive(),this.launcher.activate())).then(()=>this.message.display(Yi.TYPES.MESSAGE,this.options.text["message.action.unsubscribed"],Yi.TIMEOUT)).then(()=>this.updateState())}),OneSignal.emitter.on(en.EVENTS.HOVERING,()=>{this.hovering=!0,this.launcher.activateIfInactive(),this.message.shown||this.dialog.shown?this.hovering=!1:this.message.contentType!==Yi.TYPES.MESSAGE?new Promise(t=>{if(this.message.queued.length>0)return this.message.dequeue().then(e=>{this.message.content=e,this.message.contentType=Yi.TYPES.QUEUED,t()});this.message.content=mi(this.message.getTipForState()),this.message.contentType=Yi.TYPES.TIP,t()}).then(()=>this.message.show()).then(()=>{this.hovering=!1}).catch(t=>{kt.O(t)}):this.hovering=!1}),OneSignal.emitter.on(en.EVENTS.HOVERED,()=>{this.message.contentType!==Yi.TYPES.MESSAGE&&this.dialog.hidden&&(this.hovering&&(this.hovering=!1,this.message.waitUntilShown().then(()=>St(Yi.TIMEOUT)).then(()=>this.message.hide()).then(()=>{this.launcher.wasInactive&&this.dialog.hidden&&(this.launcher.inactivate(),this.launcher.wasInactive=!1)})),this.message.shown&&this.message.hide().then(()=>{this.launcher.wasInactive&&this.dialog.hidden&&(this.launcher.inactivate(),this.launcher.wasInactive=!1)}))}),OneSignal.emitter.on(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,async t=>{if(t.current.optedIn&&(this.badge.shown&&this.options.prenotify&&this.badge.hide(),null===this.dialog.notificationIcons)){const t=await Wi.getNotificationIcons();this.dialog.notificationIcons=t}const e=await OneSignal.context.$.getPermissionStatus();let i;i=t.current.optedIn?en.STATES.SUBSCRIBED:"denied"===e?en.STATES.BLOCKED:en.STATES.UNSUBSCRIBED,this.setState(i,this.N)}),OneSignal.emitter.on(en.EVENTS.STATE_CHANGED,t=>{this.launcher.element&&(t.to===en.STATES.SUBSCRIBED?this.launcher.inactivate():this.launcher.activate())}),OneSignal.emitter.on(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,()=>{this.updateState()})}addDefaultClasses(){const t=this.container;if("bottom-left"===this.options.position)t&&pi(t,"onesignal-bell-container-bottom-left"),pi(this.launcher.selector,"onesignal-bell-launcher-bottom-left");else{if("bottom-right"!==this.options.position)throw new Error(`Invalid OneSignal notify button position ${this.options.position}`);t&&pi(t,"onesignal-bell-container-bottom-right"),pi(this.launcher.selector,"onesignal-bell-launcher-bottom-right")}if("default"===this.options.theme)pi(this.launcher.selector,"onesignal-bell-launcher-theme-default");else{if("inverse"!==this.options.theme)throw new Error(`Invalid OneSignal notify button theme ${this.options.theme}`);pi(this.launcher.selector,"onesignal-bell-launcher-theme-inverse")}}async create(){if(!this.options.enable)return;if(await OneSignal.context.W.loadSdkStylesheet()!==Ki)return void kt.m("Not showing notify button because styles failed to load.");this.container&&di("#onesignal-bell-container"),hi("body","beforeend",'<div id="onesignal-bell-container" class="onesignal-bell-container onesignal-reset"></div>'),this.container&&hi(this.container,"beforeend",'<div id="onesignal-bell-launcher" class="onesignal-bell-launcher"></div>'),hi(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-button"></div>'),hi(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-badge"></div>'),hi(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-message"></div>'),hi(this.message.selector,"beforeend",'<div class="onesignal-bell-launcher-message-body"></div>'),hi(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-dialog"></div>'),hi(this.dialog.selector,"beforeend",'<div class="onesignal-bell-launcher-dialog-body"></div>'),hi(this.button.selector,"beforeend",'<svg class="onesignal-bell-svg" xmlns="http://www.w3.org/2000/svg" width="99.7" height="99.7" viewBox="0 0 99.7 99.7"><circle class="background" cx="49.9" cy="49.9" r="49.9"/><path class="foreground" d="M50.1 66.2H27.7s-2-.2-2-2.1c0-1.9 1.7-2 1.7-2s6.7-3.2 6.7-5.5S33 52.7 33 43.3s6-16.6 13.2-16.6c0 0 1-2.4 3.9-2.4 2.8 0 3.8 2.4 3.8 2.4 7.2 0 13.2 7.2 13.2 16.6s-1 11-1 13.3c0 2.3 6.7 5.5 6.7 5.5s1.7.1 1.7 2c0 1.8-2.1 2.1-2.1 2.1H50.1zm-7.2 2.3h14.5s-1 6.3-7.2 6.3-7.3-6.3-7.3-6.3z"/><ellipse class="stroke" cx="49.9" cy="49.9" rx="37.4" ry="36.9"/></svg>');const t=await OneSignal.context.A.isPushNotificationsEnabled();Ei.wasPromptOfTypeDismissed(bi);const e=t?"small":this.options.size||this.DEFAULT_SIZE;await this.launcher.resize(e),this.addDefaultClasses(),this.applyOffsetIfSpecified(),this.setCustomColorsIfSpecified(),this.addBadgeShadow(),kt.S("Showing the notify button."),await(t?this.launcher.inactivate():vt()).then(()=>t&&null===this.dialog.notificationIcons?Wi.getNotificationIcons().then(t=>{this.dialog.notificationIcons=t}):vt()).then(()=>St(this.options.showLauncherAfter||0)).then(()=>this.launcher.show()).then(()=>St(this.options.showBadgeAfter||0)).then(()=>this.options.prenotify&&!t&&OneSignal.k?this.message.enqueue(this.options.text["message.prenotify"]).then(()=>this.badge.show()):vt()).then(()=>this.initialized=!0)}addBadgeShadow(){const t="drop-shadow(0 2px 4px rgba(34,36,38,0.35));",e="drop-shadow(0 2px 4px rgba(34,36,38,0));",i="drop-shadow(0px 2px 2px rgba(34,36,38,.15));";this.graphic.setAttribute("style",`filter: ${t}; -webkit-filter: ${t};`),this.badge.element.setAttribute("style",`filter: ${e}; -webkit-filter: ${e};`),this.dialog.element.setAttribute("style",`filter: ${i}; -webkit-filter: ${i};`)}applyOffsetIfSpecified(){const t=this.options.offset;if(t){const e=this.launcher.element;if(!e)return void kt.O("Could not find bell dom element");e.style.cssText="",t.bottom&&(e.style.cssText+=`bottom: ${t.bottom};`),"bottom-right"===this.options.position?t.right&&(e.style.cssText+=`right: ${t.right};`):"bottom-left"===this.options.position&&t.left&&(e.style.cssText+=`left: ${t.left};`)}}setCustomColorsIfSpecified(){const t=this.dialog.element.querySelector("button.action"),e=this.button.element.querySelector(".pulse-ring");this.graphic.querySelector(".background").style.cssText="";const i=this.graphic.querySelectorAll(".foreground");for(let n=0;n<i.length;n++){i[n].style.cssText=""}if(this.graphic.querySelector(".stroke").style.cssText="",this.badge.element.style.cssText="",t&&(t.style.cssText="",t.style.cssText=""),e&&(e.style.cssText=""),this.options.colors){const i=this.options.colors;if(i["circle.background"]&&(this.graphic.querySelector(".background").style.cssText+=`fill: ${i["circle.background"]}`),i["circle.foreground"]){const t=this.graphic.querySelectorAll(".foreground");for(let e=0;e<t.length;e++){t[e].style.cssText+=`fill: ${i["circle.foreground"]}`}this.graphic.querySelector(".stroke").style.cssText+=`stroke: ${i["circle.foreground"]}`}i["badge.background"]&&(this.badge.element.style.cssText+=`background: ${i["badge.background"]}`),i["badge.bordercolor"]&&(this.badge.element.style.cssText+=`border-color: ${i["badge.bordercolor"]}`),i["badge.foreground"]&&(this.badge.element.style.cssText+=`color: ${i["badge.foreground"]}`),t&&(i["dialog.button.background"]&&(this.dialog.element.querySelector("button.action").style.cssText+=`background: ${i["dialog.button.background"]}`),i["dialog.button.foreground"]&&(this.dialog.element.querySelector("button.action").style.cssText+=`color: ${i["dialog.button.foreground"]}`),i["dialog.button.background.hovering"]&&this.addCssToHead("onesignal-background-hover-style",`#onesignal-bell-container.onesignal-reset .onesignal-bell-launcher .onesignal-bell-launcher-dialog button.action:hover { background: ${i["dialog.button.background.hovering"]} !important; }`),i["dialog.button.background.active"]&&this.addCssToHead("onesignal-background-active-style",`#onesignal-bell-container.onesignal-reset .onesignal-bell-launcher .onesignal-bell-launcher-dialog button.action:active { background: ${i["dialog.button.background.active"]} !important; }`)),e&&i["pulse.color"]&&(this.button.element.querySelector(".pulse-ring").style.cssText=`border-color: ${i["pulse.color"]}`)}}addCssToHead(t,e){if(document.getElementById(t))return;const i=document.createElement("style");i.id=t,i.type="text/css",i.appendChild(document.createTextNode(e)),document.head.appendChild(i)}updateState(){Promise.all([OneSignal.context.A.isPushNotificationsEnabled(),OneSignal.context.$.getPermissionStatus()]).then(([t,e])=>{this.setState(t?en.STATES.SUBSCRIBED:en.STATES.UNSUBSCRIBED),"denied"===e&&this.setState(en.STATES.BLOCKED)}).catch(t=>{kt.O(t)})}setState(t,e=!1){const i=this.state;this.state=t,i===t||e||Di.trigger(en.EVENTS.STATE_CHANGED,{from:i,to:t})}get container(){return document.querySelector("#onesignal-bell-container")}get graphic(){return this.button.element.querySelector("svg")}get launcher(){return this.D||(this.D=new tn(this)),this.D}get button(){return this.U||(this.U=new Qi(this)),this.U}get badge(){return this.B||(this.B=new Gi),this.B}get message(){return this.L||(this.L=new Yi(this)),this.L}get dialog(){return this.R||(this.R=new Xi(this)),this.R}get subscribed(){return this.state===en.STATES.SUBSCRIBED}get unsubscribed(){return this.state===en.STATES.UNSUBSCRIBED}get blocked(){return this.state===en.STATES.BLOCKED}}const nn="slidedown-body",sn="onesignal-button-indicator-holder",on="onesignal-slidedown-container",an="onesignal-slidedown-dialog",rn="slidedown-footer",cn="onesignal-reset",ln="onesignal-saving-state-button",un="slide-up",hn="slide-down",dn="close-slidedown",gn="slidedown-body-icon",pn="slidedown-body-message",wn="default-icon",fn="onesignal-loading-container",mn="clearfix",bn="onesignal-toast-text",yn="onesignal-toast-text",Sn="onesignal-slidedown-allow-button",vn="slidedown-body",On="onesignal-button-indicator-holder",In="onesignal-slidedown-cancel-button",kn="onesignal-slidedown-container",xn="onesignal-slidedown-dialog",Cn="slidedown-footer",En="normal-slidedown",_n="onesignal-loading-container",Pn="align-right",$n="primary",Tn="secondary",Nn="slidedown-button",An="onesignal-category-label-input",Mn="onesignal-category-label-text",Dn="onesignal-category-label",Un="onesignal-checkmark",Bn="tagging-container",Ln="tagging-container-col",Rn="onesignal-loading-message",Wn="tagging-container",Fn="#95A1AC",jn="#FFFFFF",Kn="Fetching your preferences",zn="channel-capture-container",Hn="input-with-validation-element",Vn="onesignal-error-input",qn="iti-onesignal-sms-input",Gn="onesignal-email-input",Jn="onesignal-validation-element-hidden",Yn="onesignal-validation-element",Qn="sms-input-with-validation-element",Zn="email-input-with-validation-element",Xn="iti-onesignal-sms-input",ts="onesignal-email-input",es="onesignal-sms-validation-element",is="onesignal-email-validation-element",ns="onesignal-customlink-subscribe",ss="onesignal-customlink-explanation",os="onesignal-reset",as="hide",rs={subscribed:"state-subscribed",unsubscribed:"state-unsubscribed"},cs={containerSelector:`.${"onesignal-customlink-container"}`};class ls{config;constructor(t){this.config=t}async initialize(){if(!this.config?.enabled)return;if(!(await this.loadSdkStyles()))return;kt.S("OneSignal: initializing customlink");const t=await OneSignal.context.A.isPushNotificationsEnabled();if(this.config?.unsubscribeEnabled||!t)for(let e=0;e<this.customlinkContainerElements.length;e++)await this.injectMarkup(this.customlinkContainerElements[e]);else this.hideCustomLinkContainers()}async injectMarkup(t){t.innerHTML="",await this.mountExplanationNode(t),await this.mountSubscriptionNode(t)}async mountExplanationNode(t){if(this.config?.text){if(this.config.text.explanation){const e=document.createElement("p");e.textContent=this.config.text.explanation,pi(e,os),pi(e,ss),this.config.size&&pi(e,this.config.size),await OneSignal.context.A.isPushNotificationsEnabled()?pi(e,rs.subscribed):pi(e,rs.unsubscribed),t.appendChild(e)}}else kt.O("CustomLink: required property 'text' is missing in the config")}async mountSubscriptionNode(t){if(this.config?.text){if(this.config.text.subscribe){const e=document.createElement("button");pi(e,os),pi(e,ns),this.config.size&&pi(e,this.config.size),this.config.style&&pi(e,this.config.style),await OneSignal.context.A.isPushNotificationsEnabled()?pi(e,rs.subscribed):pi(e,rs.unsubscribed),this.setCustomColors(e),await this.setTextFromPushStatus(e),e.addEventListener("click",async()=>{kt.S("CustomLink: subscribe clicked"),await this.handleClick(e)}),e.setAttribute("type","button"),t.appendChild(e)}}else kt.O("CustomLink: required property 'text' is missing in the config")}async loadSdkStyles(){return await OneSignal.context.W.loadSdkStylesheet()===Ki||(kt.m("Not initializing custom link button because styles failed to load."),!1)}hideElement(t){pi(t,as)}hideCustomLinkContainers(){this.customlinkContainerElements.forEach(t=>{this.hideElement(t)})}async handleClick(t){if(!OneSignal.User.PushSubscription.optedIn)return await OneSignal.User.PushSubscription.optIn(),void(this.config?.unsubscribeEnabled||this.hideCustomLinkContainers());await OneSignal.User.PushSubscription.optOut(),await this.setTextFromPushStatus(t)}async setTextFromPushStatus(t){this.config?.text?.subscribe&&(await OneSignal.context.A.isPushNotificationsEnabled()||(t.textContent=this.config.text.subscribe)),this.config?.text?.unsubscribe&&await OneSignal.context.A.isPushNotificationsEnabled()&&(t.textContent=this.config.text.unsubscribe)}setCustomColors(t){this.config?.color&&this.config.color.text&&("button"===this.config?.style&&this.config?.color.button?(t.style.backgroundColor=this.config?.color.button,t.style.color=this.config?.color.text):"link"===this.config?.style&&(t.style.color=this.config?.color.text))}get customlinkContainerElements(){const t=document.querySelectorAll(cs.containerSelector);return Array.prototype.slice.call(t)}}const us=0,hs=1,ds="onesignal-pageview-count";let gs=!1;function ps(){try{const t=sessionStorage.getItem(ds),e=t?parseInt(t):0;return isNaN(e)?0:e}catch(t){return 0}}function ws(){if(gs)return;const t=ps()+1,e=ni()+1;!function(t){try{sessionStorage.setItem(ds,t.toString())}catch(e){}}(t),function(t){localStorage.setItem(ti,t.toString())}(e),gs=!0,kt.m(`Incremented page view count: newCountSingleTab: ${t},\n      newCountAccrossTabs: ${e}.`)}function fs(){return 1===ps()}class ms{}const bs={LOCAL_PREFIX:"local-",F(){return`${this.LOCAL_PREFIX}${crypto.randomUUID()}`},j(t){return t?.startsWith(this.LOCAL_PREFIX)??!1}};function ys(t){return void 0!==t?.type&&void 0!==t?.id}class Ss extends ms{K;H;V;q;constructor(t,e,i){super(),t&&e?(this.V=!e.optedOut,this.q=i,this.H=e.subscriptionToken,OneSignal.G.getPushSubscriptionModel().then(t=>{ys(t)&&(this.K=t.id)}).catch(t=>{kt.O(t)}),OneSignal.emitter.on(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,async t=>{this.K=t?.current.id,this.H=t?.current.token}),OneSignal.emitter.on(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,async t=>{this.q=t})):kt.v(`PushSubscriptionNamespace: skipping initialization. One or more required params are falsy: initialize: ${t}, subscription: ${e}`)}get id(){return bs.j(this.K)?void 0:this.K}get token(){return this.H}get optedIn(){return!!this.V&&"granted"===this.q}async optIn(){Pi("optIn"),await _i(),this.V=!0;"granted"===await OneSignal.context.$.getPermissionStatus()?await this.J(!0):await OneSignal.Notifications.requestPermission()}async optOut(){Pi("optOut"),await _i(),this.V=!1,await this.J(!1)}addEventListener(t,e){OneSignal.emitter.on(t,e)}removeEventListener(t,e){OneSignal.emitter.off(t,e)}async J(t){await _i();const e=await si(),i=await li();if(!e.appId)throw ct;if("boolean"!=typeof t)throw wt("enabled");i.optedOut=!t,await ui(i),async function(t){Ji.put("subscription.optedOut",t)}(i.optedOut).catch(t=>{kt.O(t)}),Rs().catch(t=>{kt.O(t)})}}const vs="NORMAL",Os="NO_PROPAGATE",Is="HYDRATE";class ks{subscribers=[];get hasSubscribers(){return this.subscribers.length>0}subscribe(t){this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.indexOf(t);-1!==e&&this.subscribers.splice(e,1)}subscribeAll(t){for(const e of t.subscribers)this.subscribe(e)}fire(t){for(const e of this.subscribers)t(e)}async suspendingFire(t){for(const e of this.subscribers)await t(e)}}class xs{modelId;data=new Map;changeNotifier=new ks;constructor(){this.modelId=Math.random().toString(36).substring(2)}initializeFromJson(t){const{modelId:e,modelName:i,...n}=t;this.data.clear(),this.data=new Map(Object.entries(n)),e&&(this.modelId=e)}initializeFromModel(t,e){const i=new Map;e.data.forEach((t,e)=>{i.set(e,t)}),null!==t&&(this.modelId=t),this.data.clear(),this.data=i}setProperty(t,e,i=vs,n=!1){const s=this.data.get(t);(s!==e||n)&&(void 0!==e?this.data.set(t,e):this.data.has(t)&&this.data.delete(t),this.notifyChanged(t,i,s,e))}hasProperty(t){return this.data.has(t)}getProperty(t,e){return this.data.get(t)??e}notifyChanged(t,e,i,n){const s={model:this,property:t,oldValue:i,newValue:n};this.changeNotifier.fire(t=>t.onChanged(s,e))}toJSON(){return Object.fromEntries(this.data.entries())}subscribe(t){return this.changeNotifier.subscribe(t)}unsubscribe(t){this.changeNotifier.unsubscribe(t)}get hasSubscribers(){return this.changeNotifier.hasSubscribers}mergeData(t){for(const[e,i]of Object.entries(t))this.data.set(e,i)}}class Cs extends xs{constructor(){super(),this.sdk=M,this.device_model=z(),this.device_os=K()}get onesignalId(){return this.getProperty("onesignalId")}set onesignalId(t){this.setProperty("onesignalId",t)}get id(){return this.getProperty("id")}set id(t){this.setProperty("id",t)}get enabled(){return this.getProperty("enabled")}set enabled(t){this.setProperty("enabled",t)}get type(){return this.getProperty("type")}set type(t){this.setProperty("type",t)}get token(){return this.getProperty("token")}set token(t){this.setProperty("token",t)}get notification_types(){return this.getProperty("notification_types")}set notification_types(t){this.setProperty("notification_types",t)}get sdk(){return this.getProperty("sdk")}set sdk(t){this.setProperty("sdk",t)}get device_model(){return this.getProperty("device_model")}set device_model(t){this.setProperty("device_model",t)}get device_os(){return this.getProperty("device_os")}set device_os(t){this.setProperty("device_os",t)}get web_auth(){return this.getProperty("web_auth")}set web_auth(t){this.setProperty("web_auth",t)}get web_p256(){return this.getProperty("web_p256")}set web_p256(t){this.setProperty("web_p256",t)}}const Es=0,_s=1,Ps=2;class $s extends xs{constructor(t,e,i){super(),this.name=t,e&&(this.appId=e),i&&(this.onesignalId=i)}get name(){return this.getProperty("name")}set name(t){this.setProperty("name",t)}get appId(){return this.getProperty("appId")}set appId(t){this.setProperty("appId",t)}get onesignalId(){return this.getProperty("onesignalId")}set onesignalId(t){this.setProperty("onesignalId",t)}get applyToRecordId(){return this.onesignalId}get createComparisonKey(){return""}get groupComparisonType(){return _s}get canStartExecute(){return!bs.j(this.onesignalId)}translateIds(t){t[this.onesignalId]&&(this.onesignalId=t[this.onesignalId])}toString(){return JSON.stringify(this.toJSON())}}class Ts extends $s{constructor(t,e,i,n){super(J,t,e),i&&(this.externalId=i),n&&(this.existingOnesignalId=n)}get externalId(){return this.getProperty("externalId")}set externalId(t){this.setProperty("externalId",t)}get existingOnesignalId(){return this.getProperty("existingOnesignalId")}set existingOnesignalId(t){this.setProperty("existingOnesignalId",t)}get createComparisonKey(){return`${this.appId}.User.${this.onesignalId}`}get modifyComparisonKey(){return""}get groupComparisonType(){return Es}get canStartExecute(){return!this.existingOnesignalId||!bs.j(this.existingOnesignalId)}get applyToRecordId(){return this.existingOnesignalId??this.onesignalId}translateIds(t){this.existingOnesignalId&&t[this.existingOnesignalId]&&(this.existingOnesignalId=t[this.existingOnesignalId])}}class Ns{static singletonInstance;static createOrGetInstance(){if(!Ns.singletonInstance){Ns.singletonInstance=new Ns;const t=OneSignal.G.Y(),e=OneSignal.G.Z(),i=t.onesignalId??bs.F();t.onesignalId||t.setProperty(it,i,Os),e.onesignalId||e.setProperty("onesignalId",i,Os)}return Ns.singletonInstance}get onesignalId(){const t=OneSignal.G.Y().onesignalId;return bs.j(t)?void 0:t}validateStringLabel(t,e){if("string"!=typeof t)throw ft(e);if(!t)throw pt(e)}validateArray(t,e){if(!Array.isArray(t))throw ft(e);if(0===t.length)throw pt(e);for(const i of t)this.validateLabel(i,"label")}validateObject(t,e){if(!mt(t))throw ft(e);if(!t||0===Object.keys(t).length)throw pt(e)}validateLabel(t,e){if(this.validateStringLabel(t,e),"external_id"===t||"onesignal_id"===t)throw new Error(`"${t}" is reserved`)}updateIdentityModel(t){const e=OneSignal.G.Y();Object.keys(t).forEach(i=>{e.setProperty(i,t[i])})}addAlias(t,e){Pi("addAlias",{label:t,id:e}),ri()||(this.validateStringLabel(t,"label"),this.validateStringLabel(e,"id"),this.addAliases({[t]:e}))}addAliases(t){if(Pi("addAliases",{aliases:t}),!ri()){this.validateObject(t,"aliases");for(const e of Object.keys(t))this.validateStringLabel(t[e],`key: ${e}`),this.validateLabel(e,`key: ${e}`);this.updateIdentityModel(t)}}removeAlias(t){Pi("removeAlias",{label:t}),ri()||this.removeAliases([t])}removeAliases(t){if(Pi("removeAliases",{aliases:t}),ri())return;this.validateArray(t,"aliases");const e=Object.fromEntries(t.map(t=>[t,void 0]));this.updateIdentityModel(e)}addEmail(t){if(Pi("addEmail",{email:t}),!ri()){if(this.validateStringLabel(t,"email"),!function(t){return!!t&&!!t.match(/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/)}(t))throw wt("email");Ms({type:l,token:t})}}addSms(t){Pi("addSms",{sms:t}),ri()||(this.validateStringLabel(t,"sms"),Ms({type:u,token:t}))}removeEmail(t){if(Pi("removeEmail",{email:t}),ri())return;this.validateStringLabel(t,"email");OneSignal.G.getEmailSubscriptionModels().forEach(e=>{e.token===t&&OneSignal.G.removeSubscriptionModel(e.modelId)})}removeSms(t){if(Pi("removeSms",{smsNumber:t}),ri())return;this.validateStringLabel(t,"smsNumber");OneSignal.G.getSmsSubscriptionModels().forEach(e=>{e.token===t&&OneSignal.G.removeSubscriptionModel(e.modelId)})}addTag(t,e){Pi("addTag",{key:t,value:e}),ri()||(this.validateStringLabel(t,"key"),this.validateStringLabel(e,"value"),this.addTags({[t]:e}))}addTags(t){if(ri())return;const e=OneSignal.G.Z(),i={...e.tags,...t};e.tags=i}removeTag(t){Pi("removeTag",{tagKey:t}),ri()||(this.validateStringLabel(t,"tagKey"),this.removeTags([t]))}removeTags(t){if(Pi("removeTags",{tagKeys:t}),ri())return;this.validateArray(t,"tagKeys");const e=OneSignal.G.Z(),i={...e.tags};t.forEach(t=>{i[t]=""}),e.tags=i}getTags(){return Pi("getTags"),OneSignal.G.Z().tags}setLanguage(t){if(Pi("setLanguage",{language:t}),ri())return;this.validateStringLabel(t,"language");OneSignal.G.Z().language=t}getLanguage(){return Pi("getLanguage"),OneSignal.G.Z().language}trackEvent(t,e={}){if(ri())return;const i=OneSignal.G.Y().onesignalId;!bs.j(i)||As(i)?!function(t){if(!mt(t))return!1;try{return JSON.stringify(t),!0}catch(e){return!1}}(e)?kt.O("Properties must be JSON-serializable"):(Pi("trackEvent",{name:t,properties:e}),OneSignal.G.customEventController.sendCustomEvent({name:t,properties:e})):kt.O("User must be logged in first.")}}function As(t){return OneSignal.G.operationRepo.queue.find(e=>e.operation instanceof Ts&&e.operation.onesignalId===t)}function Ms({type:t,token:e}){if(OneSignal.G.subscriptionModelStore.list().find(i=>i.token===e&&i.type===t))return;const i=OneSignal.G.Y(),n=i.onesignalId;if(bs.j(n)){const t=Wi.getAppId();As(n)||OneSignal.G.operationRepo.enqueue(new Ts(t,n,i.externalId))}const s={id:bs.F(),enabled:!0,notification_types:w,onesignalId:n,token:e,type:t},o=new Cs;o.mergeData(s),OneSignal.G.addSubscriptionModel(o)}class Ds extends ms{X;PushSubscription=new Ss(!1);static tt=new Ai;constructor(t,e,i){super(),t&&(this.X=Ns.createOrGetInstance(),this.PushSubscription=new Ss(!0,e,i))}get onesignalId(){return this.X?.onesignalId}get externalId(){const t=OneSignal.G.Y();return t?.externalId}addAlias(t,e){this.X?.addAlias(t,e)}addAliases(t){this.X?.addAliases(t)}removeAlias(t){this.X?.removeAlias(t)}removeAliases(t){this.X?.removeAliases(t)}addEmail(t){this.X?.addEmail(t)}removeEmail(t){this.X?.removeEmail(t)}addSms(t){this.X?.addSms(t)}removeSms(t){this.X?.removeSms(t)}addTag(t,e){this.X?.addTag(t,e)}addTags(t){this.X?.addTags(t)}removeTag(t){this.X?.removeTag(t)}removeTags(t){this.X?.removeTags(t)}getTags(){return this.X?.getTags()||{}}setLanguage(t){this.X?.setLanguage(t)}getLanguage(){return this.X?.getLanguage()||""}trackEvent(t,e){return this.X?.trackEvent(t,e)}addEventListener(t,e){Ds.tt.on(t,e)}removeEventListener(t,e){Ds.tt.off(t,e)}}class Us{previousOneSignalId;previousExternalId}function Bs(t,e){return t?t.filter(t=>t.type===e)[0]:void 0}function Ls(t){return t===jt||t===Kt}async function Rs(){Pi("checkAndTriggerSubscriptionChanged");const t=OneSignal.context,e=await OneSignal.context.A.isPushNotificationsEnabled(),i=await OneSignal.context.A.isOptedIn(),n=await oi(),{lastKnownPushEnabled:s,lastKnownPushId:o,lastKnownPushToken:a,lastKnownOptedIn:r}=n,c=await Wi.getCurrentPushToken(),l=await OneSignal.G.getPushSubscriptionModel(),u=l?.id;if(!(e!==s||c!==a||u!==o))return;await t.A.updateNotificationTypes(),n.lastKnownPushEnabled=e,n.lastKnownPushToken=c,n.lastKnownPushId=u,n.lastKnownOptedIn=i,await ai(n);const h={previous:{id:o,token:a,optedIn:r??!0},current:{id:u,token:c,optedIn:i}};kt.S("Push Subscription state changed: ",h),function(t){Di.trigger(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,t)}(h)}async function Ws(){Pi("checkAndTriggerUserChanged");const t=await(async()=>{const t=new Us;return t.previousOneSignalId="",t.previousExternalId="",t.previousOneSignalId=await Ze("previousOneSignalId"),t.previousExternalId=await Ze("previousExternalId"),t})(),{previousOneSignalId:e,previousExternalId:i}=t,n=await OneSignal.G.Y(),s=n?.onesignalId,o=n?.externalId;if(!(s!==e||o!==i))return;t.previousOneSignalId=s,t.previousExternalId=o,await(async t=>{await Qe.put("Options",{key:"previousOneSignalId",value:t.previousOneSignalId}),await Qe.put("Options",{key:"previousExternalId",value:t.previousExternalId})})(t);const a={current:{onesignalId:s,externalId:o}};kt.S("User state changed: ",a),function(t){Di.trigger(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,t,Ds.tt)}(a)}async function Fs(t){if(!0!==t)return;const e=OneSignal.context.et.userConfig.promptOptions?.slidedown?.prompts;(function(t){if(!t)return!1;const e=Bs(t,Kt);return!!e&&!!e.categories&&e.categories.length>0})(e)&&await OneSignal.context.it.sendTags()}function js(t){!async function(t,e){if(OneSignal.M)return void kt.m("Not showing welcome notification because user has previously subscribed.");const i=OneSignal.config?.userConfig.welcomeNotification;if(void 0!==i&&!0===i.disable)return;if(!0!==t)return;if(!e)return;let n=void 0!==i&&void 0!==i.title&&null!==i.title?i.title:"",s=void 0!==i&&void 0!==i.message&&null!==i.message&&i.message.length>0?i.message:"Thanks for subscribing!";const o=new URL(location.href).origin+"?_osp=do_not_open",a=i&&i.url&&i.url.length>0?i.url:o;n=mi(n),s=mi(s),kt.m("Sending welcome notification."),Wi.showLocalNotification(n,s,a,void 0,{nt:!0},void 0),Di.trigger(OneSignal.EVENTS.WELCOME_NOTIFICATION_SENT,{title:n,message:s,url:a})}(t?.current?.optedIn,t?.current?.id),Fs(t?.current?.optedIn),async function(){if(!OneSignal.config?.userConfig.notifyButton)return;const t=OneSignal.config.userConfig.notifyButton.displayPredicate;t&&"function"==typeof t&&OneSignal.notifyButton&&(!1!==await t()?(kt.m("Showing notify button because display predicate returned true."),OneSignal.notifyButton.launcher.show()):(kt.m("Hiding notify button because display predicate returned false."),OneSignal.notifyButton.launcher.hide()))}(),OneSignal.config?.userConfig.promptOptions&&new ls(OneSignal.config?.userConfig.promptOptions.customlink).initialize()}class Ks{static async registerForPush(){return await Ks.internalRegisterForPush()}static async internalRegisterForPush(){const t=OneSignal.context;let e=null;try{const i=await t.A.subscribe(us);e=await t.A.st(i),ws(),await Bi(),await Rs()}catch(i){kt.O(i)}return e}static isPushSubscriptionType(t){switch(t){case c:case h:case d:case g:return!0;default:return!1}}static toSubscriptionChannel(t){switch(t){case l:return o;case u:return a;default:return this.isPushSubscriptionType(t)?r:void 0}}}async function zs(){kt.m("Called internalInit()"),await OneSignal.context.T.installWorker();const t=OneSignal.context.ot;OneSignal.emitter.on(OneSignal.EVENTS.SESSION_STARTED,t.sendOnSessionUpdateFromPage.bind(t)),ws(),"visible"===document.visibilityState?await Hs():$i(document,"visibilitychange",(t,e)=>{"visible"===document.visibilityState&&(e(),Hs())},!0)}async function Hs(){if(kt.m("Called sessionInit()"),OneSignal.rt)return void kt.m("Returning from sessionInit because it has already been called.");OneSignal.rt=!0;try{await async function(){const t=[];t.push(async function(){const t=await OneSignal.context.A.isPushNotificationsEnabled(),e=await OneSignal.context.$.getPermissionStatus(),i=await OneSignal.context.A.isOptedOut();Ji.put("subscription.optedOut",i),await Qe.put("Options",{key:"isPushEnabled",value:t}),await Qe.put("Options",{key:"notificationPermission",value:e})}()),t.push(async function(){try{if(navigator.permissions){(await navigator.permissions.query({name:"notifications"})).onchange=function(){Bi()}}}catch(t){kt.v(`Could not install native notification permission change hook w/ error: ${t}`)}}()),t.push(async function(){"granted"===await OneSignal.context.$.getNotificationPermission(OneSignal.context.et.safariWebId)&&(OneSignal.M=!0)}()),t.push(async function(){if(navigator.serviceWorker&&window.isSecureContext)try{await OneSignal.context.T.establishServiceWorkerChannel()}catch(t){kt.O(t)}}()),t.push(async function(){if(!OneSignal.notifyButton){OneSignal.config.userConfig.notifyButton=OneSignal.config.userConfig.notifyButton||{},OneSignal.config.userConfig.bell&&(OneSignal.config.userConfig.bell={...OneSignal.config.userConfig.bell,...OneSignal.config.userConfig.notifyButton},OneSignal.config.userConfig.notifyButton={...OneSignal.config.userConfig.notifyButton,...OneSignal.config.userConfig.bell});const t=OneSignal.config.userConfig.notifyButton.displayPredicate;t&&"function"==typeof t?OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED,async()=>{!1!==await Promise.resolve(OneSignal.config.userConfig.notifyButton.displayPredicate?.())?(OneSignal.notifyButton=new en(OneSignal.config.userConfig.notifyButton),OneSignal.notifyButton.create()):kt.m("Notify button display predicate returned false so not showing the notify button.")}):(OneSignal.notifyButton=new en(OneSignal.config.userConfig.notifyButton),OneSignal.notifyButton.create())}}()),t.push(async function(){const t=OneSignal.config;t.userConfig.promptOptions&&await new ls(t.userConfig.promptOptions.customlink).initialize()}());try{await Promise.all(t)}catch(e){throw kt.O(e),new Error("Unknown init error")}}()}catch(n){if(n instanceof Error)return;throw n}const t=await OneSignal.context.A.isOptedOut()??!1,e=await li();e.optedOut=t,await ui(e),await async function(t){if(kt.S("handleAutoResubscribe",{autoResubscribe:OneSignal.config?.userConfig.autoResubscribe,isOptedOut:t}),OneSignal.config?.userConfig.autoResubscribe&&!t){"granted"==await OneSignal.context.$.getNotificationPermission(OneSignal.context.et.safariWebId)&&await Ks.registerForPush()}}(t);const i=await OneSignal.context.A.isPushNotificationsEnabled();await Qe.put("Options",{key:"isPushEnabled",value:!!i}),OneSignal.config?.userConfig.promptOptions?.autoPrompt&&!t&&OneSignal.context.promptsManager.spawnAutoPrompts(),OneSignal.rt=!1,await Di.trigger(OneSignal.EVENTS.SDK_INITIALIZED)}async function Vs(){await Ks.registerForPush()}async function qs(){const t=await async function(){const t=OneSignal.context;kt.m("Checking subscription expiration...");if(!(await t.A.isSubscriptionExpiring()))return kt.m("Subscription is not considered expired."),!1;kt.m("Subscription is considered expiring.");const e=await t.A.subscribe(hs);return await t.A.st(e),!0}();await OneSignal.context.A.ct()?(OneSignal.context.ot.setupSessionEventListeners(),t||await OneSignal.context.lt.sendOnSessionUpdate()):OneSignal.config?.userConfig.promptOptions?.autoPrompt||OneSignal.config?.userConfig.autoResubscribe||await OneSignal.context.lt.sendOnSessionUpdate(),await Di.trigger(OneSignal.EVENTS.SDK_INITIALIZED_PUBLIC)}class Gs extends xs{get onesignalId(){return this.getProperty(it)}set onesignalId(t){this.setProperty(it,t)}get externalId(){return this.getProperty(et)}set externalId(t){this.setProperty(et,t)}}class Js{modelName;changeSubscription=new ks;models=[];hasLoadedFromCache=!1;constructor(t){this.modelName=t}add(t,e=vs){const i=this.models.find(e=>e.modelId===t.modelId);i&&this.removeItem(i,e),this.addItem(t,e)}addAt(t,e,i=vs){const n=this.models.find(t=>t.modelId===e.modelId);n&&this.removeItem(n,i),this.addItem(e,i,t)}list(){return this.models}get(t){return this.models.find(e=>e.modelId===t)}remove(t,e=vs){const i=this.models.find(e=>e.modelId===t);i&&this.removeItem(i,e)}onChanged(t,e){this.persist(),this.changeSubscription.fire(i=>i.onModelUpdated(t,e))}replaceAll(t,e=vs){this.clear(e);for(const i of t)this.add(i,e)}clear(t=vs){for(const e of this.models)e.unsubscribe(this),this.changeSubscription.fire(i=>i.onModelRemoved(e,t)),Qe.delete(this.modelName,e.modelId);this.models=[]}addItem(t,e,i){void 0!==i?this.models.splice(i,0,t):this.models.push(t),t.subscribe(this),this.persist(),this.changeSubscription.fire(i=>i.onModelAdded(t,e))}async removeItem(t,e){const i=this.models.findIndex(e=>e.modelId===t.modelId);-1!==i&&this.models.splice(i,1),t.unsubscribe(this),await Qe.delete(this.modelName,t.modelId),this.persist(),this.changeSubscription.fire(i=>i.onModelRemoved(t,e))}async load(){if(!this.modelName)return;const t=await Qe.getAll(this.modelName),e=this.models.length>0;for(let i=t.length-1;i>=0;i--){const e=this.create(t[i]);e&&(this.models.unshift(e),e.subscribe(this))}this.hasLoadedFromCache=!0,e&&this.persist()}async persist(){if(this.modelName&&this.hasLoadedFromCache)for(const t of this.models)await Qe.put(this.modelName,{modelId:t.modelId,modelName:this.modelName,...t.toJSON()})}subscribe(t){this.changeSubscription.subscribe(t)}unsubscribe(t){this.changeSubscription.unsubscribe(t)}get hasSubscribers(){return this.changeSubscription.hasSubscribers}}class Ys extends Js{ut;constructor(t,e){super(e),this.ut=t,this.load()}create(t){const e=this.ut();return null!=t&&e.initializeFromJson(t),e}}class Qs{store;changeSubscription=new ks;constructor(t){this.store=t,t.subscribe(this)}get model(){const t=this.store.list()[0];if(t)return t;const e=this.store.create();if(!e)throw new Error(`Unable to initialize model from store ${this.store}`);return this.store.add(e),e}replace(t,e){const i=this.model;i.initializeFromModel(i.modelId,t),this.store.persist(),this.changeSubscription.fire(t=>t.onModelReplaced(i,e))}subscribe(t){this.changeSubscription.subscribe(t)}unsubscribe(t){this.changeSubscription.unsubscribe(t)}get hasSubscribers(){return this.changeSubscription.hasSubscribers}onModelAdded(){}onModelUpdated(t,e){this.changeSubscription.fire(i=>i.onModelUpdated(t,e))}onModelRemoved(){}}class Zs extends Qs{constructor(){super(new Ys(()=>new Gs,"identity"))}}class Xs extends $s{constructor(t){super(tt,t?.appId,t?.onesignalId),t?.externalId&&(this.externalId=t.externalId),t?.timestamp&&(this.timestamp=t.timestamp),t?.event&&(this.event=t.event)}get externalId(){return this.getProperty("externalId")}set externalId(t){this.setProperty("externalId",t)}get timestamp(){return this.getProperty("timestamp")}set timestamp(t){this.setProperty("timestamp",t)}get event(){return this.getProperty("event")}set event(t){this.setProperty("event",t)}get key(){return`${this.appId}.User.${this.onesignalId}.CustomEvent.${this.event.name}`}get createComparisonKey(){return this.key}get modifyComparisonKey(){return this.key}get groupComparisonType(){return Ps}get canStartExecute(){return!bs.j(this.onesignalId)}get applyToRecordId(){return this.onesignalId}translateIds(t){t[this.onesignalId]&&(this.onesignalId=t[this.onesignalId])}}class to{ht;dt;constructor(t,e){this.ht=t,this.dt=e}sendCustomEvent(t){const e=Wi.getAppId(),i=this.ht.model,n=new Xs({appId:e,onesignalId:i.onesignalId,externalId:i.externalId,timestamp:(new Date).toISOString(),event:t});this.dt.enqueue(n)}}const eo=0,io=1,no=2,so=3,oo=4;function ao(t){switch(t){case 400:case 402:return eo;case 401:case 403:return no;case 404:case 410:return so;case 409:return oo;default:return io}}class ro{result;idTranslations;operations;retryAfterSeconds;constructor(t,e,i,n){this.result=t,this.retryAfterSeconds=e,this.operations=i,this.idTranslations=n}}const co=0,lo=1,uo=2,ho=3,go=4,po=5,wo=6;class fo{get operations(){return[tt]}get eventMetadata(){return{sdk:M,device_model:z(),device_os:K(),type:j()}}async execute(t){kt.m(`CustomEventsOperationExecutor(operations: ${JSON.stringify(t)})`);const e=t[0];if(!(e instanceof Xs))throw new Error(`Unrecognized operation! Expected TrackEventOperation, got: ${e.constructor.name}`);const i=await async function(t,e){const{appId:i}=t;return Ct.post(`apps/${i}/custom_events`,{events:[e]},t.jwtHeader)}({appId:e.appId},{name:e.event.name,onesignal_id:e.onesignalId,external_id:e.externalId,timestamp:e.timestamp,payload:{...e.event.properties??{},os_sdk:this.eventMetadata}}),{ok:n,status:s}=i,o=ao(s);return new ro(n?co:o===io?uo:ho)}}class mo{gt=new Map;get wt(){return this.gt}ft(t){this.gt.set(t,Date.now())}bt(t){if(!t)return!0;const e=this.gt.get(t);return!e||Date.now()-e>=500}yt(t){const e=this.gt.get(t);return!!e&&Date.now()-e<=15e3}}class bo extends $s{constructor(t,e,i,n){super(t,e,i),n&&(this.label=n)}get label(){return this.getProperty("label")}set label(t){this.setProperty("label",t)}}class yo extends bo{constructor(t,e,i){super(V,t,e,i)}get modifyComparisonKey(){return`${this.appId}.User.${this.onesignalId}.Alias.${this.label}`}get groupComparisonType(){return Ps}}class So extends bo{constructor(t,e,i,n){super(H,t,e,i),n&&(this.value=n)}get value(){return this.getProperty("value")}set value(t){this.setProperty("value",t)}get modifyComparisonKey(){return`${this.appId}.User.${this.onesignalId}.Identity.${this.label}`}}class vo{ht;St;vt;constructor(t,e,i){this.ht=t,this.St=e,this.vt=i}get operations(){return[H,V]}async execute(t){kt.m(`IdentityOperationExecutor(operations: ${JSON.stringify(t)})`);if(t.filter(t=>!(t instanceof So||t instanceof yo)).length>0)throw new Error(`Unrecognized operation(s)! Attempted operations:\n${JSON.stringify(t)}`);const e=t.some(t=>t instanceof So),i=t.some(t=>t instanceof yo);if(e&&i)throw new Error("Can't process SetAliasOperation and DeleteAliasOperation at the same time.");const n=t[t.length-1],s=n instanceof So,o=s?async function(t,e,i){const{appId:n}=t;return Ct.patch(`apps/${n}/users/by/${e.label}/${e.id}/identity`,{identity:i},t.jwtHeader)}({appId:n.appId},{label:it,id:n.onesignalId},{[n.label]:n.value}):async function(t,e,i){const{appId:n}=t;return Ct.delete(`apps/${n}/users/by/${e.label}/${e.id}/identity/${i}`,t.jwtHeader)}({appId:n.appId},{label:it,id:n.onesignalId},n.label),{ok:a,status:r,retryAfterSeconds:c}=await o;if(a)return this.ht.model.onesignalId===n.onesignalId&&this.ht.model.setProperty(n.label,s?n.value:void 0,Is),new ro(co);switch(ao(r)){case io:return new ro(uo,c);case eo:return new ro(ho);case oo:return s?new ro(po,c):new ro(co);case no:return new ro(go,c);case so:if(404===r&&this.vt.yt(n.onesignalId))return new ro(uo,c);if(s){const t=await this.St.getRebuildOperationsIfCurrentUser(n.appId,n.onesignalId);return null==t?new ro(ho):new ro(uo,c,t)}return new ro(co)}}}class Oo extends xs{constructor(){super()}get onesignalId(){return this.getProperty("onesignalId")}set onesignalId(t){this.setProperty("onesignalId",t)}get ip(){return this.getProperty("ip")}set ip(t){this.setProperty("ip",t)}get country(){return this.getProperty("country")}set country(t){this.setProperty("country",t)}get language(){return this.getProperty("language")}set language(t){this.setProperty("language",t)}get timezone_id(){return this.getProperty("timezone_id")}set timezone_id(t){this.setProperty("timezone_id",t)}get tags(){return this.getProperty("tags")??{}}set tags(t){this.setProperty("tags",t)}}class Io extends Qs{constructor(){super(new Ys(()=>new Oo,"properties"))}}class ko extends Ys{constructor(){super(()=>new Cs,"subscriptions")}getBySubscriptionId(t){return super.list().find(e=>e.id===t)}replaceAll(t,e){if(e!==Is)return super.replaceAll(t,e);for(const i of t)if(Ks.isPushSubscriptionType(i.type)){const t=this.get(i.modelId);t&&(i.sdk=t.sdk,i.device_os=t.device_os);break}super.replaceAll(t,e)}}class xo extends $s{constructor(t,e,i,n){super(t,e,i),n&&(this.subscriptionId=n)}get subscriptionId(){return this.getProperty("subscriptionId")}set subscriptionId(t){this.setProperty("subscriptionId",t)}get createComparisonKey(){return`${this.appId}.User.${this.onesignalId}`}get modifyComparisonKey(){return`${this.appId}.User.${this.onesignalId}.Subscription.${this.subscriptionId}`}get canStartExecute(){return!bs.j(this.onesignalId)&&!bs.j(this.subscriptionId)}get applyToRecordId(){return this.subscriptionId}translateIds(t){super.translateIds(t),t[this.subscriptionId]&&(this.subscriptionId=t[this.subscriptionId])}}class Co extends xo{constructor(t,e,i,n){super(t,e,i),n&&(this.sdk=M,this.device_model=z(),this.device_os=K(),this.enabled=n.enabled,this.notification_types=n.notification_types,this.subscriptionId=n.subscriptionId,this.token=n.token,this.type=n.type,this.web_auth=n.web_auth,this.web_p256=n.web_p256)}get type(){return this.getProperty("type")}set type(t){this.setProperty("type",t)}get token(){return this.getProperty("token")}set token(t){this.setProperty("token",t)}get enabled(){return this.getProperty("enabled")}set enabled(t){this.setProperty("enabled",t)}get notification_types(){return this.getProperty("notification_types")}set notification_types(t){this.setProperty("notification_types",t)}get sdk(){return this.getProperty("sdk")}set sdk(t){this.setProperty("sdk",t)}get device_model(){return this.getProperty("device_model")}set device_model(t){this.setProperty("device_model",t)}get device_os(){return this.getProperty("device_os")}set device_os(t){this.setProperty("device_os",t)}get web_auth(){return this.getProperty("web_auth")}set web_auth(t){this.setProperty("web_auth",t)}get web_p256(){return this.getProperty("web_p256")}set web_p256(t){this.setProperty("web_p256",t)}}class Eo extends Co{constructor(t){super(Y,t?.appId,t?.onesignalId,t)}get canStartExecute(){return!bs.j(this.onesignalId)}get applyToRecordId(){return this.onesignalId}translateIds(t){t[this.onesignalId]&&(this.onesignalId=t[this.onesignalId])}}class _o extends xo{constructor(t,e,i){super(Z,t,e),i&&(this.subscriptionId=i)}get groupComparisonType(){return Ps}}class Po extends $s{constructor(t,e){super(G,t,e)}get createComparisonKey(){return`${this.appId}.User.${this.onesignalId}.Refresh`}get modifyComparisonKey(){return`${this.appId}.User.${this.onesignalId}.Refresh`}get groupComparisonType(){return Es}}class $o extends xo{constructor(t,e,i){super(X,t,e),i&&(this.subscriptionId=i)}get groupComparisonType(){return Ps}get modifyComparisonKey(){return`${this.appId}.Subscription.${this.subscriptionId}.Transfer`}}class To extends Co{constructor(t){super(Q,t?.appId,t?.onesignalId,t)}}class No{Ot;ht;It;kt;constructor(t,e,i,n){this.Ot=t,this.ht=e,this.It=i,this.kt=n}get operations(){return[J]}async execute(t){kt.m(`LoginUserOperationExecutor(operation: ${JSON.stringify(t)})`);const e=t[0];if(e instanceof Ts)return this.loginUser(e,t.slice(1));throw new Error(`Unrecognized operation: ${e.name}`)}async loginUser(t,e){if(!t.existingOnesignalId||!t.externalId)return this.createUser(t,e);const i=await this.Ot.execute([new So(t.appId,t.existingOnesignalId,et,t.externalId)]);switch(i.result){case co:{const e=t.existingOnesignalId,i=t.onesignalId;return this.ht.model.onesignalId===i&&this.ht.model.setProperty(it,e,Is),this.It.model.onesignalId===i&&this.It.model.setProperty("onesignalId",e,Is),new ro(lo,void 0,void 0,{[t.onesignalId]:e})}case po:return kt.m(`Handling 409 for externalId: ${t.externalId}`),this.createUser(t,e);case ho:return kt.O(`Recovering from SetAlias failure for externalId: ${t.externalId}`),this.createUser(t,e);default:return new ro(i.result)}}async createUser(t,e){const i={};let n={};const s={timezone_id:Intl.DateTimeFormat().resolvedOptions().timeZone,language:Do()};t.externalId&&(i[et]=t.externalId);for(const l of e){if(!(l instanceof Eo||l instanceof $o||l instanceof To||l instanceof _o))throw new Error(`Unrecognized operation: ${l.name}`);n=this.createSubscriptionsFromOperation(l,n)}const o=Object.entries(n),a=await async function(t,e){const{appId:i,subscriptionId:n}=t,s=n?{"OneSignal-Subscription-Id":n}:void 0;let o={};return s&&(o={...o,...s}),t.jwtHeader&&(o={...o,...t.jwtHeader}),e.refresh_device_metadata=!0,Ct.post(`apps/${i}/users`,e,o)}({appId:t.appId},{identity:i,subscriptions:o.map(([,t])=>t),properties:s});if(a.ok){const e=a.result.identity.onesignal_id,n=t.onesignalId,s={[t.onesignalId]:e};this.ht.model.onesignalId===n&&this.ht.model.setProperty(it,e,Is),this.It.model.onesignalId===n&&this.It.model.setProperty("onesignalId",e,Is);const r=a.result.properties;if(r)for(const[t,i]of Object.entries(r))this.It.model.setProperty(t,i,Is);for(let t=0;t<o.length;t++){const[i]=o[t],n=a.result.subscriptions?.[t];if(!n||!("id"in n))continue;s[i]=n.id;const r=this.kt.getBySubscriptionId(i);r?.setProperty("id",n.id,Is),r?.setProperty("onesignalId",e,Is)}Ws();const c=Object.keys(i).length>0?[new Po(t.appId,e)]:void 0;return new ro(co,void 0,c,s)}const{status:r,retryAfterSeconds:c}=a;switch(ao(r)){case io:return new ro(uo,c);case no:return new ro(go,c);default:return new ro(wo)}}createSubscriptionsFromOperation(t,e){switch(!0){case t instanceof Eo:{const i=t.subscriptionId;return{...e,[i]:{enabled:t.enabled,device_model:t.device_model,device_os:t.device_os,notification_types:t.notification_types,sdk:t.sdk,token:t.token,type:t.type,web_auth:t.web_auth,web_p256:t.web_p256}}}case t instanceof To:{const i=t.subscriptionId;return e[i]?{...e,[i]:{...e[i],enabled:t.enabled,notification_types:t.notification_types,token:t.token}}:e}case t instanceof $o:{const i=t.subscriptionId;return{...e,[i]:{...e[i],id:i}}}case t instanceof _o:{const i={...e};return delete i[t.subscriptionId],i}default:return e}}}const Ao=["tw","hant"],Mo=["cn","hans"],Do=()=>{let t=navigator.language;if(t){t=t.toLowerCase();const e=t.split("-");if("zh"==e[0]){for(const t of Ao)if(-1!==e.indexOf(t))return"zh-Hant";for(const t of Mo)if(-1!==e.indexOf(t))return"zh-Hans";return"zh-Hant"}return e[0].substring(0,2)}return"en"};class Uo{ht;It;kt;St;vt;constructor(t,e,i,n,s){this.ht=t,this.It=e,this.kt=i,this.St=n,this.vt=s}get operations(){return[G]}async execute(t){if(kt.m(`RefreshUserOperationExecutor(operation: ${JSON.stringify(t)})`),t.some(t=>!(t instanceof Po)))throw new Error(`Unrecognized operation(s)! Attempted operations:\n${JSON.stringify(t)}`);const e=t[0];return this.getUser(e)}async getUser(t){const e=await async function(t,e){const{appId:i}=t;return Ct.get(`apps/${i}/users/by/${e.label}/${e.id}`,t.jwtHeader)}({appId:t.appId},{label:it,id:t.onesignalId}),{ok:i,result:n,retryAfterSeconds:s,status:o}=e;if(i){if(t.onesignalId!==this.ht.model.onesignalId)return new ro(co);const e=new Gs;for(const[t,c]of Object.entries(n.identity))e.setProperty(t,c);const i=new Oo;i.onesignalId=t.onesignalId;const{properties:s={},subscriptions:o=[]}=n;Object.entries(s).forEach(([t,e])=>{i.setProperty(t,e)});const a=[];for(const n of o){const e=new Cs;e.id=n.id,e.token=n.token??"",e.notification_types=n.notification_types??w,e.type=n.type,e.enabled=e.notification_types!==f,e.sdk=n.sdk,e.device_os=n.device_os,e.device_model=n.device_model,e.onesignalId=t.onesignalId,Ks.isPushSubscriptionType(e.type)||a.push(e)}const r=await OneSignal.G.getPushSubscriptionModel();return r&&(r.onesignalId=t.onesignalId,a.push(r)),this.ht.replace(e,Is),this.It.replace(i,Is),this.kt.replaceAll(a,Is),new ro(co)}switch(ao(o)){case io:return new ro(uo,s);case no:return new ro(go,s);case so:{if(404===o&&this.vt.yt(t.onesignalId))return new ro(uo,s);const e=await this.St.getRebuildOperationsIfCurrentUser(t.appId,t.onesignalId);return e?new ro(uo,s,e):new ro(ho)}default:return new ro(ho)}}}class Bo{xt;St;vt;constructor(t,e,i){this.xt=t,this.St=e,this.vt=i}get operations(){return[Y,Q,Z,X]}async execute(t){kt.m(`SubscriptionOperationExecutor(operations: ${t})`);const e=t[0];if(e instanceof Eo)return this.createSubscription(e,t);if(t.some(t=>t instanceof _o)){if(t.length>1)throw new Error(`Only supports one operation! Attempted operations:\n${t}`);return this.deleteSubscription(t[0])}if(e instanceof To)return this.updateSubscription(t);if(e instanceof $o){if(t.length>1)throw new Error(`TransferSubscriptionOperation only supports one operation! Attempted operations:\n${t}`);return this.transferSubscription(e)}throw new Error(`Unrecognized operation: ${e}`)}async createSubscription(t,e){if(e.some(t=>t instanceof _o))return new ro(co);const i=e.toReversed().find(t=>t instanceof To),n=i?.enabled??t.enabled,s=i?.token??t.token,o=i?.notification_types??t.notification_types,a={sdk:t.sdk,type:t.type,enabled:n,token:s,notification_types:o},r=await async function(t,e,i){const{appId:n}=t;return Ct.post(`apps/${n}/users/by/${e.label}/${e.id}/subscriptions`,i,t.jwtHeader)}({appId:t.appId},{label:it,id:t.onesignalId},{subscription:a});if(r.ok){const{subscription:e}=r.result,i=this.xt.getBySubscriptionId(t.subscriptionId),n=e?.id;return n&&(i?.setProperty("id",n,Is),i?.setProperty("onesignalId",t.onesignalId,Is)),new ro(co,void 0,n?void 0:[new Po(t.appId,t.onesignalId)],n?{[t.subscriptionId]:n}:void 0)}const{retryAfterSeconds:c,status:l}=r;switch(ao(l)){case io:return new ro(uo,c);case no:return new ro(go,c);case oo:case eo:return new ro(ho);case so:{if(404===l&&this.vt.yt(t.onesignalId))return new ro(uo,c);const e=await this.St.getRebuildOperationsIfCurrentUser(t.appId,t.onesignalId);return e?new ro(uo,c,e):new ro(ho)}}}async updateSubscription(t){const e=t[t.length-1],i={type:e.type,enabled:e.enabled,token:e.token,notification_types:e.notification_types,web_auth:e.web_auth,web_p256:e.web_p256},n=await async function(t,e,i){const{appId:n}=t;return Ct.patch(`apps/${n}/subscriptions/${e}`,{subscription:i})}({appId:e.appId},e.subscriptionId,i);if(n.ok)return new ro(co);const{retryAfterSeconds:s,status:o}=n;switch(ao(o)){case io:return new ro(uo,s);case so:return 404===o&&[e.onesignalId,e.subscriptionId].some(t=>this.vt.yt(t))?new ro(uo,s):new ro(ho,void 0,[new Eo({appId:e.appId,enabled:e.enabled,notification_types:e.notification_types,onesignalId:e.onesignalId,subscriptionId:e.subscriptionId,token:e.token,type:e.type})]);default:return new ro(ho)}}async transferSubscription(t){const e=await async function(t,e,i,n){const{appId:s}=t;return Ct.patch(`apps/${s}/subscriptions/${e}/owner`,{identity:{...i},retain_previous_owner:n},t.jwtHeader)}({appId:t.appId},t.subscriptionId,{onesignal_id:t.onesignalId},!1);if(e.ok)return new ro(co);const{retryAfterSeconds:i,status:n}=e;return ao(n)===io?new ro(uo,i):new ro(ho)}async deleteSubscription(t){const e=await async function(t,e){const{appId:i}=t;return Ct.delete(`apps/${i}/subscriptions/${e}`)}({appId:t.appId},t.subscriptionId);if(e.ok)return this.xt.remove(t.subscriptionId,Is),new ro(co);const{retryAfterSeconds:i,status:n}=e;switch(ao(n)){case so:return[t.onesignalId,t.subscriptionId].some(t=>this.vt.yt(t))?new ro(uo,i):new ro(co);case io:return new ro(uo,i);default:return new ro(ho)}}}class Lo{ip;tags;language;timezone_id;country;constructor(t={}){this.ip=t.ip,this.tags=t.tags,this.language=t.language,this.timezone_id=t.timezone_id,this.country=t.country}get hasAtLeastOnePropertySet(){return Object.values(this).some(t=>void 0!==t)}}class Ro extends $s{constructor(t,e,i,n){super(q,t,e),i&&n&&(this.property=i,this.value=n)}get property(){return this.getProperty("property")}set property(t){this.setProperty("property",t)}get value(){return this.getProperty("value")}set value(t){this.setProperty("value",t)}get modifyComparisonKey(){return`${this.appId}.User.${this.onesignalId}`}}class Wo{static createPropertiesFromOperation(t,e){if(t instanceof Ro){const i=t.property;return Object.keys(e).includes(i)?new Lo({...e,[i]:t.value}):new Lo({...e})}throw new Error(`Unsupported operation type: ${t.name}`)}}class Fo{ht;It;St;vt;constructor(t,e,i,n){this.ht=t,this.It=e,this.St=i,this.vt=n}get operations(){return[q]}processOperations(t){let e=null,i=null,n=new Lo;for(const s of t){if(!(s instanceof Ro))throw new Error(`Unrecognized operation: ${s}`);e||(e=s.appId,i=s.onesignalId),n=Wo.createPropertiesFromOperation(s,n)}return{appId:e,onesignalId:i,propertiesObject:n,refreshDeviceMetadata:!1}}async execute(t){kt.m(`UpdateUserOperationExecutor(operation: ${t})`);const{appId:e,onesignalId:i,propertiesObject:n,refreshDeviceMetadata:s}=this.processOperations(t);if(!e||!i)return new ro(co);const o=await _t({appId:e},{label:it,id:i},{properties:n,refresh_device_metadata:s}),{ok:a,retryAfterSeconds:r,status:c}=o,l=t=>"tags"===t.property;if(a){if(this.ht.model.onesignalId===i)for(const e of t)if(e instanceof Ro){let t=e.value;if(l(e)){t={...e.value};for(const e in t)""===t[e]&&delete t[e]}this.It.model.setProperty(e.property,t,Is)}return new ro(co)}switch(ao(c)){case io:return new ro(uo,r);case no:return new ro(go,r);case so:{if(404===c&&this.vt.yt(i))return new ro(uo,r);const t=await this.St.getRebuildOperationsIfCurrentUser(e,i);return t?new ro(uo,r,t):new ro(ho)}default:return new ro(ho)}}}class jo{store;opRepo;constructor(t,e){this.store=t,this.opRepo=e,this.store.subscribe(this)}onModelReplaced(t,e){if(e!==vs)return;const i=this.getReplaceOperation(t);null!=i&&this.opRepo.enqueue(i)}onModelUpdated(t,e){if(e!==vs)return;const i=this.getUpdateOperation(t.model,t.property,t.oldValue,t.newValue);null!=i&&this.opRepo.enqueue(i)}}class Ko extends jo{constructor(t,e){super(t,e)}getReplaceOperation(t){return null}getUpdateOperation(t,e,i,n){const s=Wi.getAppId();return null!=n&&"string"==typeof n?new So(s,t.onesignalId,e,n):new yo(s,t.onesignalId,e)}}class zo{store;opRepo;constructor(t,e){this.store=t,this.opRepo=e,this.store.subscribe(this)}close(){this.store.unsubscribe(this)}onModelAdded(t,e){if(e!==vs)return;const i=this.getAddOperation(t);null!=i&&this.opRepo.enqueue(i)}async onModelUpdated(t,e){if(e!==vs)return;const i=await this.getUpdateOperation(t.model,t.property,t.oldValue,t.newValue);null!=i&&this.opRepo.enqueue(i)}async onModelRemoved(t,e){if(e!==vs)return;const i=await this.getRemoveOperation(t);null!=i&&this.opRepo.enqueue(i)}}class Ho extends jo{constructor(t,e){super(t,e)}getReplaceOperation(t){return null}getUpdateOperation(t,e,i,n){const s=Wi.getAppId();return new Ro(s,t.onesignalId,e,n)}}class Vo extends zo{ht;constructor(t,e,i){super(t,e),this.ht=i}getAddOperation(t){const{enabled:e,notification_types:i}=Vo.getSubscriptionEnabledAndStatus(t),n=Wi.getAppId();return new Eo({appId:n,onesignalId:this.ht.model.onesignalId,subscriptionId:t.id,type:t.type,enabled:e,token:t.token,notification_types:i})}getRemoveOperation(t){const e=Wi.getAppId();return new _o(e,this.ht.model.onesignalId,t.id)}getUpdateOperation(t){const{enabled:e,notification_types:i}=Vo.getSubscriptionEnabledAndStatus(t),n=Wi.getAppId();return new To({appId:n,onesignalId:this.ht.model.onesignalId,subscriptionId:t.id,type:t.type,enabled:e,token:t.token,notification_types:i,web_auth:t.web_auth,web_p256:t.web_p256})}static getSubscriptionEnabledAndStatus(t){let e,i;return t.enabled&&t.notification_types===w&&t.token?(e=!0,i=w):(e=!1,i=t.enabled?t.notification_types:f),{enabled:e,notification_types:i}}}class qo extends Js{constructor(){super("operations")}async loadOperations(){return this.load()}create(t){if(null===t)return kt.O("null jsonObject sent to OperationModelStore.create"),null;if(!this.isValidOperation(t))return null;const e=t.name;let i;switch(e){case H:i=new So;break;case V:i=new yo;break;case Y:i=new Eo;break;case Q:i=new To;break;case Z:i=new _o;break;case X:i=new $o;break;case J:i=new Ts;break;case G:i=new Po;break;case q:i=new Ro;break;case tt:i=new Xs;break;default:throw new Error(`Unrecognized operation: ${e}`)}return i.initializeFromJson(t),i}isValidOperation(t){const e=t?.name;if(!e)return kt.O("jsonObject must have 'name' attribute"),!1;const i=new Set([J]);return!(!t.onesignalId&&!i.has(e))||(kt.O(`${e} jsonObject must have 'onesignalId' attribute`),!1)}}class Go{ht;It;kt;constructor(t,e,i){this.ht=t,this.It=e,this.kt=i}async getRebuildOperationsIfCurrentUser(t,e){const i=new Gs;i.initializeFromModel(null,this.ht.model);(new Oo).initializeFromModel(null,this.It.model);for(const o of this.kt.list()){(new Cs).initializeFromModel(null,o)}if(i.onesignalId!==e)return null;const n=[];n.push(new Ts(t,e,i.externalId));const s=await OneSignal.G.getPushSubscriptionModel();return s&&n.push(new Eo({appId:t,onesignalId:e,subscriptionId:s.id,type:s.type,enabled:s.enabled,token:s.token,notification_types:s.notification_types})),n.push(new Po(t,e)),n}}const Jo=t=>{Qe.delete("operations",t.modelId)};class Yo{operation;bucket;retries;resolver;constructor(t){this.operation=t.operation,this.bucket=t.bucket,this.retries=t.retries??0,this.resolver=t.resolver}toString(){return`bucket:${this.bucket}, retries:${this.retries}, operation:${this.operation}\n`}}class Qo{Ct;queue=[];Et=void 0;_t=0;Pt;vt;constructor(t,e,i){this.Pt=e,this.vt=i,this.Ct=new Map;for(const n of t)for(const t of n.operations)this.Ct.set(t,n)}$t(){this.queue=[]}get wt(){return this.vt.wt}get Tt(){return 0===this._t?0:this._t-1}Nt(t){return this.queue.some(e=>e.operation instanceof t)}async At(){await this.Mt(),this.Dt()}Ut(){clearInterval(this.Et),this.Et=void 0,kt.m("OperationRepo: Paused")}enqueue(t){kt.m(`OperationRepo.enqueue(operation: ${t})`),this.Bt(new Yo({operation:t,bucket:this._t}),!0)}async enqueueAndWait(t){kt.m(`OperationRepo.enqueueAndWaitoperation: ${t})`),await new Promise(e=>{this.Bt(new Yo({operation:t,bucket:this._t,resolver:e}),!0)})}Bt(t,e,i){this.queue.some(e=>e.operation.modelId===t.operation.modelId)?kt.m(`OperationRepo: internalEnqueue - operation.modelId: ${t.operation.modelId} already exists in the queue.`):(void 0!==i?this.queue.splice(i,0,t):this.queue.push(t),e&&this.Pt.add(t.operation))}async Dt(){this._t++;let t=!1;this.Et=setInterval(async()=>{if(t)return kt.m("Operations in progress");const e=this.Lt(this.Tt);e?(t=!0,await this.Rt(e),t=!1):this._t++},500)}async Rt(t){try{const e=t[0],i=this.Ct.get(e.operation.name);if(!i)throw new Error(`Could not find executor for operation ${e.operation.name}`);const n=t.map(t=>t.operation),s=await i.execute(n),o=s.idTranslations;kt.m(`OperationRepo: execute response = ${s.result}`),o&&(t.forEach(t=>t.operation.translateIds(o)),this.queue.forEach(t=>t.operation.translateIds(o)),Object.values(o).forEach(t=>this.vt.ft(t)));let a=0;switch(s.result){case co:t.forEach(t=>{this.Pt.remove(t.operation.modelId)}),t.forEach(t=>t.resolver?.(!0));break;case go:case ho:case po:kt.O(`Operation execution failed without retry: ${n}`),t.forEach(t=>{this.Pt.remove(t.operation.modelId)}),t.forEach(t=>t.resolver?.(!1));break;case lo:this.Pt.remove(e.operation.modelId),e.resolver?.(!0),t.filter(t=>t!==e).reverse().forEach(t=>this.queue.unshift(t));break;case uo:kt.O(`Operation execution failed, retrying: ${n}`),t.toReversed().forEach(t=>{Jo(t.operation),t.retries++,t.retries>a&&(a=t.retries),this.queue.unshift(t)});break;case wo:kt.O(`Operation execution failed with eventual retry, pausing the operation repo: ${n}`),this.Ut(),t.toReversed().forEach(t=>{Jo(t.operation),this.queue.unshift(t)})}if(s.operations)for(const t of s.operations.toReversed()){const e=new Yo({operation:t,bucket:0});this.queue.unshift(e),this.Pt.addAt(0,e.operation)}await this.Wt(a,s.retryAfterSeconds),s.idTranslations&&await St(500)}catch(e){kt.O(`Error attempting to execute operation: ${t}`,e),t.forEach(t=>{this.Pt.remove(t.operation.modelId)}),t.forEach(t=>t.resolver?.(!1))}}async Wt(t,e){kt.m(`retryAfterSeconds: ${e}`);const i=1e3*(e||0),n=1e3*t,s=Math.max(n,i);s<1||(kt.O(`Operations being delay for: ${s} ms`),await St(s))}Lt(t){const e=this.queue.findIndex(e=>e.operation.canStartExecute&&this.vt.bt(e.operation.applyToRecordId)&&e.bucket<=t);if(-1!==e){const t=this.queue[e];return this.queue.splice(e,1),this.Ft(t)}return null}Ft(t){const e=[t];if(t.operation.groupComparisonType===Ps)return e;const i=t.operation.groupComparisonType===Es?t.operation.createComparisonKey:t.operation.modifyComparisonKey,n=[...this.queue];for(const s of n){const n=t.operation.groupComparisonType===Es?s.operation.createComparisonKey:s.operation.modifyComparisonKey;if(""===n&&""===i)throw new Error("Both comparison keys cannot be blank!");if(this.vt.bt(s.operation.applyToRecordId)&&n===i){const t=this.queue.indexOf(s);-1!==t&&(this.queue.splice(t,1),e.push(s))}}return e}async Mt(){await this.Pt.loadOperations();const t=this.Pt.list().toReversed();for(const e of t)this.Bt(new Yo({operation:e,bucket:this._t}),!1,0)}}class Zo{operationModelStore;operationRepo;newRecordsState;subscriptionModelStore;identityModelStore;propertiesModelStore;customEventController;initPromise;rebuildUserService;executors;listeners;constructor(){this.newRecordsState=new mo,this.operationModelStore=new qo,this.identityModelStore=new Zs,this.propertiesModelStore=new Io,this.subscriptionModelStore=new ko,this.rebuildUserService=new Go(this.identityModelStore,this.propertiesModelStore,this.subscriptionModelStore),this.executors=this.initializeExecutors(),this.operationRepo=new Qo(this.executors,this.operationModelStore,this.newRecordsState),this.customEventController=new to(this.identityModelStore,this.operationRepo),this.listeners=this.initializeListeners(),this.initPromise=this.operationRepo.At()}async init(){return Pi("CoreModule.init"),this.initPromise}initializeListeners(){return this.operationRepo?[new Ko(this.identityModelStore,this.operationRepo),new Ho(this.propertiesModelStore,this.operationRepo),new Vo(this.subscriptionModelStore,this.operationRepo,this.identityModelStore)]:[]}initializeExecutors(){const t=new vo(this.identityModelStore,this.rebuildUserService,this.newRecordsState);return[t,new No(t,this.identityModelStore,this.propertiesModelStore,this.subscriptionModelStore),new Uo(this.identityModelStore,this.propertiesModelStore,this.subscriptionModelStore,this.rebuildUserService,this.newRecordsState),new Bo(this.subscriptionModelStore,this.rebuildUserService,this.newRecordsState),new Fo(this.identityModelStore,this.propertiesModelStore,this.rebuildUserService,this.newRecordsState),new fo]}}class Xo{w3cEndpoint;w3cP256dh;w3cAuth;safariDeviceToken;static jt(t){const e=new Xo;if(t&&(e.w3cEndpoint=new URL(t.endpoint),t.getKey)){let n=null;try{n=t.getKey("p256dh")}catch(i){}let s=null;try{s=t.getKey("auth")}catch(i){}if(n){const t=btoa(String.fromCharCode(...new Uint8Array(n)));e.w3cP256dh=t}if(s){const t=btoa(String.fromCharCode(...new Uint8Array(s)));e.w3cAuth=t}}return e}Kt(t){t&&(this.safariDeviceToken=t)}_(){return{w3cEndpoint:this.w3cEndpoint?this.w3cEndpoint.toString():null,w3cP256dh:this.w3cP256dh,w3cAuth:this.w3cAuth,safariDeviceToken:this.safariDeviceToken}}static zt(t){const e=new Xo;if(!t)return e;try{e.w3cEndpoint=new URL(t.w3cEndpoint)}catch(i){}return e.w3cP256dh=t.w3cP256dh,e.w3cAuth=t.w3cAuth,e.safariDeviceToken=t.safariDeviceToken,e}}class ta{type;token;enabled;notificationTypes;sdk;deviceModel;deviceOs;webAuth;webp256;constructor(t){this.token=this.Ht(t),this.type=j(),this.enabled=!0,this.notificationTypes=w,this.sdk=M,this.deviceModel=z(),this.deviceOs=K(),this.webAuth=t.w3cAuth,this.webp256=t.w3cP256dh}Ht(t){return t.w3cEndpoint?t.w3cEndpoint.toString():t.safariDeviceToken}_(){return{type:this.type,token:this.token,enabled:this.enabled,notification_types:this.notificationTypes,sdk:this.sdk,device_model:this.deviceModel,device_os:this.deviceOs,web_auth:this.webAuth,web_p256:this.webp256}}}class ea{core;constructor(t){this.core=t}get operationRepo(){return this.core.operationRepo}get identityModelStore(){return this.core.identityModelStore}get propertiesModelStore(){return this.core.propertiesModelStore}get subscriptionModelStore(){return this.core.subscriptionModelStore}get newRecordsState(){return this.core.newRecordsState}get customEventController(){return this.core.customEventController}generatePushSubscriptionModel(t){Pi("CoreModuleDirector.generatePushSubscriptionModel",{rawPushSubscription:t});const e=new Cs;return e.initializeFromJson(new ta(t)._()),e.id=bs.F(),this.core.subscriptionModelStore.add(e,Is),e}addSubscriptionModel(t){this.core.subscriptionModelStore.add(t)}removeSubscriptionModel(t){this.core.subscriptionModelStore.remove(t)}getEmailSubscriptionModels(){Pi("CoreModuleDirector.getEmailSubscriptionModels");return this.core.subscriptionModelStore.list().filter(t=>t.type===l)}async hasEmail(){const t=this.getEmailSubscriptionModels();return Object.keys(t).length>0}getSmsSubscriptionModels(){Pi("CoreModuleDirector.getSmsSubscriptionModels");return this.core.subscriptionModelStore.list().filter(t=>t.type===u)}async hasSms(){const t=this.getSmsSubscriptionModels();return Object.keys(t).length>0}getAllPushSubscriptionModels(){Pi("CoreModuleDirector.getAllPushSubscriptionModels");return this.core.subscriptionModelStore.list().filter(t=>Ks.isPushSubscriptionType(t.type))}async getPushSubscriptionModelByCurrentToken(){Pi("CoreModuleDirector.getPushSubscriptionModelByCurrentToken");const t=await Wi.getCurrentPushToken();if(t)return this.getSubscriptionOfTypeWithToken(r,t)}async getPushSubscriptionModelByLastKnownToken(){Pi("CoreModuleDirector.getPushSubscriptionModelByLastKnownToken");const t=await(async()=>await Ze("lastPushToken"))();if(t)return this.getSubscriptionOfTypeWithToken(r,t)}async getPushSubscriptionModel(){return Pi("CoreModuleDirector.getPushSubscriptionModel"),await this.getPushSubscriptionModelByCurrentToken()||await this.getPushSubscriptionModelByLastKnownToken()}Y(){return Pi("CoreModuleDirector.getIdentityModel"),this.core.identityModelStore.model}Z(){return Pi("CoreModuleDirector.getPropertiesModel"),this.core.propertiesModelStore.model}async getAllSubscriptionsModels(){Pi("CoreModuleDirector.getAllSubscriptionsModels");const t=this.getEmailSubscriptionModels(),e=this.getSmsSubscriptionModels(),i=await this.getPushSubscriptionModel();return[...t,...e,...i?[i]:[]]}getSubscriptionOfTypeWithToken(t,e){let i;switch(Pi("CoreModuleDirector.getSubscriptionOfTypeWithToken",{type:t,token:e}),t){case o:i=this.getEmailSubscriptionModels();break;case a:i=this.getSmsSubscriptionModels();break;case r:i=this.getAllPushSubscriptionModels();break;default:return}return i.find(t=>t.token===e)}}class ia{static async createUserOnServer(){const t=OneSignal.G.Y(),e=Wi.getAppId(),i=OneSignal.G.subscriptionModelStore.list().length>0,n=!!t.externalId;if(!i&&!n)return void kt.O("No subscriptions or external ID found, skipping user creation");const s=await OneSignal.G.getPushSubscriptionModel();if(s){const i=s.toJSON();OneSignal.G.operationRepo.enqueue(new Ts(e,t.onesignalId,t.externalId)),await OneSignal.G.operationRepo.enqueueAndWait(new Eo({...i,appId:e,onesignalId:t.onesignalId,subscriptionId:s.id}))}else OneSignal.G.operationRepo.enqueue(new Ts(e,t.onesignalId,t.externalId))}static resetUserModels(){const t=new Gs,e=new Oo,i=bs.F();t.onesignalId=i,e.onesignalId=i,OneSignal.G.identityModelStore.replace(t),OneSignal.G.propertiesModelStore.replace(e)}}class na{static switchingUsersPromise=Promise.resolve();static async login(t,e){await(this.switchingUsersPromise=na.Vt(t,e))}static async Vt(t,e){e&&Qe.put("Ids",{id:e,type:"jwtToken"});let i=OneSignal.G.Y();const n=bs.j(i.onesignalId)?void 0:i.onesignalId,s=i.externalId;if(s===t)return void kt.m("Login: External ID already set, skipping login");ia.resetUserModels(),i=OneSignal.G.Y(),i.setProperty(et,t,Is);const o=i.onesignalId,a=Wi.getAppId(),r=[OneSignal.G.getPushSubscriptionModel().then(t=>{t&&OneSignal.G.operationRepo.enqueue(new $o(a,o,t.id))}),OneSignal.G.operationRepo.enqueueAndWait(new Ts(a,o,t,s?void 0:n))];await Promise.all(r)}static async logout(){await(this.switchingUsersPromise=na.qt())}static async qt(){return OneSignal.G.Y().externalId?(ia.resetUserModels(),ia.createUserOnServer()):kt.m("Logout: User is not logged in, skipping logout")}}function sa(t){const e=t.active||t.installing||t.waiting;return e||kt.v("Could not find an available ServiceWorker instance!"),e}class oa{Gt;constructor(){this.Gt={}}Jt(t,e,i){const n={callback:e,onceListenerOnly:i},s=this.Gt[t.toString()];s?s.push(n):this.Gt[t.toString()]=[n]}Yt(t){return this.Gt[t.toString()]||[]}Qt(t){this.Gt[t.toString()]=null}Zt(){this.Gt={}}Xt(t,e){const i=this.Gt[t.toString()];if(null!=i)for(let n=i.length-1;n>=0;n--){i[n]===e&&i.splice(n,1)}}}class aa{te;Gt;constructor(t,e=new oa){this.te=t,this.Gt=e}ee(t,e){this.Gt.Jt(t,e,!1)}ie(t,e){this.Gt.Jt(t,e,!0)}ne(t){t?this.Gt.Qt(t):this.Gt.Zt()}}class ra extends aa{async listen(){B()&&await this.listenForPage()}async listenForPage(){navigator.serviceWorker.addEventListener("message",this.onPageMessageReceivedFromServiceWorker.bind(this)),kt.m(`(${location.origin}) [Worker Messenger] Page is now listening for messages.`)}onPageMessageReceivedFromServiceWorker(t){const e=t.data;if(!e||!e.command)return;const i=this.Gt.Yt(e.command),n=[],s=[];kt.m("[Worker Messenger] Page received message:",t.data);for(const o of i)o.onceListenerOnly&&n.push(o),s.push(o);for(let o=n.length-1;o>=0;o--){const t=n[o];this.Gt.Xt(e.command,t)}for(const o of s)o.callback.apply(null,[e.payload])}async unicast(t,e){kt.m(`[Worker Messenger] [Page -> SW] Unicasting '${t.toString()}' to service worker.`),this.directPostMessageToSW(t,e)}async directPostMessageToSW(t,e){kt.m(`[Worker Messenger] [Page -> SW] Direct command '${t.toString()}' to service worker.`);const i=await(this.te?.T.getOneSignalRegistration());if(!i)return void kt.O("`[Worker Messenger] [Page -> SW] Could not get ServiceWorkerRegistration to postMessage!");const n=sa(i);n?n.postMessage({command:t,payload:e}):kt.O("`[Worker Messenger] [Page -> SW] Could not get ServiceWorker to postMessage!")}}class ca{static QUERY_STRING="?";path;constructor(t){if(!t)throw pt("path");this.path=t.trim()}getQueryString(){const t=this.path.indexOf("?");return-1===t?null:this.path.length>t?this.path.substring(t+1):null}getWithoutQueryString(){return this.path.split(ca.QUERY_STRING)[0]}getFileName(){return this.getWithoutQueryString().split("\\").pop()?.split("/").pop()}getFileNameWithQuery(){return this.path.split("\\").pop()?.split("/").pop()}getFullPath(){return this.path}}class la{outcomeName;config;appId;isUnique;constructor(t,e,i,n){this.outcomeName=i,this.config=e,this.appId=t,this.isUnique=n}async getAttribution(){return await async function(t){if(t.direct&&t.direct.enabled){const t=await(async()=>(await Qe.getAll("Outcomes.NotificationClicked")).map(t=>{return{appId:(e=t).appId,notificationId:e.notificationId,timestamp:e.timestamp};var e}))();if(t.length>0)return{type:Nt,notificationIds:[t[0].notificationId]}}if(t.indirect&&t.indirect.enabled){const e=60*t.indirect.influencedTimePeriodMin*1e3,i=new Date((new Date).getTime()-e).getTime(),n=await(async()=>(await Qe.getAll("Outcomes.NotificationReceived")).map(t=>{return{appId:(e=t).appId,notificationId:e.notificationId,timestamp:e.timestamp};var e}))();if(kt.m(`\tFound total of ${n.length} received notifications`),n.length>0){const e=t.indirect.influencedNotificationsLimit,s=function(t,e,i=!1,n=!0){const s=n?t:t.slice();return s.sort((t,n)=>{const s=e(t),o=e(n);return s>o?i?-1:1:s<o?i?1:-1:0}),s}(n,t=>t.timestamp,!0,!1),o=s.filter(t=>t.timestamp>=i).slice(0,e).map(t=>t.notificationId);kt.m(`\tTotal of ${o.length} received notifications are within reporting window.`);const a=s.filter(t=>-1===o.indexOf(t.notificationId)).map(t=>t.notificationId);if(a.forEach(t=>Qe.delete("Outcomes.NotificationReceived",t)),kt.m(`\t${a.length} received notifications will be deleted.`),o.length>0)return{type:At,notificationIds:o}}}if(t.unattributed&&t.unattributed.enabled)return{type:Mt,notificationIds:[]};return{type:Dt,notificationIds:[]}}(this.config)}async beforeOutcomeSend(){if(Pi(this.isUnique?"sendUniqueOutcome":"sendOutcome",this.outcomeName),!this.config)return kt.m("Outcomes feature not supported by main application yet."),!1;if(!this.outcomeName)return kt.O("Outcome name is required"),!1;await _i();return!!(await OneSignal.context.A.isPushNotificationsEnabled())||(kt.v("Reporting outcomes is supported only for subscribed users."),!1)}async getAttributedNotifsByUniqueOutcomeName(){return(await Qe.getAll("SentUniqueOutcome")).filter(t=>t.outcomeName===this.outcomeName).reduce((t,e)=>[...t,...e.notificationIds||[]],[])}async getNotifsToAttributeWithUniqueOutcome(t){const e=await this.getAttributedNotifsByUniqueOutcomeName();return t.filter(t=>-1===e.indexOf(t))}shouldSendUnique(t,e){return t.type===Mt||e.length>0}async saveSentUniqueOutcome(t){const e=this.outcomeName,i=await Qe.get("SentUniqueOutcome",e),n=await Xe(),s=[...i?i.notificationIds:[],...t],o=n?n.startTimestamp:null;await Qe.put("SentUniqueOutcome",{outcomeName:e,notificationIds:s,sentDuringSession:o})}async wasSentDuringSession(){const t=await Qe.get("SentUniqueOutcome",this.outcomeName);if(!t)return!1;const e=await Xe(),i=e&&t.sentDuringSession===e.startTimestamp,n=!e&&!!t.sentDuringSession;return i||n}async send(t){const{type:e,notificationIds:i,weight:n}=t;switch(e){case Nt:return this.isUnique&&await this.saveSentUniqueOutcome(i),void(await OneSignal.context.lt.sendOutcomeDirect(this.appId,i,this.outcomeName,n));case At:return this.isUnique&&await this.saveSentUniqueOutcome(i),void(await OneSignal.context.lt.sendOutcomeInfluenced(this.appId,i,this.outcomeName,n));case Mt:if(this.isUnique){if(await this.wasSentDuringSession())return void kt.v("(Unattributed) unique outcome was already sent during this session");await this.saveSentUniqueOutcome([])}return void(await OneSignal.context.lt.sendOutcomeUnattributed(this.appId,this.outcomeName,n));default:return void kt.v("You are on a free plan. Please upgrade to use this functionality.")}}}function ua(t,e,i){return function(t,e,i){const n=new URL(t,It()).href,s=Tt({appId:e}),o=Tt({sdkVersion:i});return`${n}?${s}&${o}`}(t.workerPath.getFullPath(),e,i)}const ha="OneSignal Worker",da="3rd Party",ga="None",pa="GetWorkerVersion",wa="notification.willDisplay",fa="notification.clicked",ma="notification.dismissed",ba="os.session.upsert",ya="os.session.deactivate",Sa="os.page_focused_request",va="os.page_focused_response";class Oa{context;config;constructor(t,e){this.context=t,this.config=e}async getRegistration(){return async function(t){try{const e=location.origin+t;return await navigator.serviceWorker.getRegistration(e)}catch(e){return void kt.v("[Service Worker Status] Error Checking service worker registration",t,e)}}(this.config.registrationOptions.scope)}async getOneSignalRegistration(){if(await this.getActiveState()===ha)return this.getRegistration()}async getActiveState(){const t=await this.getRegistration();if(!t)return ga;const e=Oa.activeSwFileName(t);return this.swActiveStateByFileName(e)}static activeSwFileName(t){const e=sa(t);if(!e)return null;const i=new URL(e.scriptURL).pathname,n=new ca(i).getFileName();if("akam-sw.js"==n){const t=new URLSearchParams(new URL(e.scriptURL).search).get("othersw");if(t)return kt.m("Found a ServiceWorker under Akamai's akam-sw.js?othersw=",t),new ca(new URL(t).pathname).getFileName()}return n}swActiveStateByFileName(t){if(!t)return ga;return t==this.config.workerPath.getFileName()||"OneSignalSDK.sw.js"==t?ha:da}async getWorkerVersion(){return new Promise(async t=>{this.context.se.ie(pa,e=>{t(e)}),await this.context.se.unicast(pa)})}async shouldInstallWorker(){if(!B())return!1;if(!OneSignal.config)return!1;const t=await this.getActiveState();if(kt.m("[shouldInstallWorker] workerState",t),t===ga||t===da){const t="granted"===await OneSignal.context.$.getNotificationPermission(OneSignal.config.safariWebId);return t&&kt.S("[shouldInstallWorker] Notification Permissions enabled, will install ServiceWorker"),t}return!!(await this.haveParamsChanged())||this.workerNeedsUpdate()}async haveParamsChanged(){const t=await this.getRegistration();if(!t)return kt.S("[changedServiceWorkerParams] workerRegistration not found at scope",this.config.registrationOptions.scope),!0;const e=new URL(t.scope).pathname,i=this.config.registrationOptions.scope;if(e!=i)return kt.S("[changedServiceWorkerParams] ServiceWorker scope changing",{a_old:e,b_new:i}),!0;const n=sa(t),s=ua(this.config,this.context.et.appId,M);return!n?.scriptURL||s!==n.scriptURL&&(kt.S("[changedServiceWorkerParams] ServiceWorker href changing:",{a_old:n?.scriptURL,b_new:s}),!0)}async workerNeedsUpdate(){let t;kt.S("[Service Worker Update] Checking service worker version...");try{t=await function(t,e){const i=new Promise((t,i)=>{setTimeout(()=>{i(new Error("Async operation timed out"))},e)});return Promise.race([t,i])}(this.getWorkerVersion(),2e3)}catch(e){return kt.S("[Service Worker Update] Worker did not reply to version query; assuming older version and updating."),!0}return t!==M?(kt.S(`[Service Worker Update] Updating service worker from ${t} --\x3e ${M}.`),!0):(kt.S(`[Service Worker Update] Service worker version is current at ${t} (no update required).`),!1)}async establishServiceWorkerChannel(){kt.m("establishServiceWorkerChannel");const t=this.context.se;t.ne(),t.ee(wa,async t=>{kt.m(location.origin,"Received notification display event from service worker.");const e={notification:t.notification,preventDefault:function(){throw new Error("Browser does not support preventing display.")}};await Di.trigger(OneSignal.EVENTS.NOTIFICATION_WILL_DISPLAY,e)}),t.ee(fa,async t=>{0===OneSignal.emitter.numberOfListeners(OneSignal.EVENTS.NOTIFICATION_CLICKED)?kt.m("notification.clicked event received, but no event listeners; storing event in IndexedDb for later retrieval."):await function(t){const e={notification:t.notification,result:t.result};return Di.trigger(OneSignal.EVENTS.NOTIFICATION_CLICKED,e)}(t)}),t.ee(ma,async t=>{await Di.trigger(OneSignal.EVENTS.NOTIFICATION_DISMISSED,t)});const e=U();t.ee(Sa,async i=>{if(e){const e={timestamp:i.timestamp,focused:document.hasFocus()};await t.directPostMessageToSW(va,e)}})}async installWorker(){if(!(await this.shouldInstallWorker()))return this.getOneSignalRegistration();kt.S("Installing worker...");await this.getActiveState()===da&&kt.S("[Service Worker Installation] 3rd party service worker detected.");const t=ua(this.config,this.context.et.appId,M),e=`${It()}${this.config.registrationOptions.scope}`;let i;kt.S(`[Service Worker Installation] Installing service worker ${t} ${e}.`);try{i=await navigator.serviceWorker.register(t,{scope:e,type:void 0})}catch(n){kt.O(`[Service Worker Installation] Installing service worker failed ${n}`),i=await this.fallbackToUserModelBetaWorker()}return kt.m("[Service Worker Installation] Service worker installed. Waiting for activation"),await function(t){return new Promise(e=>{const i=t.installing||t.waiting;i&&i.addEventListener("statechange",()=>{kt.m("OneSignal Service Worker state changed:",i.state),t.active&&e()}),t.active&&e()})}(i),kt.m("[Service Worker Installation] Service worker active"),await this.establishServiceWorkerChannel(),i}async fallbackToUserModelBetaWorker(){const t="OneSignalSDK.sw.js",e=ua({workerPath:new ca(`/${t}`)},this.context.et.appId,M),i=`${It()}${this.config.registrationOptions.scope}`;kt.S(`[Service Worker Installation] Attempting to install v16 Beta Worker ${e} ${i}.`);try{const n=await navigator.serviceWorker.register(e,{scope:i}),s=`\n        [Service Worker Installation] Successfully installed v16 Beta Worker.\n        Deprecation warning: support for the v16 beta worker name of ${t}\n        will be removed May 5 2024. We have decided to keep the v15 name.\n        To avoid breaking changes for your users, please host both worker files:\n        OneSignalSDK.sw.js & OneSignalSDKWorker.js.\n      `;return kt.O(s),n}catch(n){const t=await fetch(e);if(403===t.status||404===t.status)throw new at(t.status,t.statusText);throw n}}}class Ia{te;oe;constructor(t,e){this.te=t,this.oe=e}async st(t,e){t&&(t=Xo.zt(t)),await this.ct()?"lt"in this.te&&await this.te.lt.sendPushDeviceRecordUpdate():"ot"in this.te&&this.te.ot.upsertSession(We);const i=await li();return i.deviceId="99999999-9999-9999-9999-999999999999",i.optedOut=!1,t?R()?i.subscriptionToken=t.safariDeviceToken:i.subscriptionToken=t.w3cEndpoint?t.w3cEndpoint.toString():null:i.subscriptionToken=null,await ui(i),Di.trigger(OneSignal.EVENTS.REGISTERED),"undefined"!=typeof OneSignal&&(OneSignal.rt=!1),i}async ct(){const{deviceId:t}=await li();return!!t}async ae(t,e){const i=await t.getSubscription();switch(e){case us:if(!i)break;i.options?kt.m("[Subscription Manager] An existing push subscription exists and it's options is not null."):(kt.m("[Subscription Manager] An existing push subscription exists and options is null. Unsubscribing from push first now."),await Ia.re(i));break;case hs:i&&await Ia.re(i)}const[n,s]=await Ia.ce(t,this.le());await Ia.ue(s,n.expirationTime);return Xo.jt(n)}le(){let t;return t=T()===O?this.oe.onesignalVapidPublicKey:this.oe.vapidPublicKey,t?function(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=atob(e),n=new Uint8Array(i.length);for(let s=0;s<i.length;++s)n[s]=i.charCodeAt(s);return n}(t).buffer:void 0}static async ue(t,e){const i=await li();t&&(i.createdAt=(new Date).getTime()),i.expirationTime=e,await ui(i)}static async ce(t,e){if(!e)throw new Error("Missing required 'applicationServerKey' to subscribe for push notifications!");const i={userVisibleOnly:!0,applicationServerKey:e};kt.m("[Subscription Manager] Subscribing to web push with these options:",i);try{const e=await t.getSubscription();return[await t.subscribe(i),!e]}catch(n){if(n instanceof Error){kt.v("[Subscription Manager] Couldn't re-subscribe due to applicationServerKey changing, unsubscribe and attempting to subscribe with new key.",n);const e=await t.getSubscription();return e&&await Ia.re(e),[await t.subscribe(i),!0]}throw n}}static async re(t){kt.m("[Subscription Manager] Unsubscribing existing push subscription.");const e=await t.unsubscribe();return kt.m(`[Subscription Manager] Unsubscribing existing push subscription result: ${e}`),e}}const ka=new Error("Not implemented");const xa=async t=>{await na.switchingUsersPromise;let e=await OneSignal.G.getPushSubscriptionModel();if(!e)return e=OneSignal.G.generatePushSubscriptionModel(t),ia.createUserOnServer();if(bs.j(e.id))return ia.createUserOnServer();const i=new ta(t)._();for(const n in i){const t=n;e.setProperty(t,i[t])}};class Ca extends Ia{safariPermissionPromptFailed=!1;async isPushNotificationsEnabled(){const t=await this.getSubscriptionState();return t.subscribed&&!t.optedOut}async updateNotificationTypes(){const t=await this.getNotificationTypes();await this.updatePushSubscriptionNotificationTypes(t)}async updatePushSubscriptionNotificationTypes(t){const e=await OneSignal.G.getPushSubscriptionModel();e?(e.notification_types=t,e.enabled=t===w):kt.S("No Push Subscription yet to update notification_types.")}async getNotificationTypes(){const{optedOut:t}=await li();if(t)return f;return"granted"===await OneSignal.context.$.getPermissionStatus()?w:p}async isOptedIn(){const t=await this.getSubscriptionState();return"granted"===await OneSignal.context.$.getPermissionStatus()&&!t.optedOut}async isOptedOut(t){Pi("isOptedOut",t);const{optedOut:e}=await li();return function(t,...e){if(t)t.apply(null,e)}(t,e),e}async unsubscribe(t){throw ka}async getSubscriptionState(){const{optedOut:t,subscriptionToken:e}=await li(),i=ys(await OneSignal.G.getPushSubscriptionModel());if(R()){const n=window.safari?.pushNotification?.permission(this.oe.safariWebId);return{subscribed:!!(i&&e&&"granted"===n?.permission&&n?.deviceToken),optedOut:!!t}}const n=await this.te.T.getOneSignalRegistration(),s=await this.te.$.getNotificationPermission(this.te.et.safariWebId);if(!n)return{subscribed:!1,optedOut:!!t};return{subscribed:!(!i||!e||"granted"!==s),optedOut:!!t}}async subscribe(t){let e;if("denied"===await OneSignal.context.$.getPermissionStatus())throw ut;if(R()){e=await this.subscribeSafari(),await xa(e),kt.S("Installing SW on Safari");try{await this.te.T.installWorker(),kt.S("SW on Safari successfully installed")}catch(i){kt.O("SW on Safari failed to install.")}}else e=await this.he(t),await xa(e);return e}async subscribeSafari(){const t=new Xo;if(!this.oe.safariWebId)throw dt;const{deviceToken:e}=window.safari?.pushNotification?.permission(this.oe.safariWebId)||{};if(e)return t.Kt(e.toLowerCase()),t;Di.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);const i=await this.subscribeSafariPromptPermission();if(Bi(),!i)throw this.safariPermissionPromptFailed=!0,new Error("Safari url/icon/certificate invalid or in private mode");return t.Kt(i),t}async subscribeSafariPromptPermission(){const t=t=>new Promise(e=>{window.safari?.pushNotification?.requestPermission(t,this.oe.safariWebId,{app_id:this.oe.appId},t=>{t&&t.deviceToken?e(t.deviceToken.toLowerCase()):e(null)})});return this.safariPermissionPromptFailed?t(`${F({legacy:!0}).toString()}safari`):t(`${F({legacy:!0}).toString()}safari/apps/${this.oe.appId}`)}async he(t){if("default"===Notification.permission){await Di.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);const t=await Ca.requestPresubscribeNotificationPermission(),e="default"===t;switch(await Bi(e),t){case"default":throw kt.m("Exiting subscription and not registering worker because the permission was dismissed."),OneSignal.rt=!1,new Error("Permission dismissed");case"denied":throw kt.m("Exiting subscription and not registering worker because the permission was blocked."),OneSignal.rt=!1,ut}}let e;try{e=await this.te.T.installWorker()}catch(i){throw i instanceof at&&(403===i.status?await this.te.A.registerFailedSubscription(m):404===i.status&&await this.te.A.registerFailedSubscription(b)),i}if(!e)throw new Error("OneSignal service worker not found!");return kt.m("[Subscription Manager] Service worker is ready to continue subscribing."),await this.ae(e.pushManager,t)}async registerFailedSubscription(t){fs()&&(this.te.A.st(new Xo,t),ws())}static async requestPresubscribeNotificationPermission(){return await Ca.requestNotificationPermission()}static async requestNotificationPermission(){return await window.Notification.requestPermission()}async isSubscriptionExpiring(){if(await this.te.T.getActiveState()!==ha)return!1;const t=await this.te.T.getOneSignalRegistration();if(!t)return!1;if(!t.pushManager)return!1;const e=await t.pushManager.getSubscription();if(!e)return!1;if(!e.expirationTime)return!1;let{createdAt:i}=await li();if(!i){const t=31536e6;i=(new Date).getTime()+t}const n=i+(e.expirationTime-i)/2;return!!e.expirationTime&&((new Date).getTime()>=e.expirationTime||(new Date).getTime()>=n)}}class Ea{static get STORED_PERMISSION_KEY(){return"storedNotificationPermission"}async getPermissionStatus(){if(!OneSignal.context)throw new Error("OneSignal.context is undefined. Call init first");return await OneSignal.context.$.getNotificationPermission(OneSignal.config.safariWebId)}async getNotificationPermission(t){return R()?Ea.getLegacySafariNotificationPermission(t):this.getW3cNotificationPermission()}static getLegacySafariNotificationPermission(t){if(t)return window.safari?.pushNotification?.permission(t).permission;throw pt("safariWebId")}getW3cNotificationPermission(){return Notification.permission}}class _a{context;onSessionSent=!1;constructor(t){this.context=t}async notifySWToUpsertSession(t,e,i){const n={onesignalId:t,subscriptionId:e,appId:this.context.et.appId,sessionThreshold:this.context.et.sessionThreshold||0,enableSessionDuration:!!this.context.et.enableSessionDuration,sessionOrigin:i,isSafari:U(),outcomesConfig:this.context.et.userConfig.outcomes};B()?(kt.m("Notify SW to upsert session"),await this.context.se.unicast(ba,n)):kt.m("Notify upsert: do nothing")}async notifySWToDeactivateSession(t,e,i){const n={appId:this.context.et.appId,subscriptionId:e,onesignalId:t,sessionThreshold:this.context.et.sessionThreshold,enableSessionDuration:this.context.et.enableSessionDuration,sessionOrigin:i,isSafari:U(),outcomesConfig:this.context.et.userConfig.outcomes};B()?(kt.m("Notify SW to deactivate session"),await this.context.se.unicast(ya,n)):kt.m("Notify deactivate: do nothing")}async de(){const t=OneSignal.G.Y(),e=await OneSignal.G.getPushSubscriptionModel();if(!t||!t.onesignalId)throw new Error("No identity");if(!e||!ys(e))throw new Error("No subscription");const{onesignalId:i}=t,{id:n}=e;return{onesignalId:i,subscriptionId:n}}async handleVisibilityChange(){if(await na.switchingUsersPromise,Ns.singletonInstance?.onesignalId)try{const t=document.visibilityState,{onesignalId:e,subscriptionId:i}=await this.de();if("visible"===t)return this.setupOnFocusAndOnBlurForSession(),kt.m("handleVisibilityChange","visible",`hasFocus: ${document.hasFocus()}`),void(document.hasFocus()&&await this.notifySWToUpsertSession(e,i,je));if("hidden"===t)return kt.m("handleVisibilityChange","hidden"),OneSignal.cache.focusHandler&&OneSignal.cache.isFocusEventSetup&&(window.removeEventListener("focus",OneSignal.cache.focusHandler,!0),OneSignal.cache.isFocusEventSetup=!1),OneSignal.cache.blurHandler&&OneSignal.cache.isBlurEventSetup&&(window.removeEventListener("blur",OneSignal.cache.blurHandler,!0),OneSignal.cache.isBlurEventSetup=!1),void(await this.notifySWToDeactivateSession(e,i,Ke));kt.v("Unhandled visibility state happened",t)}catch(t){kt.O("Error handling visibility change:",t)}}async handleOnBeforeUnload(){if(await na.switchingUsersPromise,Ns.singletonInstance?.onesignalId)try{const{onesignalId:t,subscriptionId:e}=await this.de(),i={appId:this.context.et.appId,onesignalId:t,subscriptionId:e,sessionThreshold:this.context.et.sessionThreshold,enableSessionDuration:this.context.et.enableSessionDuration,sessionOrigin:ze,isSafari:U(),outcomesConfig:this.context.et.userConfig.outcomes};kt.m("Notify SW to deactivate session (beforeunload)"),this.context.se.directPostMessageToSW(ya,i)}catch(t){kt.O("Error handling onbeforeunload:",t)}}async handleOnFocus(t){if(await na.switchingUsersPromise,kt.m("handleOnFocus",t),Ns.singletonInstance?.onesignalId)try{if(t.target!==window)return;const{onesignalId:e,subscriptionId:i}=await this.de();await this.notifySWToUpsertSession(e,i,He)}catch(e){kt.O("Error handling focus:",e)}}async handleOnBlur(t){if(await na.switchingUsersPromise,kt.m("handleOnBlur",t),Ns.singletonInstance?.onesignalId)try{if(t.target!==window)return;const{onesignalId:e,subscriptionId:i}=await this.de();await this.notifySWToDeactivateSession(e,i,Ve)}catch(e){kt.O("Error handling blur:",e)}}async upsertSession(t){if(await na.switchingUsersPromise,Ns.singletonInstance?.onesignalId){const{onesignalId:e,subscriptionId:i}=await this.de();await this.notifySWToUpsertSession(e,i,t)}B()?this.setupSessionEventListeners():(this.onSessionSent=t===We,OneSignal.emitter.emit(OneSignal.EVENTS.SESSION_STARTED))}setupSessionEventListeners(){B()?(this.setupOnFocusAndOnBlurForSession(),OneSignal.cache.isVisibilityChangeEventSetup||(document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this),!0),OneSignal.cache.isVisibilityChangeEventSetup=!0),OneSignal.cache.isBeforeUnloadEventSetup||(window.addEventListener("beforeunload",t=>{this.handleOnBeforeUnload(),delete t.returnValue},!0),OneSignal.cache.isBeforeUnloadEventSetup=!0)):kt.m("Not setting session event listeners. No service worker possible.")}setupOnFocusAndOnBlurForSession(){kt.m("setupOnFocusAndOnBlurForSession"),OneSignal.cache.focusHandler||(OneSignal.cache.focusHandler=this.handleOnFocus.bind(this)),OneSignal.cache.isFocusEventSetup||(window.addEventListener("focus",OneSignal.cache.focusHandler,!0),OneSignal.cache.isFocusEventSetup=!0),OneSignal.cache.blurHandler||(OneSignal.cache.blurHandler=this.handleOnBlur.bind(this)),OneSignal.cache.isBlurEventSetup||(window.addEventListener("blur",OneSignal.cache.blurHandler,!0),OneSignal.cache.isBlurEventSetup=!0)}async sendOnSessionUpdateFromPage(){if(this.onSessionSent||!fs())return;const t=OneSignal.G.Y().onesignalId;if(!t)return void kt.m("Not sending the on session because user is not registered with OneSignal (no onesignal id)");const e=await OneSignal.G.getPushSubscriptionModel();if(e?.notification_types!==w&&!0!==OneSignal.config?.enableOnSession)return;let i;ys(e)&&(i=e?.id);try{const e={label:it,id:t},s={refresh_device_metadata:!0,deltas:{session_count:1}},o=Wi.getAppId();!function(t){if(!t)throw new Error("App id cannot be empty")}(o),function(t){if(!t.id)throw new Error("Alias id cannot be empty")}(e);try{await _t({appId:o,subscriptionId:i},e,s),this.onSessionSent=!0}catch(n){kt.m("Error updating user session:",n)}}catch(n){n instanceof Error&&kt.O(`Failed to update user session. Error "${n.message}" ${n.stack}`)}}}class Pa{context;onSessionSent;constructor(t){this.context=t,this.onSessionSent=ps()>1}async sendPushDeviceRecordUpdate(){Ns.singletonInstance?.onesignalId?this.onSessionSent||await this.sendOnSessionUpdate():kt.m("Not sending the update because user is not registered with OneSignal (no onesignal_id)")}async sendOnSessionUpdate(){if(this.onSessionSent)return;if(!fs())return;if(!(await this.context.A.ct()))return void kt.m("Not sending the on session because user is not registered with OneSignal (no device id)");const t=await OneSignal.G.getPushSubscriptionModel();if(t?.notification_types===w||!0===OneSignal.config?.enableOnSession)try{this.context.ot.upsertSession(Fe),this.onSessionSent=!0}catch(e){e instanceof Error&&kt.O(`Failed to update user session. Error "${e.message}" ${e.stack}`)}}async sendOutcomeDirect(t,e,i,n){Pi("sendOutcomeDirect");const s=await OneSignal.G.getPushSubscriptionModel();if(s&&ys(s)){const o={id:i,app_id:t,notification_ids:e,direct:!0,subscription:{id:s.id,type:j()}};return void 0!==n&&(o.weight=n),void(await Ut.sendOutcome(o))}kt.v("Send outcome aborted because pushSubscriptionModel is not available.")}async sendOutcomeInfluenced(t,e,i,n){Pi("sendOutcomeInfluenced");const s=await OneSignal.G.getPushSubscriptionModel();if(s&&ys(s)){const o={id:i,app_id:t,notification_ids:e,direct:!1,subscription:{id:s.id,type:j()}};return void 0!==n&&(o.weight=n),void(await Ut.sendOutcome(o))}kt.v("Send outcome aborted because pushSubscriptionModel is not available.")}async sendOutcomeUnattributed(t,e,i){Pi("sendOutcomeUnattributed");const n=await OneSignal.G.getPushSubscriptionModel();if(n&&ys(n)){const s={id:e,app_id:t,subscription:{id:n.id,type:j()}};return void 0!==i&&(s.weight=i),void(await Ut.sendOutcome(s))}kt.v("Send outcome aborted because pushSubscriptionModel is not available.")}}const $a="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/css/intlTelInput.min.css",Ta="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/js/intlTelInput.min.js",Na="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/js/utils.js",Aa="sha512-yye/u0ehQsrVrfSd6biT17t39Rg9kNc+vENcCXZuMz2a+LWFGvXUnYuWUW6pbfYj1jcBb/C39UZw2ciQvwDDvg==",Ma="sha512-OnkjbJ4TwPpgSmjXACCb5J4cJwi880VRe+vWpPDlr8M38/L3slN5uUAeOeWU2jN+4vN0gImCXFGdJmc0wO4Mig==",Da="sha512-bUcJxlqkiGA3cmoYPuZaLRsyc5ChG9APG4ajom2AXKSlBtOmx4kLV3c8uv/6uSz43FMjI4Q2QI21+D223rT76w==";class Ua{smsInputFieldIsValid=!0;emailInputFieldIsValid=!0;promptOptions;itiOneSignal;constructor(t){this.promptOptions=t}generateHtml(){const t=document.createElement("div");let e,i,n;switch(pi(t,zn),t.id=zn,this.promptOptions.type){case zt:e=this.promptOptions.text.smsLabel||"Phone Number",i=this.getInputWithValidationElement(zt,e),t.appendChild(i);break;case Ht:e=this.promptOptions.text.emailLabel||"Email",n=this.getInputWithValidationElement(Ht,e),t.appendChild(n);break;case Vt:e=this.promptOptions.text.emailLabel||"Email",n=this.getInputWithValidationElement(Ht,e),t.appendChild(n),e=this.promptOptions.text.smsLabel||"Phone Number",i=this.getInputWithValidationElement(zt,e),t.appendChild(i)}return t}getValidationElementWithMessage(t){const e=document.createElement("div"),i=document.createElement("img"),n=document.createElement("p");return n.innerText=t,i.setAttribute("src","data:image/svg+xml;charset=UTF-8,%3csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M7.98775 -0.00114406C5.85015 0.0338508 3.81219 0.908665 2.31442 2.43419C1.565 3.18031 0.973715 4.06987 0.575897 5.04969C0.17808 6.02952 -0.0180997 7.07949 -0.000914196 8.13686C-0.00214385 9.17005 0.200528 10.1933 0.595487 11.148C0.990446 12.1028 1.56993 12.9702 2.30072 13.7005C3.03151 14.4309 3.89925 15.0098 4.85421 15.4042C5.80916 15.7986 6.83256 16.0007 7.86575 15.9989H8.00842C10.1467 15.9769 12.1889 15.1075 13.6869 13.5816C15.185 12.0557 16.0165 9.99781 15.9991 7.85952C16.0015 6.8138 15.7949 5.77814 15.3913 4.81345C14.9876 3.84876 14.3952 2.97451 13.6488 2.24213C12.9023 1.50974 12.017 0.933994 11.0448 0.548751C10.0726 0.163508 9.03324 -0.0234551 7.98775 -0.00114406ZM6.99909 11.0269C6.99428 10.8961 7.01558 10.7658 7.06175 10.6434C7.10792 10.521 7.17803 10.4091 7.26797 10.3141C7.35792 10.2191 7.4659 10.143 7.58559 10.0903C7.70529 10.0375 7.8343 10.0092 7.96509 10.0069H7.98309C8.24616 10.0074 8.49882 10.1097 8.6881 10.2924C8.87739 10.4751 8.9886 10.724 8.99842 10.9869C9.00331 11.1176 8.98207 11.248 8.93594 11.3704C8.8898 11.4928 8.8197 11.6048 8.72974 11.6998C8.63978 11.7948 8.53176 11.8709 8.41202 11.9236C8.29229 11.9763 8.16323 12.0046 8.03242 12.0069H8.01442C7.75145 12.006 7.49897 11.9036 7.30976 11.721C7.12054 11.5383 7.00923 11.2896 6.99909 11.0269ZM7.33242 8.33219V4.33219C7.33242 4.15538 7.40266 3.98581 7.52768 3.86079C7.65271 3.73576 7.82227 3.66552 7.99909 3.66552C8.1759 3.66552 8.34547 3.73576 8.47049 3.86079C8.59551 3.98581 8.66575 4.15538 8.66575 4.33219V8.33219C8.66575 8.509 8.59551 8.67857 8.47049 8.80359C8.34547 8.92862 8.1759 8.99886 7.99909 8.99886C7.82227 8.99886 7.65271 8.92862 7.52768 8.80359C7.40266 8.67857 7.33242 8.509 7.33242 8.33219Z' fill='%23E54B4D'/%3e%3c/svg%3e"),e.appendChild(i),e.appendChild(n),e}getInputWithValidationElement(t,e){const i=this.getTypeSpecificVariablesForValidationElemGeneration(t),n=document.createElement("label"),s=document.createElement("input"),o=document.createElement("div"),a=document.createElement("div"),r=this.getValidationElementWithMessage(i.message),c=document.createElement("div");return o.setAttribute("style","clear:both"),a.setAttribute("style","clear:both"),pi(r,Jn),pi(r,Yn),r.id=i.validationElementId,n.title=e,n.innerText=e,n.htmlFor=i.inputElementId,s.type=i.domElementType,s.id=i.inputElementId,s.tabIndex=i.tabIndex,pi(s,i.inputClass),pi(c,Hn),c.id=i.wrappingDivId,c.appendChild(n),c.appendChild(o),c.appendChild(s),c.appendChild(a),c.appendChild(r),c}getTypeSpecificVariablesForValidationElemGeneration(t){if(t===Ht)return{message:"Please enter a valid email",domElementType:"email",validationElementId:is,inputElementId:ts,inputClass:Gn,wrappingDivId:Zn,tabIndex:1};if(t===zt)return{message:"Please enter a valid phone number",domElementType:"tel",validationElementId:es,inputElementId:Xn,inputClass:qn,wrappingDivId:Qn,tabIndex:2};throw new Error("invalid channel type for input validation")}initializePhoneInputLibrary(){const t=gi(`#${Xn}`);t&&window.intlTelInput?this.itiOneSignal=window.intlTelInput(t,{autoPlaceholder:"off",separateDialCode:!0}):kt.O("OneSignal: there was a problem initializing International Telephone Input")}addSmsInputEventListeners(){const t=gi(`#${Xn}`);t.addEventListener("keyup",e=>{this.smsInputFieldIsValid=this.itiOneSignal?.isValidNumber()||""===t?.value,"Enter"===e.key&&document.getElementById(Sn)?.click(),this.updateValidationOnSmsInputChange()}),t.addEventListener("blur",()=>{this.smsInputFieldIsValid=this.itiOneSignal?.isValidNumber()||""===t?.value,this.updateValidationOnSmsInputChange()})}addEmailInputEventListeners(){const t=gi(`#${ts}`);t.addEventListener("keyup",e=>{const i=t?.value;this.emailInputFieldIsValid=Ua.validateEmailInputWithReturnVal(i),"Enter"===e.key&&document.getElementById(Sn)?.click(),this.updateValidationOnEmailInputChange()})}updateValidationOnSmsInputChange(){const t=gi(`#${Qn}`),e=gi(`#${es}`);wi(t,Vn),pi(e,Jn)}updateValidationOnEmailInputChange(){const t=gi(`#${Zn}`),e=gi(`#${is}`);wi(t,Vn),pi(e,Jn)}async loadPhoneLibraryScripts(){if(OneSignal.ge)return;const t=document.createElement("script"),e=document.createElement("script"),i=document.createElement("link");t.src=Ta,e.src=Na,i.href=$a,i.rel="stylesheet",t.integrity=Ma,e.integrity=Da,i.integrity=Aa,t.crossOrigin="anonymous",e.crossOrigin="anonymous",i.crossOrigin="anonymous",document.head.appendChild(t),document.head.appendChild(e),document.head.appendChild(i);const n=new Promise(e=>{t.onload=()=>{e()}}),s=new Promise(t=>{e.onload=()=>{t()}});await Promise.all([n,s]),OneSignal.ge=!0}async mount(){const t=Ua.isUsingSmsInputField(this.promptOptions.type),e=Ua.isUsingEmailInputField(this.promptOptions.type);t&&await this.loadPhoneLibraryScripts();const i=this.generateHtml();gi(`#${vn}`).appendChild(i),t&&(this.initializePhoneInputLibrary(),this.addSmsInputEventListeners()),e&&this.addEmailInputEventListeners()}isEmailInputFieldEmpty(){return""===this.getValueFromEmailInput()}isSmsInputFieldEmpty(){return""===this.getValueFromSmsInput()}getValueFromEmailInput(){const t=gi(`#${ts}`);return t?.value||""}getValueFromSmsInput(){return this.itiOneSignal?.getNumber(window.intlTelInputUtils?.numberFormat.E164)||""}static showSmsInputError(t){const e=document.querySelector(`#${es}`),i=document.querySelector(`#${Qn}`);e&&i?t?(e.classList.remove(Jn),i.classList.add(Vn)):(e.classList.add(Jn),i.classList.remove(Vn)):kt.O("OneSignal: couldn't find slidedown validation element")}static showEmailInputError(t){const e=document.querySelector(`#${is}`),i=document.querySelector(`#${Zn}`);e&&i?t?(e.classList.remove(Jn),i.classList.add(Vn)):(e.classList.add(Jn),i.classList.remove(Vn)):kt.O("OneSignal: couldn't find slidedown validation element")}static resetInputErrorStates(t){switch(t){case zt:Ua.showSmsInputError(!1);break;case Ht:Ua.showEmailInputError(!1);break;case Vt:Ua.showSmsInputError(!1),Ua.showEmailInputError(!1)}}static validateEmailInputWithReturnVal(t){return/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(t||"")||""===t}static isUsingSmsInputField(t){return t===zt||t===Vt}static isUsingEmailInputField(t){return t===Ht||t===Vt}}function Ba(t){return`<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="24px" height="24px" fill="${t}"> <g transform="rotate(0 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.916s" repeatCount="indefinite"/> </rect> </g> <g transform="rotate(30 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.833s" repeatCount="indefinite"/> </rect> </g> <g transform="rotate(60 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.75s" repeatCount="indefinite"/> </rect> </g> <g transform="rotate(90 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.666s"/> </rect> </g> <g transform="rotate(120 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.583s"/> </rect> </g> <g transform="rotate(150 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.5s"/> </rect> </g> <g transform="rotate(180 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.416s"/> </rect> </g> <g transform="rotate(210 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.333s"/> </rect> </g> <g transform="rotate(240 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.25s"/> </rect> </g> <g transform="rotate(270 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.166s"/> </rect> </g> <g transform="rotate(300 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.083s"/> </rect> </g> <g transform="rotate(330 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="0s"/> </rect> </g> </svg>`}class La{options;notificationIcons;channelCaptureContainer;isShowingFailureState;tagCategories;savingButton=Xt;errorButton=Qt;updateMessage;positiveUpdateButton;negativeUpdateButton;constructor(t){switch(this.options=t,this.options.text.actionMessage=t.text.actionMessage.substring(0,90),this.options.text.acceptButton=t.text.acceptButton.substring(0,16),this.options.text.cancelButton=t.text.cancelButton.substring(0,16),this.notificationIcons=null,this.channelCaptureContainer=null,this.isShowingFailureState=!1,t.type){case Kt:this.negativeUpdateButton=this.options.text.negativeUpdateButton?.substring(0,16),this.positiveUpdateButton=this.options.text.positiveUpdateButton?.substring(0,16),this.updateMessage=this.options.text.updateMessage?.substring(0,90),this.tagCategories=t.categories,this.errorButton=Ot(this.options.text.positiveUpdateButton,Qt);break;case zt:case Ht:case Vt:this.errorButton=Ot(this.options.text.acceptButton,Qt)}}async create(t){if(null===this.notificationIcons){const e=await Wi.getNotificationIcons();this.notificationIcons=e,this.container.className.includes(on)&&di(`#${kn}`);const i=t&&this.tagCategories?this.positiveUpdateButton:this.options.text.acceptButton,n=t&&this.tagCategories?this.negativeUpdateButton:this.options.text.cancelButton,s=function(t){const{icon:e,messageText:i,positiveButtonText:n,negativeButtonText:s}=t,o=e===wn?"data:image/svg+xml,%3Csvg fill='none' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'%3E%3Cg clip-path='url(%23clip0)'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M33.232 28.434a2.5 2.5 0 001.768.733 1.667 1.667 0 010 3.333H5a1.667 1.667 0 110-3.333 2.5 2.5 0 002.5-2.5v-8.104A13.262 13.262 0 0118.333 5.122V1.667a1.666 1.666 0 113.334 0v3.455A13.262 13.262 0 0132.5 18.563v8.104a2.5 2.5 0 00.732 1.767zM16.273 35h7.454a.413.413 0 01.413.37 4.167 4.167 0 11-8.28 0 .417.417 0 01.413-.37z' fill='%23BDC4CB'/%3E%3C/g%3E%3Cdefs%3E%3CclipPath id='clip0'%3E%3Cpath fill='%23fff' d='M0 0h40v40H0z'/%3E%3C/clipPath%3E%3C/defs%3E%3C/svg%3E":e,a=e===wn?wn:"",r=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div"),h=document.createElement("div"),d=document.createElement("div"),g=document.createElement("button"),p=document.createElement("button"),w=document.createElement("div"),f=document.createElement("div"),m=document.createElement("img");return pi(c,nn),pi(u,gn),pi(l,pn),pi(d,rn),pi(w,mn),pi(f,mn),pi(g,Pn),pi(g,$n),pi(g,Nn),pi(p,Pn),pi(p,Tn),pi(p,Nn),r.id=En,c.id=vn,h.id=_n,g.id=Sn,p.id=In,d.id=Cn,a&&pi(m,a),m.setAttribute("alt","notification icon"),m.setAttribute("src",o||""),l.innerText=i||"",g.innerText=n||"",p.innerText=s||"",u.appendChild(m),c.appendChild(u),c.appendChild(l),c.appendChild(w),c.appendChild(h),d.appendChild(g),d.appendChild(p),d.appendChild(f),r.appendChild(c),r.appendChild(d),r}({messageText:t&&this.tagCategories?this.updateMessage:this.options.text.actionMessage,icon:this.options.icon||this.getPlatformNotificationIcon(),positiveButtonText:i,negativeButtonText:n}),o=document.createElement("div"),a=document.createElement("div");o.id=kn,pi(o,on),pi(o,cn),gi("body").appendChild(o),a.id=xn,pi(a,an),a.appendChild(s),this.container.appendChild(a),pi(this.container,P()?un:hn),this.allowButton.addEventListener("click",this.onSlidedownAllowed.bind(this)),this.cancelButton.addEventListener("click",this.onSlidedownCanceled.bind(this))}}static async triggerSlidedownEvent(t){await Di.trigger(t)}async onSlidedownAllowed(t){await La.triggerSlidedownEvent(La.EVENTS.ALLOW_CLICK)}onSlidedownCanceled(t){La.triggerSlidedownEvent(La.EVENTS.CANCEL_CLICK),this.close(),La.triggerSlidedownEvent(La.EVENTS.CLOSED)}close(){pi(this.container,dn),$i(this.dialog,"animationend",(t,e)=>{t.target!==this.dialog||"slideDownExit"!==t.animationName&&"slideUpExit"!==t.animationName||(di(`#${kn}`),e())},!0)}setSaveState(){this.allowButton.disabled=!0,this.allowButton.textContent=null,this.allowButton.insertAdjacentElement("beforeend",this.getTextSpan(this.savingButton)),this.allowButton.insertAdjacentElement("beforeend",this.getIndicatorHolder()),hi(this.buttonIndicatorHolder,"beforeend",Ba(jn)),pi(this.allowButton,"disabled"),pi(this.allowButton,ln)}removeSaveState(){this.allowButton.textContent=this.positiveUpdateButton??"",di(`#${sn}`),this.allowButton.disabled=!1,wi(this.allowButton,"disabled"),wi(this.allowButton,ln)}setFailureState(){this.allowButton.textContent=null,this.allowButton.insertAdjacentElement("beforeend",this.getTextSpan(this.errorButton)),this.options.type===Kt&&(this.allowButton.insertAdjacentElement("beforeend",this.getIndicatorHolder()),hi(this.buttonIndicatorHolder,"beforeend",function(t="#FFFFFF"){return`<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.711 2.652a5.489 5.489 0 00-4.044 4.05 5.513 5.513 0 00.104 2.968.167.167 0 00.25.089l.893-.588a.667.667 0 011.02.692l-.61 2.937a.667.667 0 01-.786.52L.6 12.713a.667.667 0 01-.232-1.21l.933-.615a.166.166 0 00.063-.2 7.167 7.167 0 018.828-9.516.833.833 0 01-.507 1.587 5.489 5.489 0 00-2.974-.108zM15.75 3.542c.09.096.15.216.172.346a.667.667 0 01-.301.681l-.898.564a.166.166 0 00-.066.2 7.167 7.167 0 01-8.77 9.514.835.835 0 01-.154-1.544.831.831 0 01.646-.048 5.5 5.5 0 006.856-6.949.167.167 0 00-.176-.114.164.164 0 00-.071.026l-.962.604a.667.667 0 01-1.005-.713l.667-2.924a.667.667 0 01.8-.502l2.925.667c.129.03.246.096.336.192z" fill="${t}"/></svg>`}()),pi(this.allowButton,"onesignal-error-state-button")),this.isShowingFailureState=!0}setFailureStateForInvalidChannelInput(t){switch(t){case nt:Ua.showSmsInputError(!0);break;case st:Ua.showEmailInputError(!0);break;case ot:Ua.showSmsInputError(!0),Ua.showEmailInputError(!0)}}removeFailureState(){di("#onesignal-button-indicator-holder"),wi(this.allowButton,"onesignal-error-state-button"),Ls(this.options.type)||Ua.resetInputErrorStates(this.options.type),this.isShowingFailureState=!1}getPlatformNotificationIcon(){return Ni(this.notificationIcons)}getIndicatorHolder(){const t=document.createElement("div");return t.id=On,pi(t,sn),t}getTextSpan(t){const e=document.createElement("span");return e.textContent=t,e}get container(){return gi(`#${kn}`)}get dialog(){return gi(`#${xn}`)}get allowButton(){return gi(`#${Sn}`)}get cancelButton(){return gi(`#${In}`)}get buttonIndicatorHolder(){return gi(`#${On}`)}get slidedownFooter(){return gi(`#${Cn}`)}static get EVENTS(){return{ALLOW_CLICK:"slidedownAllowClick",CANCEL_CLICK:"slidedownCancelClick",SHOWN:"slidedownShown",CLOSED:"slidedownClosed",QUEUED:"slidedownQueued"}}}class Ra{isNativePromptShowing;context;eventHooksInstalled;constructor(t){this.isNativePromptShowing=!1,this.context=t,this.eventHooksInstalled=!1}shouldForceSlidedownOverNative(){const t=N();return T()===y&&t>=63&&(_()||P())||A()}async spawnAutoPrompts(){const t=OneSignal.config?.userConfig.promptOptions,e=this.shouldForceSlidedownOverNative(),i=this.getDelayedPromptOptions(t,Ft),n=this.isPageViewConditionMet(i),s=i.enabled&&n,o=e&&s;if(s&&!o)return void this.internalShowDelayedPrompt(Ft,i.timeDelay||0);const a=!!Bs(t?.slidedown?.prompts,jt);o&&!a&&this.internalShowDelayedPrompt(jt,i.timeDelay||0);const r=t?.slidedown?.prompts;if(r&&r?.length>0)for(let c=0;c<r.length;c++){const e=r[c],i=this.getDelayedPromptOptions(t,e.type),n=this.isPageViewConditionMet(i),s={slidedownPromptOptions:e};i.enabled&&n&&this.internalShowDelayedPrompt(e.type,i.timeDelay||0,s)}}async internalShowDelayedPrompt(t,e,i){if(Pi("internalShowDelayedPrompt"),"number"==typeof e)switch(A()&&t===Ft&&(t=jt),e>0&&await St(1e3*e),t){case Ft:await this.internalShowNativePrompt();break;case jt:await this.internalShowSlidedownPrompt(i);break;case Kt:await this.internalShowCategorySlidedown(i);break;case zt:await this.internalShowSmsSlidedown(i);break;case Ht:await this.internalShowEmailSlidedown(i);break;case Vt:await this.internalShowSmsAndEmailSlidedown(i);break;default:kt.O("Invalid Delayed Prompt type")}else kt.O("internalShowDelayedPrompt: timeDelay not a number")}async internalShowNativePrompt(){Pi("internalShowNativePrompt"),this.isNativePromptShowing?kt.m("Already showing autoprompt. Abort showing a native prompt."):(this.isNativePromptShowing=!0,await Vs(),this.isNativePromptShowing=!1,Ei.markPromptDismissedWithType(bi))}async internalShowSlidedownPrompt(t={force:!1}){Pi("internalShowSlidedownPrompt"),t.slidedownPromptOptions||(t.slidedownPromptOptions=ee);await this.context.W.loadSdkStylesheet()===Ki?(this.eventHooksInstalled||this.installEventHooksForSlidedown(),await this.context.pe.createSlidedown(t)):kt.m("Not showing slidedown permission message because styles failed to load.")}async internalShowCategorySlidedown(t){Pi("internalShowCategorySlidedown"),await this.internalShowParticularSlidedown(Kt,t)}async internalShowSmsSlidedown(t){Pi("internalShowSmsSlidedown"),await this.internalShowParticularSlidedown(zt,t)}async internalShowEmailSlidedown(t){Pi("internalShowEmailSlidedown"),await this.internalShowParticularSlidedown(Ht,t)}async internalShowSmsAndEmailSlidedown(t){Pi("internalShowSmsAndEmailSlidedown"),await this.internalShowParticularSlidedown(Vt,t)}async internalShowParticularSlidedown(t,e){const i=this.context.et.userConfig.promptOptions?.slidedown?.prompts,n=e?.slidedownPromptOptions||Bs(i,t);if(!n){if(t!==jt)return void kt.O(`OneSignal: slidedown of type '${t}' couldn't be shown. Check your configuration on the OneSignal dashboard or your custom code initialization.`);kt.v("The OneSignal 'push' slidedown will be shown with default text settings. To customize, see the OneSignal documentation.")}await this.internalShowSlidedownPrompt({...e,slidedownPromptOptions:n})}installEventHooksForSlidedown(){this.eventHooksInstalled=!0,OneSignal.emitter.on(La.EVENTS.SHOWN,()=>{this.context.pe.setIsSlidedownShowing(!0)}),OneSignal.emitter.on(La.EVENTS.CLOSED,()=>{this.context.pe.setIsSlidedownShowing(!1),this.context.pe.showQueued()}),OneSignal.emitter.on(La.EVENTS.ALLOW_CLICK,async()=>{await this.context.pe.handleAllowClick(),Di.trigger(OneSignal.EVENTS.TEST_FINISHED_ALLOW_CLICK_HANDLING)}),OneSignal.emitter.on(La.EVENTS.CANCEL_CLICK,()=>{if(!this.context.pe.slidedown)return;const t=this.context.pe.slidedown?.options.type;switch(t){case jt:case Kt:kt.m("Setting flag to not show the slidedown to the user again."),Ei.markPromptDismissedWithType(bi);break;default:kt.m("Setting flag to not show the slidedown to the user again."),Ei.markPromptDismissedWithType(yi)}})}isPageViewConditionMet(t){if(!t||void 0===t.pageViews)return!1;if(!t.autoPrompt||!t.enabled)return!1;return ni()>=t.pageViews}getDelayedPromptOptions(t,e){const i={enabled:!1,autoPrompt:!1,timeDelay:qt.timeDelay,pageViews:qt.pageViews};if(!t||!t.native||!t.slidedown)return i;switch(e){case Ft:{const e=t.native;return{enabled:e?.enabled,autoPrompt:e?.autoPrompt,timeDelay:e?.timeDelay,pageViews:e?.pageViews}}case jt:case Kt:case Ht:case zt:case Vt:{const{userConfig:t}=this.context.et,i=Bs(t.promptOptions?.slidedown?.prompts||[],e);return{enabled:!!i,autoPrompt:!!i?.autoPrompt,timeDelay:i?.delay?.timeDelay,pageViews:i?.delay?.pageViews}}default:return i}}}class Wa{static convertTagsApiToBooleans(t){const e={};return Object.keys(t).forEach(i=>{e[i]="1"===t[i]}),e}static convertTagsBooleansToApi(t){const e={};return Object.keys(t).forEach(i=>{e[i]=!0===t[i]?"1":"0"}),e}static getObjectDifference(t,e){const i={};return Object.keys(t).forEach(n=>{e[n]!==t[n]&&(i[n]=t[n])}),i}static markAllTagsAsSpecified(t,e){t.forEach(t=>{t.checked=e})}static isTagObjectEmpty(t){return 0===Object.keys(t).length}static getCheckedTagCategories(t,e){if(!e)return t;if(Wa.isTagObjectEmpty(e)){const e=structuredClone(t);return Wa.markAllTagsAsSpecified(e,!0),e}return structuredClone(t).map(t=>{const i=e[t.tag];return t.checked=Wa.getCheckedStatusForTagValue(i),t})}static getCheckedStatusForTagValue(t){return void 0===t||t}}class Fa{message;constructor(t){this.message=t}async show(){const t=document.createElement("div"),e=document.createElement("p");e.innerText=this.message,t.appendChild(e);const i=document.createElement("div"),n=document.createElement("div");i.id=kn,t.id=yn,pi(t,bn),pi(i,on),pi(i,cn),gi("body").appendChild(i),n.id=xn,pi(n,an),n.appendChild(t),this.container.appendChild(n),pi(this.container,P()?un:hn),Fa.triggerSlidedownEvent(Fa.EVENTS.SHOWN)}static async triggerSlidedownEvent(t){await Di.trigger(t)}close(){pi(this.container,dn),$i(this.dialog,"animationend",(t,e)=>{t.target!==this.dialog||"slideDownExit"!==t.animationName&&"slideUpExit"!==t.animationName||(di(`#${kn}`),e())},!0)}get container(){return gi(`#${kn}`)}get dialog(){return gi(`#${xn}`)}static get EVENTS(){return{SHOWN:"toastShown",CLOSED:"toastClosed"}}}class ja{mount(t,e){const i=this.generateHtml(t,e);gi(`#${vn}`).appendChild(i),this.taggingContainer&&this.taggingContainer.addEventListener("change",this.toggleCheckedTag);const n=gi(`#${Sn}`);n.disabled=!1,wi(n,"disabled"),di(`#${_n}`)}load(){const t=gi(`#${_n}`),e=gi(`#${Sn}`),i=document.createElement("div");pi(t,`${fn}`),pi(i,Rn),pi(e,"disabled"),hi(t,"beforeend",Ba(Fn)),i.innerText=Kn,t.appendChild(i),e.disabled=!0}generateHtml(t,e){const i=Wa.getCheckedTagCategories(t,e),n=i.filter(t=>i.indexOf(t)%2==0),s=i.filter(t=>i.indexOf(t)%2),o=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");return pi(o,Ln),pi(a,Ln),pi(r,Bn),r.id=Wn,n.forEach(t=>{o.appendChild(this.getCategoryLabelElement(t))}),s.forEach(t=>{a.appendChild(this.getCategoryLabelElement(t))}),r.appendChild(o),r.appendChild(a),r}getCategoryLabelElement(t){const{label:e}=t,i=document.createElement("label"),n=document.createElement("span"),s=document.createElement("input"),o=document.createElement("span"),a=document.createElement("div"),r=document.createElement("div");return pi(i,Dn),pi(n,Mn),pi(s,An),pi(o,Un),i.title=e,n.innerText=e,s.type="checkbox",s.value=t.tag,s.checked=!!t.checked,i.appendChild(n),i.appendChild(s),i.appendChild(o),a.setAttribute("style","clear:both"),r.appendChild(i),r.appendChild(a),r}get taggingContainer(){return gi(`#${vn} > div.${Bn}`)}toggleCheckedTag(t){const e=t.target;if(e&&"checkbox"===e.getAttribute("type")){const t=e.checked;e.setAttribute("checked",t.toString())}}static getValuesFromTaggingContainer(){const t=`#${vn} > div.${Bn}> div > div > label > input[type=checkbox]`,e=document.querySelectorAll(t),i={};return e.forEach(t=>{i[t.value]=t.checked}),i}}class Ka{context;slidedownQueue;isSlidedownShowing;slidedown;constructor(t){this.context=t,this.slidedownQueue=[],this.isSlidedownShowing=!1}async checkIfSlidedownShouldBeShown(t){const e="denied"===await OneSignal.context.$.getPermissionStatus();let i;const n=await OneSignal.context.A.getSubscriptionState(),{subscribed:s,optedOut:o}=n,a=t.slidedownPromptOptions?.type;let r=!1;if(a&&(r=Ls(a)),r){if(s)return!!t.isInUpdateMode||(kt.S(new Error("User is already subscribed")),!1);if(i=Ei.wasPromptOfTypeDismissed(bi),o)throw new Error("User is opted out");if(e)return kt.S(ut),!1}else{if(!t.force){const t=await OneSignal.G.hasSms(),e=await OneSignal.G.hasEmail(),i=t&&e;if(t&&a===zt)return kt.S(gt(zt)),!1;if(e&&a===Ht)return kt.S(gt(Ht)),!1;if(i&&a===Vt)return kt.S(gt(Vt)),!1}i=Ei.wasPromptOfTypeDismissed(yi)}return!(i&&!t.force&&!t.isInUpdateMode)||(kt.S(new Error(`${a||"unknown"} was previously dismissed`)),!1)}async handleAllowForCategoryType(){if(!this.slidedown)throw za;const t=ja.getValuesFromTaggingContainer();this.context.it.storeTagValuesToUpdate(t),Vs(),await this.context.it.sendTags(!0)}async handleAllowForEmailType(){if(!this.slidedown)throw za;const t=this.slidedown.channelCaptureContainer?.emailInputFieldIsValid,e=this.slidedown.channelCaptureContainer?.isEmailInputFieldEmpty();if(!t||e)throw new rt(st);const i=this.slidedown.channelCaptureContainer?.getValueFromEmailInput();this.updateEmail(i)}async handleAllowForSmsType(){if(!this.slidedown)throw za;const t=this.slidedown.channelCaptureContainer?.smsInputFieldIsValid,e=this.slidedown.channelCaptureContainer?.isSmsInputFieldEmpty();if(!t||e)throw new rt(nt);const i=this.slidedown.channelCaptureContainer?.getValueFromSmsInput();this.updateSMS(i)}async handleAllowForSmsAndEmailType(){if(!this.slidedown)throw za;const t=this.slidedown.channelCaptureContainer?.smsInputFieldIsValid,e=this.slidedown.channelCaptureContainer?.emailInputFieldIsValid,i=this.slidedown.channelCaptureContainer?.isEmailInputFieldEmpty(),n=this.slidedown.channelCaptureContainer?.isSmsInputFieldEmpty();if(!t&&!e||i&&n)throw new rt(ot);const s=this.slidedown.channelCaptureContainer?.getValueFromEmailInput(),o=this.slidedown.channelCaptureContainer?.getValueFromSmsInput();if(!e)throw new rt(st);if(i||this.updateEmail(s),!t)throw new rt(nt);n||this.updateSMS(o)}updateEmail(t){t&&OneSignal.User.addEmail(t)}updateSMS(t){t&&OneSignal.User.addSms(t)}async showConfirmationToast(){if(!this.slidedown)throw za;const t=this.slidedown.options.text.confirmMessage;if(!t)return;await St(1e3);const e=new Fa(t);await e.show(),await St(5e3),e.close(),Fa.triggerSlidedownEvent(Fa.EVENTS.CLOSED)}async mountAuxiliaryContainers(t){switch(t.slidedownPromptOptions?.type){case Kt:this.mountTaggingContainer(t);break;case Ht:case zt:case Vt:await this.mountChannelCaptureContainer(t)}}async mountTaggingContainer(t){Pi("mountTaggingContainer");try{let e={};const i=new ja,n=t.slidedownPromptOptions?.categories;if(!n)throw new Error("Categories not defined");const s=OneSignal.G.Z().tags;t.isInUpdateMode&&s?(this.context.it.storeRemotePlayerTags(s),e=Wa.convertTagsApiToBooleans(s)):Wa.markAllTagsAsSpecified(n,!0),i.mount(n,e)}catch(e){kt.O("OneSignal: Attempted to create tagging container with error",e)}}async mountChannelCaptureContainer(t){Pi("mountChannelCaptureContainer");try{if(t.slidedownPromptOptions){const e=new Ua(t.slidedownPromptOptions);e.mount(),this.slidedown&&(this.slidedown.channelCaptureContainer=e)}}catch(e){kt.O("OneSignal: Attempted to create channel capture container with error",e)}}async handleAllowClick(){if(!this.slidedown)throw za;const t=this.slidedown.options.type;this.slidedown.isShowingFailureState&&this.slidedown.removeFailureState();try{switch(t){case jt:Vs();break;case Kt:await this.handleAllowForCategoryType();break;case Ht:await this.handleAllowForEmailType();break;case zt:await this.handleAllowForSmsType();break;case Vt:await this.handleAllowForSmsAndEmailType()}}catch(e){return kt.v("OneSignal Slidedown failed to update:",e),this.slidedown.removeSaveState(),this.slidedown.setFailureState(),void(e instanceof rt&&this.slidedown.setFailureStateForInvalidChannelInput(e.reason))}switch(this.slidedown&&(this.slidedown.close(),Ls(t)||await this.showConfirmationToast(),await St(1e3),La.triggerSlidedownEvent(La.EVENTS.CLOSED)),t){case jt:case Kt:kt.m("Setting flag to not show the slidedown to the user again."),Ei.markPromptDismissedWithType(bi);break;default:kt.m("Setting flag to not show the slidedown to the user again."),Ei.markPromptDismissedWithType(yi)}}setIsSlidedownShowing(t){this.isSlidedownShowing=t}async showQueued(){if(this.slidedownQueue.length>0){const t=this.dequeue();t&&await this.createSlidedown(t)}}enqueue(t){this.slidedownQueue.push(t),La.triggerSlidedownEvent(La.EVENTS.QUEUED)}dequeue(){return this.slidedownQueue.shift()}async createSlidedown(t){if(Pi("createSlidedown"),!ri()){try{if(!(await this.checkIfSlidedownShouldBeShown(t)))return}catch(e){return void kt.v("checkIfSlidedownShouldBeShown returned an error",e)}if(function(){const t=OneSignal.notifyButton;t&&t.options?.enable&&"hidden"!==OneSignal.notifyButton?.launcher?.state&&OneSignal.notifyButton?.launcher?.waitUntilShown().then(()=>{OneSignal.notifyButton?.launcher?.hide()}),OneSignal.emitter.once(La.EVENTS.CLOSED,()=>{OneSignal.notifyButton&&OneSignal.notifyButton.options.enable&&OneSignal.notifyButton.launcher.show()})}(),this.isSlidedownShowing)this.enqueue(t);else try{this.setIsSlidedownShowing(!0);const e=t.slidedownPromptOptions||ee;this.slidedown=new La(e),await this.slidedown.create(t.isInUpdateMode),await this.mountAuxiliaryContainers(t),kt.m("Showing OneSignal Slidedown"),La.triggerSlidedownEvent(La.EVENTS.SHOWN)}catch(e){kt.O("There was an error showing the OneSignal Slidedown:",e),this.setIsSlidedownShowing(!1),this.slidedown?.close()}}}}const za=new Error("Slidedown is missing");class Ha{tagsFromTaggingContainer={};context;remoteTags={};constructor(t){this.context=t}async sendTags(){kt.S("Category Slidedown Local Tags:",this.tagsFromTaggingContainer);const t=Wa.convertTagsBooleansToApi(this.tagsFromTaggingContainer),e=Wa.getObjectDifference(t,this.remoteTags);return Wa.isTagObjectEmpty(e)?(kt.v("OneSignal: no change detected in Category preferences. Skipping tag update."),e):(await OneSignal.User.addTags(e),e)}storeTagValuesToUpdate(t){this.tagsFromTaggingContainer=t}storeRemotePlayerTags(t){this.context.it.remoteTags=t}}class Va{et;W;A;T;se;$;lt;promptsManager;ot;it;pe;constructor(t){var e,i;this.et=t,this.A=new Ca(e=this,{safariWebId:(i=e.et).safariWebId,appId:i.appId,vapidPublicKey:i.vapidPublicKey,onesignalVapidPublicKey:i.onesignalVapidPublicKey}),this.T=function(t){const e=t.et,i={workerPath:new ca(Wt),registrationOptions:Rt};return e.userConfig&&(e.userConfig.path&&(i.workerPath=new ca(`${e.userConfig.path}${e.userConfig.serviceWorkerPath}`)),e.userConfig.serviceWorkerParam&&(i.registrationOptions=e.userConfig.serviceWorkerParam)),new Oa(t,i)}(this),this.$=new Ea,this.se=new ra(this),this.lt=new Pa(this),this.ot=new _a(this),this.it=new Ha(this),this.pe=new Ka(this),this.promptsManager=new Ra(this),this.W=new Hi}}class qa{setLogLevel(t){kt.h(t)}}class Ga extends ms{q;we;constructor(t){super(),this.we=t,this.q="granted"===t,"undefined"!=typeof OneSignal&&OneSignal.emitter.on(OneSignal.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,t=>{this.we=t,this.q="granted"===t})}get permissionNative(){return this.we}get permission(){return this.q}async setDefaultUrl(t){if(Pi("setDefaultUrl",t),void 0===t)throw pt("url");if("string"!=typeof t)throw ft("url");if(!bt(t,{allowNull:!0}))throw wt("url");await _i(),Pi("setDefaultNotificationUrl",t);const e=await oi();e.defaultNotificationUrl=t,await ai(e)}async setDefaultTitle(t){if(Pi("setDefaultTitle",t),void 0===t)throw pt("title");if("string"!=typeof t)throw ft("title");await _i();const e=await oi();e.defaultNotificationTitle=t,await ai(e)}isPushSupported(){return Pi("isPushNotificationsSupported"),!0}async requestPermission(){ri()||(await _i(),await OneSignal.context.promptsManager.internalShowNativePrompt())}addEventListener(t,e){OneSignal.emitter.on(t,e)}removeEventListener(t,e){OneSignal.emitter.off(t,e)}}const Ja={NOTIFICATION_PERMISSION_CHANGED_AS_STRING:"permissionChangeAsString",NOTIFICATION_PERMISSION_CHANGED_AS_BOOLEAN:"permissionChange",SUBSCRIPTION_CHANGED:"change",WELCOME_NOTIFICATION_SENT:"sendWelcomeNotification",NOTIFICATION_WILL_DISPLAY:"foregroundWillDisplay",NOTIFICATION_DISMISSED:"dismiss",NOTIFICATION_CLICKED:"click",SDK_INITIALIZED:"initializeInternal",SDK_INITIALIZED_PUBLIC:"initialize",REGISTERED:"register",PERMISSION_PROMPT_DISPLAYED:"permissionPromptDisplay",TEST_FINISHED_ALLOW_CLICK_HANDLING:"testFinishedAllowClickHandling",SESSION_STARTED:"os.sessionStarted"};class Ya{async sendOutcome(t,e){const i=OneSignal.config?.userConfig.outcomes;if(!i)return void kt.O(`Could not send ${t}. No outcomes config found.`);const n=new la(OneSignal.config.appId,i,t,!1);if(void 0!==e&&"number"!=typeof e)return void kt.O("Outcome weight can only be a number if present.");if(!(await n.beforeOutcomeSend()))return;const s=await n.getAttribution();await n.send({type:s.type,notificationIds:s.notificationIds,weight:e})}async sendUniqueOutcome(t){const e=OneSignal.config?.userConfig.outcomes;if(!e)return void kt.O(`Could not send ${t}. No outcomes config found.`);const i=new la(OneSignal.config.appId,e,t,!0);if(!(await i.beforeOutcomeSend()))return;const n=await i.getAttribution();if(n.type===Dt)return void kt.v("You are on a free plan. Please upgrade to use this functionality.");const{notificationIds:s}=n,o=await i.getNotifsToAttributeWithUniqueOutcome(s);i.shouldSendUnique(n,o)?await i.send({type:n.type,notificationIds:o}):kt.v(`'${t}' was already reported for all notifications.`)}}class Qa extends ms{constructor(){super()}async promptPush(t){ri()||(await _i(),await OneSignal.context.promptsManager.internalShowParticularSlidedown(jt,t))}async promptPushCategories(t){if(ri())return;await _i();const e=await OneSignal.context.A.isPushNotificationsEnabled();await OneSignal.context.promptsManager.internalShowCategorySlidedown({...t,isInUpdateMode:e})}async promptSms(t){ri()||(await _i(),await OneSignal.context.promptsManager.internalShowSmsSlidedown({...t}))}async promptEmail(t){ri()||(await _i(),await OneSignal.context.promptsManager.internalShowEmailSlidedown({...t}))}async promptSmsAndEmail(t){ri()||(await _i(),await OneSignal.context.promptsManager.internalShowSmsAndEmailSlidedown({...t}))}addEventListener(t,e){OneSignal.emitter.on(t,e)}removeEventListener(t,e){OneSignal.emitter.off(t,e)}}let Za=class t{static EVENTS=Ja;static C=!1;static async fe(){const e=new Zo;await e.init(),t.G=new ea(e);const i=await li(),n=await t.context.$.getPermissionStatus();t.User=new Ds(!0,i,n),this.Notifications=new Ga(n)}static async me(e){const i=await fe(e);kt.m("OneSignal: Final web app config:",i),t.config=i,t.context=new Va(i),t.config=t.context.et}static async login(t,e){if(Pi("login",{externalId:t,jwtToken:e}),!ri()){if(void 0===t)throw pt("externalId");if("string"!=typeof t)throw ft("externalId");if(void 0!==e&&"string"!=typeof e)throw ft("jwtToken");await na.login(t,e)}}static async logout(){Pi("logout"),ri()||await na.logout()}static async init(e){if(Pi("init"),kt.m(`Browser Environment: ${T()} ${N()}`),localStorage.removeItem("isOptedOut"),localStorage.removeItem("isPushNotificationsEnabled"),function(){if(OneSignal.be)throw new Error("SDK already initialized");OneSignal.be=!0}(),await t.me(e),!t.config)throw new Error("OneSignal config not initialized!");T()!==v||t.config.safariWebId?(await t.fe(),t.C=await(async()=>await Ze("userConsent")??!1)(),!ii()||t.C?await t.ye():t.pendingInit=!0):kt.v(dt)}static async ye(){async function e(){t.Se||(t.Se=!0,t.emitter.on(t.EVENTS.NOTIFICATION_PERMISSION_CHANGED_AS_STRING,Rs),t.emitter.on(t.EVENTS.SUBSCRIPTION_CHANGED,js),t.emitter.on(t.EVENTS.SDK_INITIALIZED,qs),window.addEventListener("focus",()=>{Wi.checkAndTriggerNotificationPermissionChanged()}),await async function(){const t=Wi.getAppId(),e=OneSignal.config;await Qe.put("Ids",{type:"appId",id:t});const i=e.siteName||document.title||"Notification";await Qe.put("Options",{key:"pageTitle",value:i}),kt.S(`OneSignal: Set pageTitle to be '${i}'.`)}(),await async function(){const t=[],e=OneSignal.config?.userConfig.persistNotification;t.push(Qe.put("Options",{key:"persistNotification",value:null==e||e}));const i=OneSignal.config?.userConfig.webhooks;return["notification.willDisplay","notification.clicked","notification.dismissed"].forEach(e=>{i&&i[e]?t.push(Qe.put("Options",{key:`webhooks.${e}`,value:i[e]})):t.push(Qe.put("Options",{key:`webhooks.${e}`,value:!1}))}),i&&i.cors?t.push(Qe.put("Options",{key:"webhooks.cors",value:!0})):t.push(Qe.put("Options",{key:"webhooks.cors",value:!1})),OneSignal.config?.userConfig.notificationClickHandlerMatch?t.push(Qe.put("Options",{key:"notificationClickHandlerMatch",value:OneSignal.config.userConfig.notificationClickHandlerMatch})):t.push(Qe.put("Options",{key:"notificationClickHandlerMatch",value:"exact"})),OneSignal.config?.userConfig.notificationClickHandlerAction?t.push(Qe.put("Options",{key:"notificationClickHandlerAction",value:OneSignal.config.userConfig.notificationClickHandlerAction})):t.push(Qe.put("Options",{key:"notificationClickHandlerAction",value:"navigate"})),Promise.all(t)}(),await zs())}t.pendingInit=!1,t.context.se.listen(),"complete"===document.readyState||"interactive"===document.readyState?await e():(kt.m("OneSignal: Waiting for DOMContentLoaded or readyStateChange event before continuing initialization..."),window.addEventListener("DOMContentLoaded",()=>{e()}),document.onreadystatechange=()=>{"complete"!==document.readyState&&"interactive"!==document.readyState||e()})}static async setConsentGiven(e){if(Pi("setConsentGiven",{consent:e}),void 0===e)throw pt("consent");if("boolean"!=typeof e)throw ft("consent");t.C=e,await Qe.put("Options",{key:"userConsent",value:e}),e&&t.pendingInit&&await t.ye()}static async setConsentRequired(t){if(Pi("setConsentRequired",{requiresConsent:t}),void 0===t)throw pt("requiresConsent");if("boolean"!=typeof t)throw ft("requiresConsent");var e;e=t,localStorage.setItem(ei,e.toString())}static async push(e){return function(t,e){if("function"==typeof e)return e(t);throw new Error("Callback is not a function")}(t,e)}static M;static VERSION=M;static config=null;static rt=!1;static k=!1;static initialized=!1;static ge=!1;static notifyButton=null;static database=Qe;static pendingInit=!0;static emitter=new Ai;static cache={};static be=!1;static Se=!1;static context;static G;static Notifications=new Ga;static Slidedown=new Qa;static Session=new Ya;static User=new Ds(!1);static Debug=new qa};kt.S(`OneSignal Web SDK loaded (version ${M},\n  ${L} environment).`),kt.m(`Current Page URL: ${"undefined"==typeof location?"NodeJS":location.href}`),function(){if(window.__oneSignalSdkLoadCount=Ti()+1,Ti()>1)return kt.v("OneSignal: The web push SDK is included more than once. For optimal performance, please include our SDK only once on your page."),void kt.m(`OneSignal: Exiting from SDK initialization to prevent double-initialization errors. Occurred ${Ti()} times.`);window.OneSignal=Za,window.OneSignalDeferred=window.OneSignalDeferred??[];const t=async function(t){for(const i of t)try{await Za.push(i)}catch(e){kt.O(e)}}(window.OneSignalDeferred);Object.defineProperty(window.OneSignalDeferred,"push",{value:async function(e){return await t,Za.push(e)}})}()}();
//# sourceMappingURL=OneSignalSDK.page.es6.js.map
